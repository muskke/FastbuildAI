import{d as J,b as O,ap as T,s as V,g as H,aJ as k,i as K,j as Q,o as a,k as v,c as d,q as u,p as o,l as c,y as W,v as p,x as _,_ as X,t as Y,F as G,B as L}from"#entry";import{_ as Z}from"./ptVgWJmt.js";import{_ as ee}from"./CXUt0j5Y.js";import{b as se}from"./B3Cet3zC.js";import{a as oe,b as te}from"./CthPp3Zu.js";import"./CgMDXot0.js";import"./CR1AS2Ry.js";import"./DVnbt8cp.js";import"./DuSMYVIA.js";import"./D6yWePie.js";import"./CuOaO1Pb.js";import"./DHFmmngs.js";import"./C3zg6GHm.js";import"./BgHJjJs-.js";import"./-Eb02sIQ.js";import"./Dk6FGhu1.js";import"./BPKB8n-W.js";import"./MN31c9CG.js";import"./CCcv9mzY.js";import"./BFAo_s2U.js";import"./Cb04SOqd.js";import"./VGKgjfSv.js";const ie={key:0,class:"flex items-center justify-center",style:{height:"544px"}},ne={key:1},le={class:"mb-4 flex items-center justify-between"},re={class:"text-muted-foreground text-sm"},ae={class:"flex gap-2"},ce={class:"max-h-[40vh] overflow-y-auto"},me={class:"mb-2 flex items-center"},de={class:"ml-6 grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3"},ue={key:0,class:"text-muted-foreground py-4 text-center"},pe={class:"mt-4 flex justify-end gap-2"},Ae=J({__name:"assign-permissions",props:{id:{}},emits:["close"],setup(S,{emit:U}){const g=S,y=U,{t:n}=O(),x=T(),m=V([]),t=V([]),h=H(()=>m.value.flatMap(e=>e.permissions?.map(s=>s.id).filter(Boolean)??[]));function P(e){t.value.includes(e)||t.value.push(e)}function b(e){const s=t.value.indexOf(e);s!==-1&&t.value.splice(s,1)}function z(e){t.value.includes(e)?b(e):P(e)}function F(){t.value=[...h.value]}function I(){t.value=[]}function $(){t.value=h.value.filter(e=>!t.value.includes(e))}const{lockFn:A,isLock:C}=k(async()=>{try{const e=await se({isDeprecated:!1,isGrouped:!0});m.value=e}catch(e){console.error("加载权限列表失败:",e)}}),{lockFn:D,isLock:w}=k(async()=>{if(g.id)try{const e=await oe(g.id);t.value=e.permissions?.map(s=>s.id)??[]}catch(e){console.error("加载角色详情失败:",e)}}),{isLock:N,lockFn:j}=k(async()=>{if(!g.id){x.error(n("system-perms.role.roleIdRequired"));return}try{await te({id:g.id,permissionIds:t.value}),x.success(n("system-perms.role.assignPermissionsSuccess")),y("close",!0)}catch(e){console.error("分配权限失败:",e)}});function M(e,s){const l=m.value.find(i=>i.code===e);l&&l.permissions.forEach(i=>{s?P(i.id):b(i.id)})}function R(e){const s=m.value.find(l=>l.code===e);return!s||!s.permissions.length?!1:s.permissions.every(l=>t.value.includes(l.id))}function q(e){const s=m.value.find(i=>i.code===e);if(!s||!s.permissions.length)return!1;const l=s.permissions.filter(i=>t.value.includes(i.id)).length;return l>0&&l<s.permissions.length}return K(async()=>{await Promise.all([A(),D()])}),(e,s)=>{const l=W,i=X,B=Z,E=ee;return a(),Q(E,{title:o(n)("system-perms.role.assignPermissions"),description:o(n)("system-perms.role.assignPermissionsDesc"),ui:{container:"max-w-5xl"},onClose:s[1]||(s[1]=r=>y("close",!1))},{default:v(()=>[o(w)||o(C)?(a(),d("div",ie,[c(l,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):(a(),d("div",ne,[u("div",le,[u("div",re,p(o(n)("system-perms.role.totalPermissions",{count:o(h).length})),1),u("div",ae,[c(i,{size:"sm",color:"primary",variant:"soft",onClick:F},{default:v(()=>[_(p(o(n)("console-common.selectAll")),1)]),_:1}),c(i,{size:"sm",color:"info",variant:"soft",onClick:I},{default:v(()=>[_(p(o(n)("console-common.selectNone")),1)]),_:1}),c(i,{size:"sm",color:"info",variant:"soft",onClick:$},{default:v(()=>[_(p(o(n)("system-perms.role.invertSelection")),1)]),_:1})])]),u("div",ce,[(a(!0),d(G,null,L(o(m),r=>(a(),d("div",{key:r.code,class:"mb-6"},[u("div",me,[c(B,{"model-value":R(r.code)?!0:q(r.code)?"indeterminate":!1,label:r.name,"onUpdate:modelValue":f=>M(r.code,f===!0)},null,8,["model-value","label","onUpdate:modelValue"])]),u("div",de,[(a(!0),d(G,null,L(r.permissions,f=>(a(),d("div",{key:f.id,class:"flex items-center"},[c(B,{"model-value":o(t).includes(f.id),label:f.name,"onUpdate:modelValue":()=>z(f.id)},null,8,["model-value","label","onUpdate:modelValue"])]))),128))])]))),128)),o(m).length===0?(a(),d("div",ue,p(o(n)("system-perms.role.noPermissions")),1)):Y("",!0)])])),u("div",pe,[c(i,{color:"neutral",variant:"soft",size:"lg",onClick:s[0]||(s[0]=r=>y("close",!1))},{default:v(()=>[_(p(o(n)("console-common.cancel")),1)]),_:1}),c(i,{color:"primary",size:"lg",loading:o(N),disabled:o(w)||o(C),onClick:o(j)},{default:v(()=>[_(p(o(n)("console-common.confirm")),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1},8,["title","description"])}}});export{Ae as default};
