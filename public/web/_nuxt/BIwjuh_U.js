import{g as c,s as g,R as u}from"#entry";function d(r){return typeof r=="function"?u(r):r}function h(r,t){let e=0,o=r.length;for(;e<o;){const s=e+o>>1;(r[s]?.order??0)<=(t??0)?e=s+1:o=s}return e}class p{plugins=new Map;slotIndex=new Map;slotSignals=new Map;keyToSlot=new Map;register(t){if(!this.plugins.has(t.id)){this.plugins.set(t.id,t);for(const e of t.contributions)this.registerContribution(t.id,e);console.log(this.plugins)}}registerContribution(t,e){const o=`${t}:${e.id}`,s={key:o,pluginId:t,id:e.id,slot:e.slot,order:e.order??0,component:d(e.component),meta:e.meta,props:e.props,enabled:e.enabled},i=this.keyToSlot.get(o);i&&this.removeFromSlot(i,o),this.keyToSlot.set(o,s.slot);const l=this.slotIndex.get(s.slot)??[],n=h(l,s.order);l.splice(n,0,s),this.slotIndex.set(s.slot,l),this.bumpSignal(s.slot,l)}unregister(t){const e=this.plugins.get(t);if(e){for(const o of e.contributions){const s=`${t}:${o.id}`,i=this.keyToSlot.get(s);i&&this.removeFromSlot(i,s),this.keyToSlot.delete(s)}this.plugins.delete(t)}}useSlot(t){if(!this.slotSignals.has(t)){const o=this.slotIndex.get(t)??[];this.slotSignals.set(t,g(o))}const e=this.slotSignals.get(t);if(!e)throw new Error(`Unable to create signal for slot: ${t}`);return e}getSlot(t){return this.slotIndex.get(t)??[]}removeFromSlot(t,e){const o=this.slotIndex.get(t);if(!o)return;const s=o.findIndex(i=>i.key===e);s!==-1&&(o.splice(s,1),this.slotIndex.set(t,o),this.bumpSignal(t,o))}bumpSignal(t,e){const o=this.slotSignals.get(t);o&&(o.value=e.slice())}}const f=new p;function S(r,t){const e=f.useSlot(r);return console.log(e.value),c(()=>{const o=e.value,s=t?.ctxProvider?.(),i=[];for(let l=0;l<o.length;l++){const n=o[l];if(n?.enabled&&!n.enabled(s))continue;const a={key:n.key,pluginId:n.pluginId,id:n.id,slot:n.slot,order:n.order,component:n.component,meta:n.meta,props:n.props};i.push(a)}return i})}export{S as u};
