import{aP as X,b2 as Z,g as b,bc as O,b9 as ee,b_ as te,j as p,o as a,k as u,t as h,c as d,C as F,z as C,F as A,B as U,aq as se,p as r,$ as oe,d as ae,b as le,ao as ne,f as I,ap as re,i as ie,l as v,_ as ce,n as T,q as t,v as n,Y as de,y as ue,x as B,b$ as pe}from"#entry";import fe from"./BruVSCWF.js";import{_ as me}from"./ybFaAORl.js";import{_ as ve}from"./Cif_tCX1.js";import{_ as ge}from"./C7UmhjTd.js";import{M as _e,j as ye}from"./D9F45f3T.js";const xe={slots:{root:"inline-flex flex-row-reverse justify-end",base:"relative rounded-full ring-bg first:me-0"},variants:{size:{"3xs":{base:"ring -me-0.5"},"2xs":{base:"ring -me-0.5"},xs:{base:"ring -me-0.5"},sm:{base:"ring-2 -me-1.5"},md:{base:"ring-2 -me-1.5"},lg:{base:"ring-2 -me-1.5"},xl:{base:"ring-3 -me-2"},"2xl":{base:"ring-3 -me-2"},"3xl":{base:"ring-3 -me-2"}}},defaultVariants:{size:"md"}},he={__name:"AvatarGroup",props:{as:{type:null,required:!1},size:{type:null,required:!1},max:{type:[Number,String],required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(S){const f=S,i=X(),j=Z(),L=b(()=>O({extend:O(xe),...j.ui?.avatarGroup||{}})({size:f.size})),x=b(()=>typeof f.max=="string"?Number.parseInt(f.max,10):f.max),g=b(()=>{let _=i.default?.();return _?.length&&(_=_.flatMap(o=>typeof o.type=="symbol"?typeof o.children=="string"?void 0:o.children:o).filter(Boolean)),_||[]}),z=b(()=>g.value.length?!x.value||x.value<=0?[...g.value].reverse():[...g.value].slice(0,x.value).reverse():[]),k=b(()=>g.value.length?g.value.length-z.value.length:0);return ee(te,b(()=>({size:f.size}))),(_,o)=>(a(),p(r(oe),{as:S.as,class:C(L.value.root({class:[f.ui?.root,f.class]}))},{default:u(()=>[k.value>0?(a(),p(F,{key:0,text:`+${k.value}`,class:C(L.value.base({class:f.ui?.base}))},null,8,["text","class"])):h("",!0),(a(!0),d(A,null,U(z.value,(M,w)=>(a(),p(se(M),{key:w,class:C(L.value.base({class:f.ui?.base}))},null,8,["class"]))),128))]),_:1},8,["as","class"]))}},be={class:"flex items-center gap-1 truncate"},ke={class:"hidden sm:block"},we={class:"flex items-center gap-2"},Ce={class:"flex items-center"},Le={class:"bg-background max-h-[480px] w-90 overflow-hidden rounded-lg shadow-lg"},ze={class:"flex items-stretch gap-2 border-b p-3"},Me={class:"grid grid-cols-1 gap-3 p-2"},Ie={key:0,class:"text-muted-foreground col-span-full py-10 text-center"},Ve={key:1,class:"text-muted-foreground col-span-full py-10 text-center"},Se={class:"max-h-70 space-y-2 overflow-y-auto"},$e={class:"space-y-1"},Be=["onClick"],Ae={class:"flex w-full flex-row items-center justify-between"},Ue={class:"flex flex-row items-center gap-2 space-y-0.5 overflow-hidden"},je={key:1,class:"bg-primary flex size-9 items-center justify-center rounded-md"},Ne={class:"flex flex-1 flex-col overflow-hidden"},qe={class:"text-secondary-foreground truncate text-sm font-medium"},Pe={key:0,class:"text-muted-foreground truncate text-xs"},De={key:1,class:"flex items-center gap-1 text-xs text-red-500"},Ee={class:"line-clamp-1"},Ge={class:"flex h-fit w-96 flex-col items-start gap-4 p-5"},Oe={class:"flex flex-row justify-center gap-2"},Te={key:1,class:"bg-primary flex size-11 items-center justify-center rounded-lg"},Fe={class:"flex flex-col gap-1"},Je={class:"text-secondary-foreground truncate text-sm font-medium"},Ye={key:1,class:"flex items-start gap-1 text-sm text-red-500"},Ke={class:"bg-muted-foreground/10 w-full rounded-lg p-2"},Re={class:"text-muted-foreground text-xs wrap-break-word"},He={key:0,class:"space-y-2"},Qe={class:"text-xs font-bold"},We={class:"flex flex-wrap gap-1"},Xe={class:"sticky bottom-0"},nt=ae({__name:"mcp-tool-select",props:{modelValue:{},disabled:{type:Boolean},showDescription:{type:Boolean,default:!0},defaultSelected:{type:Boolean,default:!0},console:{type:Boolean,default:!1},capability:{},modelId:{default:""},mcpIds:{}},emits:["update:modelValue","change"],setup(S,{emit:f}){const{t:i}=le(),j=pe(),L=ne(),x=S,g=f,z=I(!1),k=I(!1),_=I(""),o=I([]),M=I(_e.SYSTEM),w=I([]),J=re(),D=b(()=>{const l=_.value.trim().toLowerCase(),s=w.value.filter(m=>m.type===M.value);return l?s.filter(m=>[m.name,m.providerName,m.description].some(c=>c?.toLowerCase().includes(l))):s}),$=b(()=>(Array.isArray(o.value)?o.value:[]).filter(l=>w.value.some(s=>s.id===l))),Y=l=>{M.value=l,N()},N=async()=>{if(!z.value){try{const l=JSON.parse(localStorage.getItem("mcpIds")||"[]");o.value=Array.isArray(l)?l:[]}catch{o.value=[]}try{const l=await ye();w.value=l;const y=(Array.isArray(o.value)?o.value:[]).filter(m=>l.some(c=>c.id===m));y.length!==o.value.length&&(o.value=y)}catch(l){console.error("Failed to load MCP",l)}}};ie(()=>{L.isLogin&&N()});function K(l){const s=o.value.indexOf(l.id);if(s>-1)o.value.splice(s,1);else{if(o.value.length===5){J.warning("为了保持性能，在当前的 MCP模式下，最多只能同时激活5个MCP 服务器。请在启用新的服务器之前关闭一些服务器。");return}o.value.push(l.id)}localStorage.setItem("mcpIds",JSON.stringify(o.value)),g("update:modelValue",[...o.value]),g("change",o.value)}function R(){o.value=[],g("update:modelValue",[]),g("change",[]),k.value=!1,_.value="",localStorage.removeItem("mcpIds")}const q=l=>w.value.find(s=>s.id===l);async function H(l){if(l){await N();const y=(Array.isArray(o.value)?o.value:[]).filter(m=>w.value.some(c=>c.id===m));y.length!==o.value.length&&(o.value=y)}}return(l,s)=>{const y=F,m=he,c=ue,P=ce,Q=fe,W=me,E=ve,G=ge;return a(),p(G,{open:k.value,"onUpdate:open":[s[7]||(s[7]=e=>k.value=e),H],disabled:x.disabled},{content:u(()=>[t("div",Le,[t("div",ze,[v(Q,{modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e),placeholder:r(i)("common.placeholder.mcpSelect"),size:"lg",ui:{root:"flex-1"}},{leading:u(()=>[v(c,{name:"i-lucide-search"})]),_:1},8,["modelValue","placeholder"]),v(P,{class:"w-fit",color:"primary",variant:"ghost",ui:{leadingIcon:"size-4"},icon:"i-lucide-rotate-ccw",onClick:s[3]||(s[3]=e=>o.value=[])},{default:u(()=>[B(n(r(i)("ai-mcp.frontend.reset")),1)]),_:1})]),t("div",Me,[v(W,{color:"primary",variant:"link",content:!1,items:[{label:r(i)("common.tab.system"),value:"system"},{label:r(i)("common.tab.custom"),value:"user"}],"onUpdate:modelValue":[s[4]||(s[4]=e=>Y(e)),s[5]||(s[5]=e=>M.value=e)],modelValue:M.value,class:"w-full"},null,8,["items","modelValue"]),z.value?(a(),d("div",Ie,n(r(i)("common.loading"))+"... ",1)):D.value.length?h("",!0):(a(),d("div",Ve,n(r(i)("common.empty")),1)),t("section",Se,[t("ul",$e,[(a(!0),d(A,null,U(D.value,e=>(a(),d("li",{key:e.id,class:C(["group hover:bg-muted flex cursor-pointer items-center justify-between gap-2 rounded-md px-3 py-2 transition-colors",{"bg-secondary":o.value.includes(e.id),"cursor-not-allowed!":!e.connectable}]),onClick:V=>e.connectable&&K(e)},[v(G,{mode:"hover","open-delay":500,content:{align:"start",side:"right",sideOffset:20}},{content:u(()=>[t("div",Ge,[t("div",Oe,[e.icon?(a(),p(y,{key:0,src:e.icon,alt:e.name,size:"2xl",class:"bg-secondary",ui:{image:"rounded-lg"}},null,8,["src","alt"])):(a(),d("div",Te,[...s[10]||(s[10]=[t("svg",{class:"size-9 text-white",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),t("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),t("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)])])),t("div",Fe,[t("p",Je,n(e.alias||e.name),1),e.connectable?(a(),p(E,{key:0,size:"sm",class:"w-fit",color:"success"},{default:u(()=>[B(n(r(i)("ai-mcp.frontend.success")),1)]),_:1})):(a(),d("div",Ye,[v(c,{size:"20",name:"i-lucide-alert-octagon"}),t("p",null,n(e.connectError),1)]))])]),t("div",Ke,[t("p",Re,n(e.description||r(i)("ai-mcp.frontend.detail.noDescription")),1)]),e.connectable?(a(),d("div",He,[t("h2",Qe,n(r(i)("ai-mcp.frontend.detail.tools")),1),t("div",We,[(a(!0),d(A,null,U(e.tools,V=>(a(),p(E,{key:V.id,color:"neutral",variant:"outline"},{default:u(()=>[B(n(V.name),1)]),_:2},1024))),128))])])):h("",!0)])]),default:u(()=>[t("div",Ae,[t("div",Ue,[e.icon?(a(),p(y,{key:0,src:e.icon,alt:e.name,size:"lg",class:"bg-secondary",ui:{image:"rounded-md"}},null,8,["src","alt"])):(a(),d("div",je,[...s[9]||(s[9]=[t("svg",{class:"size-7 text-white",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),t("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),t("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)])])),t("div",Ne,[t("p",qe,n(e.alias||e.name),1),x.showDescription&&e.description?(a(),d("p",Pe,n(e.description),1)):h("",!0),e.connectError?(a(),d("div",De,[v(c,{size:"16",name:"i-lucide-alert-octagon"}),t("p",Ee,n(e.connectError),1)])):h("",!0)])]),o.value.includes(e.id)?(a(),p(c,{key:0,name:"i-lucide-check-circle",class:"text-primary flex-none",size:"lg"})):h("",!0)])]),_:2},1024)],10,Be))),128))]),t("div",Xe,[v(P,{color:"primary",variant:"subtle",class:"flex w-full items-center justify-center",onClick:s[6]||(s[6]=e=>r(j).push(`/profile/${r(L).userInfo?.id}/mcp-settings`))},{default:u(()=>[B(n(r(i)("ai-mcp.frontend.setMcp"))+" ",1),v(c,{name:"i-lucide-external-link"})]),_:1})])])])])]),default:u(()=>[v(P,{color:o.value.length>0?"primary":"neutral",variant:"ghost",ui:{leadingIcon:"size-4"},class:C({"bg-primary/10":$.value.length}),loading:z.value,disabled:x.disabled,onClick:s[1]||(s[1]=T(()=>{},["stop"]))},{default:u(()=>[t("span",be,[s[8]||(s[8]=t("svg",{class:"size-4",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),t("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),t("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)),t("span",ke,n(r(i)("ai-mcp.frontend.tool")),1),$.value.length?(a(),p(m,{key:0,ui:{base:"ring-0 -me-2"},size:"2xs"},{default:u(()=>[(a(!0),d(A,null,U($.value,(e,V)=>(a(),p(y,{src:q(e)?.icon,style:de(`z-index: ${V+1}`),key:e,class:C(`${q(e)?.icon?"bg-secondary":"bg-primary"}`),ui:{fallback:"text-inverted"},alt:q(e)?.name||""},null,8,["src","style","class","alt"]))),128))]),_:1})):h("",!0)]),t("div",we,[$.value.length>0&&x.console?(a(),p(c,{key:0,name:"i-lucide-x",onClick:s[0]||(s[0]=T(e=>R(),["stop"]))})):h("",!0),t("div",Ce,[v(c,{name:"i-lucide-chevron-down",class:C({"rotate-180":k.value})},null,8,["class"])])])]),_:1},8,["color","class","loading","disabled"])]),_:1},8,["open","disabled"])}}});export{nt as _};
