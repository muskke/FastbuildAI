const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DMIkOjZk.js","./CpacWlXu.js","./CBooyAK7.js","./DBjGnECu.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./b-_TUx9i.js","./B22A-h4k.js","./Cfcu-t3n.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./XpsTG8vq.js","./BcgmQzdY.js"])))=>i.map(i=>d[i]);
import{d as F,aq as M,b as q,Q as H,e as O,aM as j,s as Q,g as J,f as b,aK as x,i as W,c as X,o as Y,q as f,l as i,p as o,k as y,_ as Z,x as ee,v as V,h as t,y as se,R as oe,U as te}from"#entry";import{_ as ae}from"./CBooyAK7.js";import{_ as re}from"./B1Lg5z9T.js";import{_ as ie}from"./DBjGnECu.js";import ne from"./--UdezPG.js";import{_ as le}from"./CJG2iIES.js";import{_ as ce}from"./Brvl6ix_.js";import{b as de,c as pe,d as me}from"./BcgmQzdY.js";import{u as ue}from"./Dp_0VxUw.js";import"./CLTNKp0S.js";import"./8-c-A7PB.js";import"./kRIii9yh.js";import"./TH-3OOuG.js";import"./Cfcu-t3n.js";import"./C6Y-ieo6.js";import"./b-_TUx9i.js";import"./DaNf1Wdt.js";import"./CKXZhss7.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./B22A-h4k.js";import"./Bub1HYiY.js";import"./lw_U4-W2.js";import"./XpsTG8vq.js";const ge={class:"permission-list-container pb-5"},fe={class:"bg-background sticky top-0 z-10 flex flex-wrap gap-4 pb-4"},ye={class:"flex items-end gap-2 md:ml-auto"},he={class:"border-default mt-auto flex items-center justify-between gap-3 border-t pt-4"},ve={class:"text-muted text-sm"},_e={class:"flex items-center gap-1.5"},He=F({__name:"list",setup(be){const D=oe(()=>te(()=>import("./DMIkOjZk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),l=Z,h=ae,k=re,$=se,G=ie,C=M(),{t:a}=q(),{hasAccessByCodes:S}=ue(),E=H(),v=O("table"),d=j({code:"",name:"",group:""}),P=Q({}),c=J(()=>({code:a("system-perms.permission.code"),name:a("system-perms.permission.name"),description:a("system-perms.permission.describe"),group:a("system-perms.permission.group"),isDeprecated:a("system-perms.permission.isDeprecated"),createdAt:a("console-common.createAt"),actions:a("console-common.operation")})),I=[{id:"expander",header:({table:e})=>t(l,{variant:"ghost",color:"neutral",icon:e.getExpandedDepth()?"i-lucide-minus-square":"i-lucide-plus-square",size:"xs",onClick:s=>{s.stopPropagation(),e.toggleAllRowsExpanded(!e.getExpandedDepth())}}),enableHiding:!1,cell:({row:e})=>e.getCanExpand()?t(l,{variant:"ghost",color:"neutral",icon:e.getIsExpanded()?"i-lucide-minus":"i-lucide-plus",size:"xs",onClick:s=>{s.stopPropagation(),e.toggleExpanded()}}):null},{accessorKey:"name",header:()=>t("p",{class:""},`${c.value.name}`),cell:({row:e})=>{e.depth;const s=e.original.isGroup,n=[];s&&n.push(t($,{name:"i-lucide-folder",class:"text-primary size-5 flex-none mr-2"}));const g=s?e.original.groupName:`@${e.original.name}`;return n.push(t("span",{class:"truncate"},g)),t("div",{class:"flex items-center"},n)}},{accessorKey:"description",header:()=>t("p",{class:""},`${c.value.description}`),cell:({row:e})=>{const s=e.getValue("description");return e.original.isGroup?t("div",{class:"text-muted-foreground"},"-"):t("div",{class:"max-w-xs truncate"},s||"-")}},{accessorKey:"group",header:()=>t("p",{class:""},`${c.value.group}`),cell:({row:e})=>{if(e.original.isGroup)return t("div",{class:"text-muted-foreground"},"-");const s=e.getValue("group");return t("div",{class:""},[t(h,{color:"primary",variant:"subtle"},()=>s)])}},{accessorKey:"isDeprecated",header:()=>t("p",{class:""},`${c.value.isDeprecated}`),cell:({row:e})=>{if(e.original.isGroup)return t("div",{class:"text-muted-foreground"},"-");const s=e.getValue("isDeprecated");return t("div",{class:""},[s?t(h,{color:"error",variant:"subtle"},()=>a("system-perms.permission.yes")):t(h,{color:"success",variant:"subtle"},()=>a("system-perms.permission.no"))])}},{accessorKey:"createdAt",header:({column:e})=>{const s=e.getIsSorted();return t(l,{color:"neutral",variant:"ghost",label:c.value.createdAt,icon:s?s==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{if(e.original.isGroup)return t("div",{class:"text-muted-foreground"},"-");const s=e.getValue("createdAt");return t(G,{datetime:s,mode:"datetime"})}},{id:"actions",header:()=>t("p",{class:""},`${c.value.actions}`),size:80,enableSorting:!1,enableHiding:!1,cell:({row:e})=>e.original.isGroup?t("div",{class:"text-muted-foreground"},"-"):t(k,{items:L(e)},()=>t(l,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"},()=>""))}];function L(e){return[S(["permission:info"])?{label:a("console-common.check"),icon:"i-lucide-eye",onSelect(){z(e.original.code)}}:null].filter(Boolean)}const m=b([]),u=b([]),U=b(!0),w=e=>e.map(s=>({id:`group-${s.code}`,code:s.code,name:s.name,groupName:s.name,description:"",group:s.code,isGroup:!0,createdAt:"",updatedAt:"",children:s.permissions.map(n=>({...n,isGroup:!1,groupName:s.name}))})),{lockFn:p,isLock:A}=x(async()=>{try{const e={keyword:d.name||void 0,group:d.group||void 0,isGrouped:U.value},s=await de(e);Array.isArray(s)?s.length>0&&s[0]&&"permissions"in s[0]?(u.value=s,m.value=w(u.value)):(m.value=s.map(n=>({...n,isGroup:!1})),u.value=[]):(u.value=[s],m.value=w(u.value))}catch(e){console.error("获取权限列表失败:",e)}}),{lockFn:R,isLock:B}=x(async()=>{try{const e=await pe();C.success(a("system-perms.permission.syncSuccess",{added:e.added,updated:e.updated,isDeprecated:e.deprecated,total:e.total})),await p()}catch(e){console.error("同步权限失败:",e)}}),{lockFn:N,isLock:T}=x(async()=>{try{const e=await me();C.success(a("system-perms.permission.cleanupSuccess",{removed:e.removed})),await p()}catch(e){console.error("清理权限失败:",e)}}),z=e=>{E.create(D).open({code:e})};return W(()=>p()),(e,s)=>{const n=ne,g=le,K=ce;return Y(),X("div",ge,[f("div",fe,[i(n,{modelValue:o(d).name,"onUpdate:modelValue":s[0]||(s[0]=r=>o(d).name=r),placeholder:o(a)("system-perms.permission.nameInput"),onChange:o(p)},null,8,["modelValue","placeholder","onChange"]),i(n,{modelValue:o(d).group,"onUpdate:modelValue":s[1]||(s[1]=r=>o(d).group=r),placeholder:o(a)("system-perms.permission.groupInput"),ui:{root:"max-w-xs w-full"},onChange:o(p)},null,8,["modelValue","placeholder","onChange"]),f("div",ye,[i(g,{codes:["permission:sync"]},{default:y(()=>[i(o(l),{color:"info",variant:"outline",label:o(a)("system-perms.permission.sync"),icon:"i-lucide-refresh-cw",loading:o(B),onClick:o(R)},null,8,["label","loading","onClick"])]),_:1}),i(g,{codes:["permission:cleanup"]},{default:y(()=>[i(o(l),{color:"warning",variant:"outline",label:o(a)("system-perms.permission.cleanup"),icon:"i-lucide-trash-2",loading:o(T),onClick:o(N)},null,8,["label","loading","onClick"])]),_:1}),i(o(k),{items:o(v)?.tableApi?.getAllColumns().filter(r=>r.getCanHide()).map(r=>({label:o(c)[r.id]||r.columnDef.header,type:"checkbox",checked:r.getIsVisible(),onUpdateChecked(_){o(v)?.tableApi?.getColumn(r.id)?.toggleVisibility(!!_)},onSelect(_){_?.preventDefault()}})),content:{align:"end"}},{default:y(()=>[i(o(l),{label:e.$t("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),i(g,{codes:["permission:list"]},{default:y(()=>[i(o(l),{icon:"i-lucide-list-filter",color:"primary",variant:"outline",onClick:o(p),loading:o(A)},{default:y(()=>[ee(V(o(a)("system-perms.permission.refresh")),1)]),_:1},8,["onClick","loading"])]),_:1})])]),i(K,{loading:o(A),data:o(m),columns:I,class:"shrink-0",ref_key:"table",ref:v,selectable:"",expanded:o(P),getSubRows:r=>r.children,ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"}},null,8,["loading","data","expanded","getSubRows"]),f("div",he,[f("div",ve,V(o(a)("system-perms.permission.totalCount",{count:o(m).length})),1),f("div",_e,[i(o(l),{size:"xs",color:"gray",variant:"ghost",label:o(a)("system-perms.permission.groupView"),icon:"i-lucide-layers",onClick:()=>{}},null,8,["label"])])])])}}});export{He as default};
