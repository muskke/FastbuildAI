import{d as T,b as F,aq as L,f as m,w as R,c as U,o as $,q as o,l as g,y as E,k as h,x as y,v as c,p as s,_ as A,z as B,bB as P}from"#entry";const j={class:"flex flex-col items-center space-y-2"},G={class:"flex w-full items-center justify-center"},M={class:"text-muted-foreground text-sm"},X=["accept"],V={class:"text-muted-foreground mt-2 text-sm"},K=T({__name:"index",props:{fileList:{}},emits:["update:fileList"],setup(D,{emit:S}){const d=Object.freeze({PENDING:"pending",UPLOADING:"uploading",SUCCESS:"success",ERROR:"error"}),v=S,b=D,r=Object.freeze({maxSize:15,maxCount:10,supportedTypes:["TXT","MARKDOWN","DOCX"],accept:".txt,.md,.docx"}),{t:i}=F(),C=L(),x=m(),u=m(!1),l=m([]);R(()=>b.fileList,t=>{t&&t.length!==l.value.length&&(l.value=[...t])},{immediate:!0});const k=()=>`file_${Date.now()}_${Math.random().toString(36).slice(2)}`,z=t=>{const e=t.name.split(".").pop()?.toUpperCase()||"";return e!=="TXT"&&e!=="DOCX"&&e!=="MD"?{valid:!1,error:i("ai-datasets.backend.create.file.unsupportedFileType",{ext:e})}:t.size>r.maxSize*1024*1024?{valid:!1,error:i("ai-datasets.backend.create.file.fileTooLarge",{maxSize:r.maxSize})}:{valid:!0}},p=(t,e)=>{const a=l.value.find(n=>n.id===t);a&&Object.assign(a,e)},_=async t=>{if(l.value.length+t.length>r.maxCount)throw new Error(`最多只能上传 ${r.maxCount} 个文件`);const e=t.map(a=>{const{valid:n,error:f}=z(a);return n?{id:k(),file:a,status:d.PENDING,progress:0}:(C.warning(`${a.name}: ${f}`),null)}).filter(Boolean);l.value.push(...e),v("update:fileList",[...l.value]),await O(e)},O=async t=>{for(const e of t){if(!e.file||!e.id){console.warn("文件对象或ID缺失，跳过上传");continue}try{p(e.id,{status:d.UPLOADING,progress:0});const a=await P({file:e.file,description:"datasets files"},{onProgress:n=>{e.id&&p(e.id,{progress:n})}});p(e.id,{status:d.SUCCESS,progress:100,id:a.id,url:a.url,originalName:a.originalName,size:a.size,type:a.type,extension:a.extension})}catch(a){console.error(`上传失败: ${e.file.name}`,a),p(e.id,{status:d.ERROR,error:i("common.message.uploadFailed")})}}v("update:fileList",[...l.value])},w=t=>{const e=t.target,a=Array.from(e.files||[]);a.length&&_(a),e.value=""},I=t=>{t.preventDefault(),u.value=!1,_(Array.from(t.dataTransfer?.files||[]))},N=t=>{t.preventDefault(),u.value=!0};return(t,e)=>{const a=E,n=A;return $(),U("div",null,[o("div",{class:B(["bg-muted rounded-lg border border-dashed p-6 text-center transition-all duration-200",[s(u)?"border-primary bg-primary-50":"border-default hover:border-primary"]]),onDrop:I,onDragover:N,onDragleave:e[1]||(e[1]=f=>u.value=!1)},[o("div",j,[o("div",G,[g(a,{name:"i-heroicons-cloud-arrow-up",class:"text-muted-foreground size-6"}),g(n,{color:"neutral",variant:"link"},{default:h(()=>[y(c(s(i)("ai-datasets.backend.create.file.dragOrSelectFiles")),1)]),_:1}),g(n,{color:"primary",variant:"link",onClick:e[0]||(e[0]=f=>s(x)?.click())},{default:h(()=>[y(c(s(i)("ai-datasets.backend.create.file.chooseFile")),1)]),_:1})]),o("div",M,[o("p",null,c(s(i)("ai-datasets.backend.create.file.supportedTypes",{types:s(r).supportedTypes.join(", ")})),1),o("p",null,c(s(i)("ai-datasets.backend.create.file.fileSizeLimit",{maxSize:s(r).maxSize})),1)])]),o("input",{ref_key:"fileInputRef",ref:x,type:"file",multiple:"",class:"hidden",accept:s(r).accept,onChange:w},null,40,X)],34),o("div",V,c(s(i)("ai-datasets.backend.create.file.comingSoon")),1)])}}});export{K as default};
