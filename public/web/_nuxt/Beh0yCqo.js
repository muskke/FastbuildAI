import{d as X,b as Y,s as k,e as ee,g as A,w as me,i as oe,j as I,o as f,p as e,A as Z,k as i,l as t,_ as te,m as pe,n as H,q as c,z as q,v as y,t as T,y as ae,c as g,F as N,B as Q,bs as fe,T as ve,G as _e,aJ as be,aq as ge,au as ye,f as he,aM as xe,aZ as we,a_ as ke,aK as W,x as G}from"#entry";import le from"./--UdezPG.js";import{_ as se}from"./BYwSSEjb.js";import{_ as Ue}from"./CqN3ElKI.js";import{_ as Ve}from"./CBooyAK7.js";import{_ as Se}from"./D-yR6Fj9.js";import{_ as $e}from"./BO1GPLSL.js";import{g as Ce}from"./ahy3UiMC.js";import{_ as Te}from"./CyGK14vg.js";import{_ as Ae}from"./BJePYFQ7.js";import Ie from"./CfxLE1oh.js";import{_ as Be}from"./DNgvVYsj.js";import{_ as Me}from"./BYK_1AlN.js";import{e as Re,f as qe,g as Pe,h as De}from"./BcvHkqwA.js";import{c as Fe,d as Le,a as J}from"./BUyfW8JT.js";import{u as ze}from"./UqhBTNL6.js";import{u as Ke}from"./DqVgEjI6.js";import"./BgHJjJs-.js";import"./BaNg8fjw.js";import"./DlAUqK2U.js";import"./Dn8X9Gvz.js";import"./CLTNKp0S.js";import"./8-c-A7PB.js";import"./kRIii9yh.js";import"./TH-3OOuG.js";import"./Cfcu-t3n.js";import"./C6Y-ieo6.js";import"./b-_TUx9i.js";import"./DaNf1Wdt.js";import"./CKXZhss7.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./B22A-h4k.js";import"./Bub1HYiY.js";import"./DN9ov8OT.js";import"./nBDBqKnC.js";import"./9bDOsXij.js";import"./PB-3MFNY.js";import"./Cv1u6XyE.js";import"./CKTa8Hyi.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./CP4Zo7YT.js";import"./XpsTG8vq.js";import"./DaWZu8wl.js";const Oe={class:"flex items-center gap-2"},je={class:"border-border bg-background w-[380px] rounded-lg border shadow-lg"},Ee={class:"p-3"},Ne={class:"grid h-full"},Ge={key:0,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},Je={class:"text-sm"},Ze={key:1,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},He={class:"text-sm font-medium"},Qe={class:"mt-1 text-xs"},We={key:2,class:"py-1"},Xe={key:0,class:"mb-1"},Ye=["onClick"],eo={class:"text-foreground flex-1 truncate font-medium"},oo={class:"text-muted-foreground flex items-center gap-1 text-xs"},to={key:0,class:"border-border/30 ml-4 border-l pl-3"},ao=["data-model-id","onClick"],lo={class:"flex-1 truncate font-medium"},so=X({__name:"key-pool-select",props:{modelValue:{},disabled:{type:Boolean},showDescription:{type:Boolean,default:!0},defaultSelected:{type:Boolean,default:!0},console:{type:Boolean,default:!1},supportedModelTypes:{},buttonUi:{},showBillingRule:{type:Boolean,default:!1},openLocalStorage:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(P,{emit:D}){const v=P,$=D,{t:h}=Y(),x=k(!1),p=k(!1),o=k(""),d=k(null),B=ee("scrollAreaRef"),w=k([]),U=k(new Set),C=A(()=>{const l=o.value.trim().toLowerCase();return l?w.value.map(a=>({...a,secretConfigs:(a.secretConfigs||a.Secrets||[]).filter(m=>m.name.toLowerCase().includes(l)||a.name.toLowerCase().includes(l))})).filter(a=>a.name.toLowerCase().includes(l)||((a.secretConfigs||a.Secrets)?.length||0)>0):w.value}),V=A(()=>{if(!d.value)return"";const l=w.value.find(a=>(a.secretConfigs||a.Secrets||[]).some(m=>m.id===d.value?.id));return l?`${l.name}/${d.value.name}`:d.value.name}),M=A(()=>w.value.flatMap(l=>l.secretConfigs||l.Secrets||[]));function n(l){d.value=l,$("update:modelValue",l?.id??""),$("change",l),p.value=!1,o.value=""}async function F(){if(!x.value){x.value=!0;try{w.value=await Ce(),U.value=new Set(w.value.map(a=>a.id));const l=a=>M.value.find(m=>m.id===a);if(!v.defaultSelected){d.value=l(v.modelValue)??null;return}d.value=(v.openLocalStorage?l(localStorage.getItem("modelId")??""):null)??l(v.modelValue)??null,d.value&&n(d.value)}catch(l){console.error("Failed to load key templates:",l)}finally{x.value=!1}}}async function L(){if(!d.value||!p.value||!B.value)return;await _e(),document.querySelector(`[data-model-id="${d.value.id}"]`)?.scrollIntoView({behavior:"smooth",block:"center"})}function z(l){const a=new Set(U.value);a.has(l)?a.delete(l):a.add(l),U.value=a}return me(p,l=>{l&&L()}),oe(()=>{F()}),(l,a)=>{const m=ae,K=te,O=le,j=se,_=fe,r=Ve,E=Se,S=$e;return f(),I(S,{open:e(p),"onUpdate:open":a[3]||(a[3]=s=>Z(p)?p.value=s:null),disabled:v.disabled},{content:i(()=>[c("div",je,[c("div",Ee,[t(j,{required:!1},{default:i(()=>[t(O,{modelValue:e(o),"onUpdate:modelValue":a[2]||(a[2]=s=>Z(o)?o.value=s:null),placeholder:e(h)("common.placeholder.searchKey"),size:"sm",class:"w-full",ui:{base:"bg-muted/30 border-border/50 focus:border-primary/50 focus:ring-primary/20"}},{leading:i(()=>[t(m,{name:"i-lucide-search",class:"text-muted-foreground h-4 w-4"})]),_:1},8,["modelValue","placeholder"])]),_:1})]),c("div",Ne,[t(E,{ref_key:"scrollAreaRef",ref:B,class:"max-h-[400px] min-h-[200px] px-2 pb-2",type:"hover",shadow:!1},{default:i(()=>[e(x)?(f(),g("div",Ge,[t(m,{name:"i-lucide-loader-2",class:"mb-2 h-6 w-6 animate-spin"}),c("span",Je,y(e(h)("common.loading")),1)])):T("",!0),e(C).length?(f(),g("div",We,[(f(!0),g(N,null,Q(e(C),s=>(f(),g(N,{key:s.id},[((s.secretConfigs||s.Secrets)?.length||0)>0?(f(),g("div",Xe,[c("div",{class:"group hover:bg-muted/50 flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors",onClick:b=>z(s.id)},[t(_,{src:s.icon,alt:"icon",class:"h-4 w-4 flex-none"},null,8,["src"]),c("span",eo,y(s.name),1),c("div",oo,[c("span",null,"("+y((s.secretConfigs||s.Secrets)?.length||0)+")",1),t(r,{color:s.isEnabled===1?"success":"neutral",variant:"solid",size:"xs"},null,8,["color"])]),t(m,{name:e(U).has(s.id)?"i-lucide-chevron-down":"i-lucide-chevron-right",class:"text-muted-foreground h-3 w-3 transition-transform duration-150"},null,8,["name"])],8,Ye),t(ve,{"enter-active-class":"transition-all duration-150 ease-out","enter-from-class":"opacity-0 -translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-1"},{default:i(()=>[e(U).has(s.id)?(f(),g("div",to,[(f(!0),g(N,null,Q(s.secretConfigs||s.Secrets||[],b=>(f(),g("div",{key:b.id,"data-model-id":b.id,class:q(["group/key hover:bg-muted/30 hover:text-foreground flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors",{"bg-primary/10 text-primary":e(d)?.id===b.id}]),onClick:R=>n(b)},[t(m,{name:"i-lucide-file-key-2",class:q(["h-4 w-4 flex-none",{"text-primary":e(d)?.id===b.id,"text-muted-foreground/70":e(d)?.id!==b.id}])},null,8,["class"]),c("span",lo,y(b.name),1),t(r,{color:b.status===1?"success":"neutral",variant:"solid",size:"xs"},null,8,["color"]),e(d)?.id===b.id?(f(),I(m,{key:0,name:"i-lucide-check",class:"text-primary h-3 w-3"})):T("",!0)],10,ao))),128))])):T("",!0)]),_:2},1024)])):T("",!0)],64))),128))])):(f(),g("div",Ze,[t(m,{name:"i-lucide-database",class:"mb-3 h-8 w-8 opacity-50"}),c("span",He,y(e(o)?e(h)("common.noSearchResults"):e(h)("common.empty")),1),c("span",Qe,y(e(o)?e(h)("common.tryOtherKeywords"):e(h)("common.noAvailableKeyPool")),1)]))]),_:1},512)])])]),default:i(()=>[t(K,pe({color:e(d)?"primary":"neutral",variant:"ghost",class:["flex w-full items-center justify-between",{"bg-primary/10":e(d)?.id}],loading:e(x),disabled:v.disabled},v.buttonUi,{onClick:a[1]||(a[1]=H(()=>{},["stop"]))}),{default:i(()=>[c("span",{class:q(["truncate",{"text-muted-foreground":!e(V)}])},y(e(V)||e(h)("common.placeholder.keySelect")),3),c("div",Oe,[e(d)&&v.console?(f(),I(m,{key:0,name:"i-lucide-x",class:"h-4 w-4",onClick:a[0]||(a[0]=H(s=>n(null),["stop"]))})):T("",!0),t(m,{name:"i-lucide-chevron-down",class:q(["h-4 w-4",{"rotate-180":e(p)}])},null,8,["class"])])]),_:1},16,["color","class","loading","disabled"])]),_:1},8,["open","disabled"])}}}),ro={key:0,class:"flex items-center justify-center",style:{height:"400px"}},no={class:"pb-2"},io={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},co={class:"space-y-4"},uo={class:"grid grid-cols-1 gap-4 pb-2 md:grid-cols-2"},mo={class:"space-y-4"},po={class:"flex h-8 items-center"},fo={class:"pb-2"},vo={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},dt=X({__name:"edit",props:{id:{}},emits:["close"],async setup(P,{emit:D}){let v,$;const h=P,x=D,p=A(()=>h.id||B.query.id||null),{t:o}=Y(),d=ge(),B=be(),w=ye(),U=k([]),C=k([]),V=he(null),M=ee("formRef"),n=xe({provider:"",name:"",bindSecretId:"",websiteUrl:"",iconUrl:"",description:"",isActive:!0,sortOrder:0,supportedModelTypes:[]}),F=Fe({provider:J().required(o("ai-provider.backend.form.providerRequired")),name:J().required(o("ai-provider.backend.form.nameRequired")),bindSecretId:J().required(o("ai-provider.backend.form.apiKeyRequired")),supportedModelTypes:Le().min(1,o("ai-provider.backend.form.supportedModelTypesRequired"))}),{data:L}=([v,$]=we(()=>ke("model-types",()=>Re())),v=await v,$(),v);C.value=L.value||[];const{lockFn:z,isLock:l}=W(async()=>{try{const _=await qe(p.value);V.value=_,U.value=_.supportedModelTypes,ze(n,_)}catch(_){console.error("获取供应商详情失败:",_)}}),a=A({get:()=>String(n.isActive),set:_=>{n.isActive=_==="true"}});function m(){w.push({path:Ke("secret:list")})}function K(){M.value?.validate?.()}const{lockFn:O,isLock:j}=W(async()=>{try{p.value?(await Pe(p.value,n),d.success(o("console-common.messages.success"))):(await De(n),d.success(o("console-common.messages.success"))),x("close",!0)}catch(_){console.error("提交失败:",_)}});return oe(async()=>p.value&&await z()),(_,r)=>{const E=ae,S=le,s=se,b=Ue,R=te,re=so,ne=Te,ie=Ae,de=Ie,ce=Be,ue=Me;return f(),I(ue,{title:e(p)?e(o)("ai-provider.backend.editTitle"):e(o)("ai-provider.backend.addTitle"),description:e(p)?e(o)("ai-provider.backend.form.editDescription"):e(o)("ai-provider.backend.form.addDescription"),ui:{content:"max-w-2xl"},onClose:r[11]||(r[11]=u=>x("close"))},{default:i(()=>[e(l)?(f(),g("div",ro,[t(E,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):(f(),I(ce,{key:1,ref_key:"formRef",ref:M,state:e(n),schema:e(F),onSubmit:e(O)},{default:i(()=>[c("div",no,[c("div",io,[t(s,{label:e(o)("ai-provider.backend.form.provider"),name:"provider",required:""},{default:i(()=>[t(S,{disabled:e(V)?.isBuiltIn,modelValue:e(n).provider,"onUpdate:modelValue":r[0]||(r[0]=u=>e(n).provider=u),placeholder:e(o)("ai-provider.backend.form.providerPlaceholder"),ui:{root:"w-full"}},null,8,["disabled","modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e(o)("ai-provider.backend.form.name"),name:"name",required:""},{default:i(()=>[t(S,{modelValue:e(n).name,"onUpdate:modelValue":r[1]||(r[1]=u=>e(n).name=u),placeholder:e(o)("ai-provider.backend.form.namePlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e(o)("ai-provider.backend.form.iconUrl"),name:"iconUrl"},{default:i(()=>[t(b,{modelValue:e(n).iconUrl,"onUpdate:modelValue":r[2]||(r[2]=u=>e(n).iconUrl=u),class:"h-24 w-24",text:e(o)("console-common.uploadIcon"),icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1},null,8,["modelValue","text"])]),_:1},8,["label"]),c("div",co,[t(s,{label:e(o)("ai-provider.backend.form.websiteUrl"),name:"websiteUrl"},{default:i(()=>[t(S,{modelValue:e(n).websiteUrl,"onUpdate:modelValue":r[3]||(r[3]=u=>e(n).websiteUrl=u),placeholder:e(o)("ai-provider.backend.form.websiteUrlPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e(o)("ai-provider.backend.form.sortOrder"),name:"sortOrder"},{default:i(()=>[t(S,{modelValue:e(n).sortOrder,"onUpdate:modelValue":r[4]||(r[4]=u=>e(n).sortOrder=u),type:"number",placeholder:e(o)("ai-provider.backend.form.sortOrderPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])]),c("div",uo,[c("div",mo,[t(s,{label:"API 配置",name:"bindSecretId",required:""},{hint:i(()=>[t(R,{variant:"link",class:"cursor-pointer gap-0","trailing-icon":"i-lucide-arrow-right",ui:{trailingIcon:"size-4",base:"p-0"},onClick:r[5]||(r[5]=u=>m())},{default:i(()=>[G(y(e(o)("ai-provider.backend.form.goToApiKeyManage")),1)]),_:1})]),default:i(()=>[t(re,{modelValue:e(n).bindSecretId,"onUpdate:modelValue":r[6]||(r[6]=u=>e(n).bindSecretId=u),"button-ui":{variant:"outline",color:"neutral",ui:{base:"w-full"},class:"bg-background"},onChange:K},null,8,["modelValue"])]),_:1})]),t(s,{label:e(o)("ai-provider.backend.form.isActive"),name:"isActive"},{default:i(()=>[c("div",po,[t(ne,{class:"my-2",modelValue:e(a),"onUpdate:modelValue":r[7]||(r[7]=u=>Z(a)?a.value=u:null),items:[{label:e(o)("ai-provider.backend.form.isActiveEnabled"),value:"true"},{label:e(o)("ai-provider.backend.form.isActiveDisabled"),value:"false"}],orientation:"horizontal",color:"primary"},null,8,["modelValue","items"])])]),_:1},8,["label"])]),t(s,{label:e(o)("ai-provider.backend.form.modelType"),name:"supportedModelTypes",required:""},{default:i(()=>[t(ie,{disabled:e(V)?.isBuiltIn,modelValue:e(n).supportedModelTypes,"onUpdate:modelValue":r[8]||(r[8]=u=>e(n).supportedModelTypes=u),"open-on-click":"",multiple:"","value-key":"value",items:e(C),ui:{root:"w-full"}},null,8,["disabled","modelValue","items"])]),_:1},8,["label"]),c("div",fo,[t(s,{label:e(o)("ai-provider.backend.form.description"),name:"description"},{default:i(()=>[t(de,{modelValue:e(n).description,"onUpdate:modelValue":r[9]||(r[9]=u=>e(n).description=u),placeholder:e(o)("ai-provider.backend.form.descriptionPlaceholder"),rows:3,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),c("div",vo,[t(R,{color:"neutral",variant:"soft",size:"lg",onClick:r[10]||(r[10]=u=>x("close"))},{default:i(()=>[G(y(e(o)("console-common.cancel")),1)]),_:1}),t(R,{color:"primary",size:"lg",type:"submit",loading:e(j)},{default:i(()=>[G(y(e(p)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"]))]),_:1},8,["title","description"])}}});export{dt as default};
