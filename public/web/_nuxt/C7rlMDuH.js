const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BpWKzIts.js","./D-yR6Fj9.js","./CDmbk8fH.js","./Dn8X9Gvz.js","./DlAUqK2U.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./b-_TUx9i.js","./B22A-h4k.js","./Cfcu-t3n.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./XpsTG8vq.js"])))=>i.map(i=>d[i]);
import{d as H,b as P,aq as G,e as K,aN as Q,Q as J,s as x,a1 as W,g as X,w as Y,i as Z,ah as ee,c as _,o as c,l as n,k as p,q as a,y as te,v as u,p as s,_ as oe,j as C,x as se,aa as ae,t as y,F as ne,aO as le,A as ce,G as re,R as ie,U as de}from"#entry";import{_ as ue}from"./Bu7cOM_l.js";import{_ as fe}from"./Bfc6LCc8.js";import{_ as me,a as _e}from"./l1H0tvBk.js";import{_ as pe}from"./D-yR6Fj9.js";import{_ as ge}from"./D-XbLhx8.js";import{f as he}from"./BDS0FVMi.js";const ve={class:"flex h-full w-full flex-col"},xe={class:"flex items-center justify-between p-4"},ye={class:"flex items-center gap-3"},we={class:"text-lg font-semibold"},ke={class:"flex h-full min-h-0 flex-1 flex-col"},Ce={key:0,class:"flex h-full items-center justify-center"},Me={class:"text-muted-foreground flex items-center gap-2 text-sm"},be={key:1,class:"flex h-full items-center justify-center"},Be={class:"text-muted-foreground text-center"},Ae={class:"my-2 flex items-center gap-1"},Re={class:"text-muted-foreground flex-none text-xs"},Ee={key:1,class:"mt-2 flex items-center gap-1"},Ie={class:"text-muted-foreground flex-none text-xs"},je=H({__name:"chat-record-modal",props:{open:{type:Boolean},recordId:{},agentId:{}},emits:["update:open"],setup(A,{emit:R}){const E=ie(()=>de(()=>import("./BpWKzIts.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),f=A,I=R,{t:r}=P(),T=G(),m=K("scrollAreaRef"),{height:$}=Q(m),S=J(),i=x([]),d=x(!1),g=W({page:1,pageSize:20}),h=x(!1),M=x(!0),z=ae("agents"),v=X({get:()=>f.open,set:o=>I("update:open",o)}),w=o=>{const e=o.target,l=40;M.value=e.scrollHeight-(e.scrollTop+e.clientHeight)<=l},b=async(o=!1)=>{if(f.recordId){o&&(g.page=1,i.value=[]),d.value=!0;try{const e=await he(f.recordId,g),l=(e.items||[]).reverse();i.value=o?l:[...l,...i.value],h.value=e.total>i.value.length}catch(e){console.error("加载消息失败:",e)}finally{d.value=!1}}},U=async()=>{if(!(!h.value||d.value)){g.page++;try{await b(!1)}catch{g.page--,h.value=!0}}},k=async(o=!0)=>{await re(),console.log("scrollToBottom",m.value),m.value?.scrollToBottom(o)},V=o=>{S.create(E).open({context:o})};return Y(()=>[f.recordId,f.open],async([o,e])=>{e&&o&&(await b(!0),await k(!1))},{immediate:!0}),Z(()=>{const o=m.value?.getViewportElement()?.viewportElement;if(o){o.addEventListener("scroll",w,{passive:!0}),w({target:o});const e=new MutationObserver(()=>{M.value&&k(!1)});e.observe(o,{childList:!0,subtree:!0,characterData:!0}),ee(()=>{o.removeEventListener("scroll",w),e.disconnect()})}}),(o,e)=>{const l=te,O=oe,B=ue,j=le("KnowledgeReferenceFiles"),L=fe,N=_e,D=me,F=pe,q=ge;return c(),_("div",null,[n(q,{open:s(v),"onUpdate:open":e[2]||(e[2]=t=>ce(v)?v.value=t:null),"set-background-color-on-scale":!1,direction:"right","should-scale-background":"","handle-only":!0,class:"bg-muted w-full max-w-xl"},{content:p(()=>[a("div",ve,[a("div",xe,[a("div",ye,[n(l,{name:"i-lucide-message-circle",class:"text-primary size-5"}),a("h2",we,u(s(r)("ai-agent.backend.logs.dialogMessage")),1)]),n(O,{icon:"i-lucide-x",color:"neutral",variant:"ghost",onClick:e[0]||(e[0]=t=>v.value=!1)})]),a("div",ke,[s(d)&&s(i).length===0?(c(),_("div",Ce,[a("div",Me,[n(l,{name:"i-lucide-loader-2",class:"size-4 animate-spin"}),se(" "+u(s(r)("console-ai-agent.logs.loadingMessages")),1)])])):!s(d)&&s(i).length===0?(c(),_("div",be,[a("div",Be,[n(l,{name:"i-lucide-message-circle-x",class:"mx-auto mb-2 size-12"}),a("p",null,u(s(r)("console-ai-agent.logs.noMessages")),1)])])):(c(),C(F,{key:2,class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:m,onInView:e[1]||(e[1]=t=>k(!1))},{default:p(()=>[n(D,{loading:s(d),"has-more":s(h),threshold:500,"content-class":"max-w-full w-full space-y-3 px-4",onLoadMore:U},{default:p(()=>[n(N,{messages:s(i),"scroll-area-height":s($),assistant:{actions:[{label:s(r)("console-ai-agent.configuration.chatContext"),icon:"i-lucide-file-type",show:!s(z)?.value?.showContext,onClick:t=>{t?.metadata?.context?V(t.metadata.context):s(T).error(s(r)("console-ai-agent.configuration.noChatContext"))}}]},"spacing-offset":160},{content:p(({message:t})=>[t.content.length||t.metadata?.references&&t.metadata.references.length?(c(),C(L,{key:0,content:t.content.toString(),class:"mb-2"},{after:p(()=>[t.metadata?.references&&t.metadata.references.length>0&&t.role==="assistant"?(c(),_(ne,{key:0},[a("div",Ae,[a("span",Re,u(s(r)("console-ai-agent.configuration.referenceTitle")),1),t.metadata?.references&&t.metadata.references.length>0&&t.role==="assistant"?(c(),C(B,{key:0,size:"xs",type:"dashed"})):y("",!0)]),n(j,{references:t.metadata.references},null,8,["references"])],64)):y("",!0),t.metadata?.annotations&&t.role==="assistant"?(c(),_("div",Ee,[a("span",Ie,u(t.metadata?.annotations?.createdBy)+" "+u(s(r)("console-ai-agent.configuration.editedAnswer")),1),n(B,{size:"xs",type:"dashed"})])):y("",!0)]),_:2},1032,["content"])):y("",!0)]),_:1},8,["messages","scroll-area-height","assistant"])]),_:1},8,["loading","has-more"])]),_:1},512))])])]),_:1},8,["open"])])}}});export{je as _};
