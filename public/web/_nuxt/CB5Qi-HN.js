import{d as xe,ar as ye,b as ke,aI as we,g as C,au as Ce,aY as Se,aZ as Ue,s as $e,w as F,H as ze,i as Ie,c as p,o as d,q as t,l as s,p as e,_ as De,k as _,j as y,t as h,v as n,x as k,y as Ve,b6 as Ae,F as T,B as E,aT as je,z as Be}from"#entry";import{_ as Ne}from"./CRoF6I1E.js";import{_ as Pe}from"./CQBV3TNh.js";import{_ as Le}from"./COxNVqQJ.js";import{_ as Fe}from"./ptVgWJmt.js";import{_ as Te}from"./DduSJdeS.js";import{_ as Ee}from"./B-uid8Vg.js";import Re from"./BruVSCWF.js";import{_ as Me}from"./DGIb7fSK.js";import{_ as qe}from"./Cif_tCX1.js";import{_ as Ge}from"./5XG8SC4l.js";import{_ as Oe}from"./BNWstlnh.js";import{_ as Qe}from"./i5AwkGQh.js";import{_ as Ze}from"./DiYXikHi.js";import{_ as He}from"./CTfStZur.js";import{a as Ke,f as Ye}from"./BV27uQF0.js";import{l as Je,m as We,n as Xe,o as et}from"./DRV5AIQP.js";import{u as tt,a as ot,b as st}from"./WiAgtKD8.js";import{u as at}from"./BJ10eFuk.js";import{u as nt}from"./JqIoTTmi.js";import{u as lt}from"./CIZXtYrT.js";import"./DHFmmngs.js";import"./CR1AS2Ry.js";import"./Btvd554H.js";import"./BPKB8n-W.js";import"./B-DdbQ-X.js";import"./V9POJiZu.js";import"./MN31c9CG.js";import"./BstbYvQo.js";import"./DuSMYVIA.js";import"./BFVs1AfH.js";import"./kRIii9yh.js";import"./C6Y-ieo6.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./3UOIlTK8.js";import"./CgMDXot0.js";import"./DVnbt8cp.js";import"./C3zg6GHm.js";import"./BgHJjJs-.js";import"./VGKgjfSv.js";import"./Ctr0lhsh.js";import"./eVnJMZM-.js";import"./BcsO9TDZ.js";import"./DlAUqK2U.js";import"./BREwXy1w.js";import"./BzLCLO6P.js";const it={class:"flex h-full w-full flex-col"},ct={class:"flex items-center justify-between gap-1 p-4"},dt={class:"flex w-full items-center"},rt={class:"flex items-center gap-2"},mt={class:"pl-4"},ut={class:"bg-background mb-2 flex w-full justify-between gap-4 p-4 pl-6"},pt={class:"flex items-center gap-3"},_t={class:"text-sm font-semibold"},ft={class:"flex items-center gap-2 md:ml-auto"},ht={key:0,class:"bg-background flex h-full items-center justify-center"},gt={class:"text-center"},bt={class:"text-muted-foreground text-sm"},vt={class:"flex h-full flex-1"},xt={class:"pt-3"},yt={class:"hover:bg-elevated/50 w-full rounded-lg p-3 transition-all duration-200"},kt={class:"mb-1 flex items-start justify-between"},wt={class:"flex items-center gap-2"},Ct={class:"flex items-center gap-1 text-xs font-medium"},St={class:"text-xs"},Ut={class:"flex items-center gap-2"},$t={class:"flex items-center gap-2"},zt={class:"mr-2 text-xs"},It={key:0,class:"p-4"},Dt={class:"mb-3 flex"},Vt={class:"grid gap-2"},At={key:0,class:"w-100 overflow-hidden px-6"},jt={class:"mb-4"},Bt={class:"text-foreground text-lg font-semibold"},Nt={key:0,class:"space-y-4"},Pt={class:"space-y-4"},Lt={class:"items-centsr flex gap-2"},Ft={class:"text-foreground truncate font-medium"},Tt={class:"space-y-4 text-xs"},Et={class:"flex justify-between"},Rt={class:"text-muted-foreground"},Mt={class:"text-foreground"},qt={class:"flex justify-between"},Gt={class:"text-muted-foreground"},Ot={class:"text-foreground"},Qt={class:"flex justify-between"},Zt={class:"text-muted-foreground"},Ht={class:"text-foreground"},Kt={class:"flex justify-between"},Yt={class:"text-muted-foreground"},Jt={class:"text-foreground"},Wt={class:"flex justify-between"},Xt={class:"text-muted-foreground"},eo={class:"text-foreground"},to={class:"flex items-center justify-between"},oo={class:"text-foreground text-xs font-medium"},so={class:"flex items-center gap-2"},ao={key:0,class:"text-muted-foreground text-sm"},no={key:0,class:"flex flex-col"},lo={class:"text-foreground text-xs font-medium"},io={class:"bg-muted mt-2 rounded-md p-3"},co={class:"text-error text-xs"},ro={class:"space-y-2"},mo={class:"bg-muted rounded-md p-2"},uo={class:"text-muted-foreground font-mono text-xs break-all"},po={key:1,class:"flex items-center justify-center py-8"},_o={class:"text-center"},fo={class:"text-muted-foreground text-sm"},ho={class:"flex items-center justify-end p-4"},ms=xe({__name:"segments",async setup(go){let w,D;const S=ye(),{t:a}=ke(),{hasAccessByCodes:V}=at(),{params:R,query:M}=we(),U=C(()=>R.id),q=C({get:()=>M.documentId,set:l=>{S.replace({query:{documentId:l}}),r.documentId=l,u()}}),{deleteDocument:G,renameDocument:O}=tt(),{deleteSegments:Q,createSegment:Z,editSegment:H}=ot(),{data:$,refresh:K}=([w,D]=Se(()=>Ue(()=>et(U.value),"$lh_gmRPt7Z")),w=await w,D(),w),r=Ce({keyword:"",documentId:q.value,datasetId:U.value,status:void 0}),v=$e(!0),{paging:c,getLists:u}=nt({fetchFun:Je,params:r}),{start:Y,clear:J}=lt(async l=>{await u(),c.needPolling||l()},{interval:1e3});F(()=>c.needPolling,l=>{l?Y():J()},{immediate:!0});const{selected:g,isAll:W,isIndeterminate:X,toggle:ee,toggleAll:te,clear:A}=st(C(()=>c?.items||[]),l=>l.id),b={processing:{label:a("console-common.processing"),color:"warning"},completed:{label:a("console-common.completed"),color:"success"},failed:{label:a("console-common.failed"),color:"error"},pending:{label:a("console-common.pending"),color:"neutral"}},oe=[{label:a("console-common.all"),value:void 0},{label:a("console-common.processing"),value:"processing"},{label:a("console-common.completed"),value:"completed"},{label:a("console-common.failed"),value:"failed"},{label:a("console-common.pending"),value:"pending"}];F(()=>[r.keyword,r.documentId,r.status],()=>{ze(()=>{c.page=1,u()},300)()},{deep:!1,immediate:!1});const j=async l=>{await Q(l,u),A()},se=async()=>{await Z(r.documentId,u)},ae=async l=>{await H(l,u)},ne=async()=>{await G(r.documentId,u),S.back()},le=async()=>{const l=$.value?.find(i=>i.id===r.documentId);await O(l,u),K()};async function ie(l){await We(l.id,l.enabled?0:1),u()}async function B(l){await Xe(Array.from(g.value),l),A(),u()}const m=C(()=>$.value?.find(l=>l.id===r.documentId));return Ie(()=>u()),(l,i)=>{const f=De,ce=Ne,de=Pe,N=Le,P=Fe,re=Te,me=Ee,ue=Re,L=Me,z=Ve,pe=Ae,I=qe,_e=Ge,fe=je,x=Oe,he=Qe,ge=Ze,be=He;return d(),p("div",it,[t("div",ct,[t("div",dt,[s(f,{variant:"ghost",color:"neutral",class:"rounded-full","leading-icon":"i-lucide-chevron-left",onClick:i[0]||(i[0]=o=>e(S).replace(`/console/datasets/${e(U)}/documents`))}),s(ce,{modelValue:e(r).documentId,"onUpdate:modelValue":i[1]||(i[1]=o=>e(r).documentId=o),items:e($)?.map(o=>({label:o.fileName,value:o.id}))||[],"label-key":"label","value-key":"value",variant:"none"},null,8,["modelValue","items"])]),t("div",rt,[s(f,{color:"primary",variant:"outline",icon:"i-lucide-plus",label:e(a)("ai-datasets.backend.segments.createSegment"),onClick:se},null,8,["label"]),s(de,{items:[e(V)(["ai-datasets-documents:rename"])?{label:e(a)("ai-datasets.backend.segments.rename"),icon:"i-lucide-pen-line",onClick:()=>{le()}}:null,e(V)(["ai-datasets-documents:delete"])?{label:e(a)("console-common.delete"),icon:"i-lucide-trash",color:"error",onSelect:()=>{ne()}}:null].filter(Boolean)},{default:_(()=>[s(f,{icon:"i-lucide-ellipsis-vertical",color:"primary",variant:"outline"})]),_:1},8,["items"])])]),t("div",mt,[s(N)]),t("div",ut,[t("div",pt,[s(P,{"model-value":e(W),indeterminate:e(X),"onUpdate:modelValue":e(te)},null,8,["model-value","indeterminate","onUpdate:modelValue"]),t("span",_t,n(e(c).total)+" "+n(e(a)("ai-datasets.backend.segments.segment")),1),e(g).size>0?(d(),y(f,{key:0,color:"error",variant:"subtle",label:e(a)("console-common.batchDelete"),icon:"i-heroicons-trash",onClick:i[2]||(i[2]=o=>j(Array.from(e(g))))},{trailing:_(()=>[s(re,null,{default:_(()=>[k(n(e(g).size),1)]),_:1})]),_:1},8,["label"])):h("",!0),e(g).size>0?(d(),y(f,{key:1,color:"success",variant:"subtle",label:e(a)("console-common.batchEnable"),icon:"i-heroicons-arrow-up-tray",onClick:i[3]||(i[3]=o=>B(1))},null,8,["label"])):h("",!0),e(g).size>0?(d(),y(f,{key:2,color:"error",variant:"subtle",label:e(a)("console-common.batchDisable"),icon:"i-heroicons-arrow-down-tray",onClick:i[4]||(i[4]=o=>B(0))},null,8,["label"])):h("",!0)]),t("div",ft,[s(me,{modelValue:e(r).status,"onUpdate:modelValue":i[5]||(i[5]=o=>e(r).status=o),items:oe,placeholder:e(a)("console-common.status"),class:"w-30","value-key":"value"},null,8,["modelValue","placeholder"]),s(ue,{modelValue:e(r).keyword,"onUpdate:modelValue":i[6]||(i[6]=o=>e(r).keyword=o),placeholder:e(a)("ai-datasets.backend.segments.searchPlaceholder"),class:"w-50",icon:"i-lucide-search"},null,8,["modelValue","placeholder"]),s(N,{orientation:"vertical",class:"h-5"}),s(L,{text:e(v)?e(a)("ai-datasets.backend.segments.expandAll"):e(a)("ai-datasets.backend.segments.collapseAll"),delayDuration:0},{default:_(()=>[s(f,{variant:"soft",icon:e(v)?"i-lucide-list-plus":"i-lucide-list-x",onClick:i[7]||(i[7]=o=>v.value=!e(v))},null,8,["icon"])]),_:1},8,["text"])])]),s(pe,null,{default:_(()=>[!e(c).loading&&e(c).items.length===0?(d(),p("div",ht,[t("div",gt,[s(z,{name:"i-lucide-file-text",class:"text-muted-foreground mx-auto mb-4 h-12 w-12"}),t("p",bt,n(e(a)("ai-datasets.backend.segments.noData")),1)])])):h("",!0)]),_:1}),t("div",vt,[s(he,{class:"table h-full w-full px-6"},{default:_(()=>[(d(!0),p(T,null,E(e(c).items,o=>(d(),p("div",{key:o.id,class:"group relative mb-2 flex items-stretch gap-4"},[t("div",xt,[s(P,{"model-value":e(g).has(o.id),"onUpdate:modelValue":()=>e(ee)(o.id)},null,8,["model-value","onUpdate:modelValue"])]),t("div",yt,[t("div",kt,[t("div",wt,[t("div",Ct,[s(z,{name:"i-lucide-grip",class:"size-3"}),k(" Chunks #"+n(o.chunkIndex+1),1)]),t("div",St,n(o.contentLength)+" character",1),o.status==="failed"?(d(),y(L,{key:0,text:o?.error,"delay-duration":0},{default:_(()=>[s(I,{color:b[o.status]?.color||"neutral",variant:"subtle",size:"sm"},{default:_(()=>[k(n(b[o.status]?.label||o.status),1)]),_:2},1032,["color"])]),_:2},1032,["text"])):(d(),y(I,{key:1,color:b[o.status]?.color||"neutral",variant:"subtle",size:"sm"},{default:_(()=>[k(n(b[o.status]?.label||o.status),1)]),_:2},1032,["color"]))]),t("div",Ut,[s(f,{icon:"i-lucide-pen-line",color:"neutral",variant:"ghost",size:"sm",class:"opacity-0 transition-opacity group-hover:opacity-100",onClick:ve=>ae(o)},null,8,["onClick"]),s(f,{icon:"i-lucide-trash",color:"error",variant:"ghost",size:"sm",class:"opacity-0 transition-opacity group-hover:opacity-100",onClick:ve=>j(o.id)},null,8,["onClick"]),s(_e,{class:"opacity-0 transition-opacity group-hover:opacity-100","model-value":o.enabled===1,color:"success","onUpdate:modelValue":()=>ie(o)},null,8,["model-value","onUpdate:modelValue"]),t("div",$t,[s(fe,{color:o.enabled===0?"error":"success",standalone:"",inset:""},{default:_(()=>[t("span",zt,n(o.enabled===0?e(a)("ai-datasets.backend.common.disabled"):e(a)("ai-datasets.backend.common.enabled")),1)]),_:2},1032,["color"])])])]),t("div",{class:Be(["text-foreground text-xs leading-normal tracking-wide whitespace-pre-wrap",{"line-clamp-2":e(v)}])},n(o.content),3)])]))),128)),e(c).loading&&e(c).items.length===0?(d(),p("div",It,[(d(),p(T,null,E(20,o=>t("div",{key:o,class:"mb-6"},[t("div",Dt,[s(x,{class:"size-3"}),s(x,{class:"ml-1 h-3 w-12"}),s(x,{class:"ml-6 h-3 w-12"})]),t("div",Vt,[s(x,{class:"h-3 w-full"}),s(x,{class:"h-3 w-full"})])])),64))])):h("",!0)]),_:1}),e(c).items.length?(d(),p("div",At,[t("div",jt,[t("h3",Bt,n(e(a)("ai-datasets.backend.documents.table.fileName")),1)]),e(m)?(d(),p("div",Nt,[t("div",Pt,[t("div",Lt,[s(f,{icon:"i-lucide-file-text",color:"neutral",variant:"outline",size:"sm"}),t("span",Ft,n(e(m).fileName),1)]),t("div",Tt,[t("div",Et,[t("span",Rt,n(e(a)("ai-datasets.backend.documents.table.fileSize"))+":",1),t("span",Mt,n(("formatFileSize"in l?l.formatFileSize:e(Ke))(e(m).fileSize)),1)]),t("div",qt,[t("span",Gt,n(e(a)("ai-datasets.backend.documents.table.fileType"))+": ",1),t("span",Ot,n(e(m).fileType),1)]),t("div",Qt,[t("span",Zt,n(e(a)("ai-datasets.backend.documents.table.chunkCount"))+": ",1),t("span",Ht,n(e(m).chunkCount),1)]),t("div",Kt,[t("span",Yt,n(e(a)("ai-datasets.backend.documents.table.characterCount"))+": ",1),t("span",Jt,n(("formatCompactNumber"in l?l.formatCompactNumber:e(Ye))(e(m).characterCount)),1)]),t("div",Wt,[t("span",Xt,n(e(a)("ai-datasets.backend.documents.table.createdAt"))+": ",1),t("span",eo,[s(ge,{datetime:e(m).createdAt,mode:"datetime"},null,8,["datetime"])])])])]),t("div",to,[t("h4",oo,n(e(a)("console-common.status")),1),t("div",so,[s(I,{color:b[e(m).status]?.color||"neutral",variant:"subtle"},{default:_(()=>[k(n(b[e(m).status]?.label||e(m).status),1)]),_:1},8,["color"]),e(m).progress!==void 0?(d(),p("span",ao,n(e(m).progress)+"% ",1)):h("",!0)])]),e(m).error?(d(),p("div",no,[t("h4",lo,n(e(a)("console-common.error")),1),t("div",io,[t("p",co,n(e(m).error||"-"),1)])])):h("",!0),t("div",ro,[i[10]||(i[10]=t("h4",{class:"text-foreground text-xs font-medium"},"文档 ID",-1)),t("div",mo,[t("p",uo,n(e(m).id),1)])])])):(d(),p("div",po,[t("div",_o,[s(z,{name:"i-lucide-file-text",class:"text-muted-foreground mx-auto mb-2 h-8 w-8"}),t("p",fo,n(e(a)("console-common.noData")),1)])]))])):h("",!0)]),t("div",ho,[s(be,{page:e(c).page,"onUpdate:page":i[8]||(i[8]=o=>e(c).page=o),size:e(c).pageSize,"onUpdate:size":i[9]||(i[9]=o=>e(c).pageSize=o),total:e(c).total,onChange:e(u)},null,8,["page","size","total","onChange"])])])}}});export{ms as default};
