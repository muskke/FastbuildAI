import{d as L,ap as R,aI as Y,g as G,b as K,au as Q,aJ as V,i as W,j as $,o as h,k as i,c as X,p as e,l as s,y as Z,q as m,D as S,x as k,bF as ee,v,_ as ae,E as I}from"#entry";import{_ as oe}from"./ql0_WxJN.js";import{_ as te}from"./DS-TE4M7.js";import re from"./BruVSCWF.js";import{_ as se}from"./CRoF6I1E.js";import ie from"./Dg6D3RQ3.js";import{_ as le}from"./DZjlY_x0.js";import{_ as ne}from"./D-6Co9ha.js";import{_ as me}from"./C7UmhjTd.js";import{_ as ce}from"./CXUt0j5Y.js";import{d as de,e as pe,f as ue,g as fe}from"./D9F45f3T.js";import{c as T,a as j}from"./BUyfW8JT.js";import"./BdImEx5p.js";import"./oFTPHjuc.js";import"./BcsO9TDZ.js";import"./DlAUqK2U.js";import"./BgHJjJs-.js";import"./DHFmmngs.js";import"./CR1AS2Ry.js";import"./Btvd554H.js";import"./BPKB8n-W.js";import"./B-DdbQ-X.js";import"./V9POJiZu.js";import"./MN31c9CG.js";import"./BstbYvQo.js";import"./DuSMYVIA.js";import"./BwAI6jgh.js";import"./BP0i4hNs.js";import"./CgMDXot0.js";import"./C6Y-ieo6.js";import"./BFVs1AfH.js";import"./kRIii9yh.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./3UOIlTK8.js";import"./-Eb02sIQ.js";import"./Dk6FGhu1.js";import"./CCcv9mzY.js";import"./BFAo_s2U.js";import"./Cb04SOqd.js";import"./VGKgjfSv.js";import"./DaWZu8wl.js";const be={key:0,class:"flex items-center justify-center",style:{height:"400px"}},ve={class:"pb-2"},_e={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ye={class:"space-y-4"},ke={class:"pb-2"},ge={class:"pb-2"},he={class:"flex items-center gap-2 text-base"},je={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ve={class:"bottom-0 z-10 flex justify-end gap-2 py-4"},$e={class:"pb-2"},we={class:"flex flex-col gap-4 p-4"},Ue={class:"flex flex-col"},xe={class:"flex flex-col items-start gap-2"},De={class:"flex items-start gap-1 rounded-lg bg-blue-50 p-2 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-200"},Se={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Ie=`{
    "mcpServers": {
        "Your MCP Server Name": {
            "url": "xxxxx",
            // type: sse or streamable-http
            "type": "sse or streamable-http",
            "headers": {
                "Content-Type": "application/json",
                "Authorization": "Bearer Your Token"
                ...
            },
            ...
        }
    }
}`,ka=L({__name:"mcp-server-edit",props:{id:{},isView:{type:Boolean},isJsonImport:{type:Boolean},isSystemMcp:{type:Boolean}},emits:["close","updateIds"],setup(b,{emit:E}){const w=R(),F=Y(),N=b,_=E,f=G(()=>N.id||F.query.id||null),{t:a}=K(),t=Q({formData:{name:"",providerName:"",providerUrl:"",description:"",icon:"",url:"",timeout:60,communicationType:void 0,customHeaders:""},isSystem:!1,jsonFormData:{jsonImport:""}}),H=T({name:j().required(a("ai-mcp.backend.form.name")),url:j().required(a("ai-mcp.backend.form.baseUrlPlaceholder")).test("is-valid-url",a("ai-mcp.backend.form.baseUrlPlaceholder"),r=>{if(!r)return!1;if(/^(https?:\/\/)?[\w\d-]+(\.[\w\d-]+)+([\w\d\-.,@?^=%&:/~+#]*[\w\d=#])?$/.test(r))return!0;try{return new URL(r),!0}catch{return!1}}),communicationType:j().required(a("ai-mcp.backend.form.communicationType"))}),C=T({jsonImport:j().required(a("ai-mcp.backend.validation.jsonRequired")).test("is-valid-json",a("ai-mcp.backend.validation.jsonFormatError"),r=>{if(!r)return!1;try{return JSON.parse(r),!0}catch{return!1}}).test("validate-required-fields",(r,o)=>{if(!r)return!0;try{const d=JSON.parse(r);if(!d.mcpServers||typeof d.mcpServers!="object")return o.createError({message:a("ai-mcp.backend.validation.missingMcpServers")});const p=d.mcpServers;if(Object.keys(p).length===0)return o.createError({message:a("ai-mcp.backend.validation.emptyMcpServers")});for(const[c,y]of Object.entries(p)){if(!y||typeof y!="object")return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.invalidConfig")}`});const u=y;if(!u.url)return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.missingUrl")}`});if(typeof u.url!="string")return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.invalidUrlType")}`});if(!u.type)return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.missingType")}`});if(typeof u.type!="string")return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.invalidTypeValue")}`});if(!["sse","streamable-http"].includes(u.type))return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.invalidTypeEnum")}`});if(u.headers!==void 0&&(typeof u.headers!="object"||u.headers===null))return o.createError({message:`"${c}" ${a("ai-mcp.backend.validation.invalidHeaders")}`})}return!0}catch{return o.createError({message:a("console-ai-mcp-server.validation.jsonFormatError")})}})}),{lockFn:q,isLock:B}=V(async()=>{try{const r=await de(f.value);Object.assign(t.formData,{name:r.name||"",providerName:r.providerName||"",providerUrl:r.url||"",description:r.description||"",icon:r.icon||"",url:r.url||"",timeout:r.timeout||60,communicationType:r.communicationType});const o=r.customHeaders;if(o!==void 0)if(typeof o=="object"&&o!==null&&!Array.isArray(o)){const d=Object.entries(o).map(([p,n])=>`${p}=${n}`).join(",");t.formData.customHeaders=d}else typeof o=="string"?t.formData.customHeaders=o:t.formData.customHeaders=""}catch(r){console.error("获取供应商详情失败:",r)}}),M=r=>{if(!r?.trim())return{};const o={};return r.split(/[,\n]/).filter(p=>p.trim()).forEach(p=>{const[n,...c]=p.split("=");if(n?.trim()&&c.length>0){const y=c.join("=");o[n.trim()]=y.trim()}}),o},{lockFn:z,isLock:U}=V(async()=>{const{customHeaders:r,...o}=t.formData,d=M(r),p={...o,customHeaders:d};try{const n=f.value?await pe(f.value,p):await ue(p);w.success(f.value?a("ai-mcp.backend.updateSuccess"):a("ai-mcp.backend.createSuccess")),_("close",!0),_("updateIds",[n.id])}catch(n){console.error("提交失败:",n)}}),{lockFn:O}=V(async()=>{try{const r=await fe(t.jsonFormData.jsonImport||""),o=[`${a("ai-mcp.backend.jsonImportTotal")} ${r.total} ${a("ai-mcp.backend.jsonImportUnit")}`,`${a("console-common.create")} ${r.created} ${a("ai-mcp.backend.jsonImportUnit")}`,`${a("console-common.update")} ${r.updated} ${a("ai-mcp.backend.jsonImportUnit")}`].join("，");w.success(o),_("close",!0),_("updateIds",r.results.map(d=>d.id))}catch(r){console.error("JSON导入失败:",r)}});return W(async()=>f.value&&await q()),(r,o)=>{const d=Z,p=oe,n=te,c=re,y=se,u=ie,x=ee,J=le,g=ae,D=ne,P=me,A=ce;return h(),$(A,{title:b.isView&&e(f)?e(a)("ai-mcp.backend.detailTitle"):e(f)?e(a)("ai-mcp.backend.editTitle"):e(a)("ai-mcp.backend.addTitle"),description:b.isView&&e(f)?e(a)("ai-mcp.backend.detailTitle"):e(f)?e(a)("ai-mcp.backend.editTitle"):e(a)("ai-mcp.backend.addTitle"),ui:{content:"max-w-2xl overflow-y-auto h-fit"},onClose:o[12]||(o[12]=l=>_("close"))},{default:i(()=>[e(B)?(h(),X("div",be,[s(d,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):b.isJsonImport?(h(),$(D,{key:2,state:e(t).jsonFormData,schema:e(C),disabled:b.isView,onSubmit:e(O)},{default:i(()=>[m("div",$e,[s(n,{label:e(a)("ai-mcp.backend.form.jsonImport"),name:"jsonImport",required:""},{hint:i(()=>[s(P,{mode:"click","open-delay":0,"close-delay":0},{content:i(()=>[m("div",we,[m("div",Ue,[m("div",xe,[m("div",De,[s(d,{size:"20",name:"i-tabler-alert-circle"}),m("span",null,v(e(a)("ai-mcp.backend.jsonImportCorrectExample")),1)]),m("pre",{class:"bg-muted w-full overflow-x-auto rounded-lg p-4 text-sm"},[m("code",null,v(Ie))])])])])]),default:i(()=>[s(g,{variant:"link",class:"text-primary cursor-pointer text-xs"},{default:i(()=>[k(v(e(a)("ai-mcp.backend.jsonImportExample")),1)]),_:1})]),_:1})]),default:i(()=>[s(u,{modelValue:e(t).jsonFormData.jsonImport,"onUpdate:modelValue":o[10]||(o[10]=l=>e(t).jsonFormData.jsonImport=l),placeholder:e(a)("ai-mcp.backend.form.jsonImportPlaceholder"),rows:13,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),S(m("div",Se,[s(g,{color:"neutral",variant:"soft",size:"lg",onClick:o[11]||(o[11]=l=>_("close"))},{default:i(()=>[k(v(e(a)("console-common.cancel")),1)]),_:1}),s(g,{color:"primary",size:"lg",type:"submit",loading:e(U)},{default:i(()=>[k(v(e(f)?e(a)("console-common.update"):e(a)("console-common.create")),1)]),_:1},8,["loading"])],512),[[I,!b.isView]])]),_:1},8,["state","schema","disabled","onSubmit"])):(h(),$(D,{key:1,state:e(t).formData,schema:e(H),disabled:b.isView,onSubmit:e(z)},{default:i(()=>[m("div",ve,[m("div",_e,[s(n,{label:e(a)("ai-mcp.backend.form.icon"),name:"iconUrl"},{default:i(()=>[s(p,{modelValue:e(t).formData.icon,"onUpdate:modelValue":o[0]||(o[0]=l=>e(t).formData.icon=l),class:"h-24 w-24",text:"上传图标",icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1,disabled:e(t).isSystem},null,8,["modelValue","disabled"])]),_:1},8,["label"]),m("div",ye,[s(n,{label:e(a)("ai-mcp.backend.form.name"),name:"name",required:""},{default:i(()=>[s(c,{modelValue:e(t).formData.name,"onUpdate:modelValue":o[1]||(o[1]=l=>e(t).formData.name=l),disabled:e(t).isSystem,placeholder:e(a)("ai-mcp.backend.form.name"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.type"),name:"communicationType",required:""},{default:i(()=>[s(y,{modelValue:e(t).formData.communicationType,"onUpdate:modelValue":o[2]||(o[2]=l=>e(t).formData.communicationType=l),placeholder:e(a)("ai-mcp.backend.form.type"),ui:{base:"w-full"},items:[{label:"sse",value:"sse"},{label:"streamable-http",value:"streamable-http"}]},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])]),m("div",ke,[s(n,{label:e(a)("ai-mcp.backend.form.baseUrl"),name:"url",required:""},{default:i(()=>[s(u,{modelValue:e(t).formData.url,"onUpdate:modelValue":o[3]||(o[3]=l=>e(t).formData.url=l),rows:1,autoresize:"",disabled:e(t).isSystem,placeholder:e(a)("ai-mcp.backend.form.url"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),m("div",ge,[s(n,{label:e(a)("ai-mcp.backend.form.description"),name:"description"},{default:i(()=>[s(u,{modelValue:e(t).formData.description,"onUpdate:modelValue":o[4]||(o[4]=l=>e(t).formData.description=l),disabled:e(t).isSystem,placeholder:e(a)("ai-mcp.backend.form.descriptionPlaceholder"),rows:3,ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),s(J,{items:[{}],ui:{header:"px-0 ",label:"text-lg font-semibold",content:"px-0",body:"flex flex-col gap-2"}},{body:i(()=>[m("div",je,[s(n,{label:e(a)("ai-mcp.backend.form.providerName"),name:"providerName"},{default:i(()=>[s(c,{modelValue:e(t).formData.providerName,"onUpdate:modelValue":o[5]||(o[5]=l=>e(t).formData.providerName=l),disabled:e(t).isSystem,placeholder:e(a)("ai-mcp.backend.form.providerName"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.timeOut"),name:"timeout"},{default:i(()=>[s(c,{modelValue:e(t).formData.timeout,"onUpdate:modelValue":o[6]||(o[6]=l=>e(t).formData.timeout=l),type:"number",placeholder:e(a)("ai-mcp.backend.form.timeOut"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.providerUrl"),name:"providerUrl",class:"col-span-2"},{default:i(()=>[s(c,{modelValue:e(t).formData.providerUrl,"onUpdate:modelValue":o[7]||(o[7]=l=>e(t).formData.providerUrl=l),disabled:e(t).isSystem,placeholder:e(a)("ai-mcp.backend.form.providerUrl"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.headers"),name:"headers",class:"col-span-2"},{default:i(()=>[s(u,{modelValue:e(t).formData.customHeaders,"onUpdate:modelValue":o[8]||(o[8]=l=>e(t).formData.customHeaders=l),placeholder:e(a)("ai-mcp.backend.form.customHeadersPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),default:i(()=>[m("div",he,[s(x,{name:"i-lucide-settings-2"}),k(" "+v(e(a)("ai-mcp.backend.form.advancedArgs")),1)])]),_:1}),S(m("div",Ve,[s(g,{color:"neutral",variant:"soft",size:"lg",onClick:o[9]||(o[9]=l=>_("close"))},{default:i(()=>[k(v(e(a)("console-common.cancel")),1)]),_:1}),s(g,{color:"primary",size:"lg",type:"submit",loading:e(U)},{default:i(()=>[k(v(e(f)?e(a)("console-common.update"):e(a)("console-common.create")),1)]),_:1},8,["loading"])],512),[[I,!b.isView]])]),_:1},8,["state","schema","disabled","onSubmit"]))]),_:1},8,["title","description"])}}});export{ka as default};
