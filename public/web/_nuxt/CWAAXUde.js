import{d as Q,b as X,aq as Y,s as w,g as v,aK as M,w as Z,c as ee,o as se,l as n,k as i,q as a,p as e,A as V,y as oe,v as l,bI as S,n as E,_ as ae,x as C,bJ as re,bK as te}from"#entry";import ne from"./--UdezPG.js";import{_ as de}from"./BYwSSEjb.js";import{_ as ie}from"./CbuHra-u.js";import{_ as le}from"./BYK_1AlN.js";import{d as ce}from"./CP4Zo7YT.js";import"./BgHJjJs-.js";import"./8-c-A7PB.js";import"./B22A-h4k.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./9bDOsXij.js";import"./CBooyAK7.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./b-_TUx9i.js";import"./Cfcu-t3n.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./XpsTG8vq.js";const ue={class:"space-y-4"},pe={class:"space-y-4 pt-4"},we={class:"text-muted-foreground text-xs"},me={class:"space-y-4 pt-4"},fe={class:"rounded-lg border border-orange-200 bg-orange-50 p-4 dark:border-orange-800 dark:bg-orange-950"},ve={class:"flex items-start gap-3"},ge={class:"space-y-2"},_e={class:"font-medium text-orange-800 dark:text-orange-200"},be={class:"text-sm text-orange-700 dark:text-orange-300"},he={class:"ml-4 list-disc space-y-1 text-sm text-orange-600 dark:text-orange-400"},ke={class:"flex justify-end gap-2"},ye={class:"space-y-4"},Pe={class:"bg-primary/20 border-primary/50 rounded-lg border p-4"},xe={class:"flex items-start gap-3"},Ve={class:"space-y-3"},Ce={class:"text-primary font-medium"},Ue={class:"text-primary text-sm"},Fe={class:"border-primary/50 bg-muted rounded-md border p-3"},Re={class:"flex items-center justify-between gap-2"},Te={class:"font-mono text-sm break-all"},$e={class:"flex justify-end"},Ye=Q({__name:"edit-password",props:{userid:{}},emits:["close"],setup(I,{emit:j}){const y=I,D=j,{t:s}=X(),u=Y(),c=w("change"),d=w({newPassword:"",confirmPassword:""}),_=w(!1),b=w(!1),p=w({new:!1,confirm:!1}),m=w(!1),h=w(""),L=v(()=>[{value:"change",label:s("user.backend.password.changeTab"),icon:"i-lucide-edit",slot:"change"},{value:"reset",label:s("user.backend.password.resetTab"),icon:"i-lucide-refresh-cw",slot:"reset"}]),k=v(()=>{const o={};return c.value==="change"&&(d.value.newPassword.trim()?d.value.newPassword.length<6&&(o.newPassword=s("user.backend.password.validation.passwordMinLength")):o.newPassword=s("user.backend.password.validation.newPasswordRequired"),d.value.confirmPassword.trim()?d.value.confirmPassword!==d.value.newPassword&&(o.confirmPassword=s("user.backend.password.validation.passwordMismatch")):o.confirmPassword=s("user.backend.password.validation.confirmPasswordRequired")),o}),U=v(()=>Object.keys(k.value).length>0),N=v(()=>c.value==="reset"?!1:!d.value.newPassword.trim()&&!d.value.confirmPassword.trim());function F(){d.value={newPassword:"",confirmPassword:""},p.value={new:!1,confirm:!1}}function R(o){p.value[o]=!p.value[o]}const{lockFn:O,isLock:T}=M(async()=>{if(U.value){const o=Object.values(k.value)[0];u.warning(o);return}try{await re(y.userid||"",d.value.newPassword),u.success(s("user.backend.password.messages.changeSuccess")),g()}catch(o){console.error("修改密码失败:",o),u.error(o instanceof Error?o.message:s("user.backend.password.messages.changeFailed"))}}),A=async()=>{if(!y.userid){u.error(s("user.backend.password.validation.userIdRequired"));return}try{_.value=!0;const{password:o}=await te(y.userid||"");h.value=o,m.value=!0}catch(o){console.error("重置密码失败:",o),u.error(o instanceof Error?o.message:s("user.backend.password.messages.resetFailed"))}finally{_.value=!1}},{lockFn:G}=M(A);function P(){c.value==="change"?O():G()}const g=()=>{F(),D("close"),b.value=!1};Z(c,()=>{F()});const $=async()=>{try{await navigator.clipboard.writeText(h.value),u.success(s("user.backend.password.messages.copySuccess"))}catch{u.error(s("user.backend.password.messages.copyFailed"))}},x=()=>{$(),m.value=!1,h.value="",g()},W=v(()=>{const o=T.value||_.value;return c.value==="change"&&(N.value||U.value)||o});ce({escape:()=>m.value?x():g()});const H=v(()=>T.value||_.value);return(o,r)=>{const f=ae,q=ne,z=de,B=oe,J=ie,K=le;return se(),ee("div",null,[n(K,{open:e(b),"onUpdate:open":r[5]||(r[5]=t=>V(b)?b.value=t:null),title:e(s)("user.backend.password.title"),ui:{content:"max-w-md overflow-y-auto h-fit"},"show-footer":!0,"onUpdate:modelValue":r[6]||(r[6]=t=>!t&&g())},{footer:i(()=>[a("div",ke,[n(f,{variant:"soft",color:"neutral",onClick:g},{default:i(()=>[C(l(e(s)("user.backend.password.cancel")),1)]),_:1}),n(f,{disabled:e(W),color:e(c)==="reset"?"warning":"primary",loading:e(H),onClick:P},{default:i(()=>[C(l(e(c)==="change"?e(s)("user.backend.password.changePassword"):e(s)("user.backend.password.confirmReset")),1)]),_:1},8,["disabled","color","loading"])])]),default:i(()=>[a("div",ue,[n(J,{modelValue:e(c),"onUpdate:modelValue":r[4]||(r[4]=t=>V(c)?c.value=t:null),items:e(L),class:"w-full"},{change:i(()=>[a("div",pe,[n(z,{label:e(s)("user.backend.password.newPassword"),size:"lg",required:"",error:e(k).newPassword},{default:i(()=>[n(q,{modelValue:e(d).newPassword,"onUpdate:modelValue":r[1]||(r[1]=t=>e(d).newPassword=t),type:e(p).new?"text":"password",placeholder:e(s)("user.backend.password.newPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:S(E(P,["prevent"]),["enter"])},{trailing:i(()=>[n(f,{variant:"ghost",size:"xs",icon:e(p).new?"i-lucide-eye-off":"i-lucide-eye",onClick:r[0]||(r[0]=t=>R("new"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),n(z,{label:e(s)("user.backend.password.confirmPassword"),size:"lg",required:"",error:e(k).confirmPassword},{default:i(()=>[n(q,{modelValue:e(d).confirmPassword,"onUpdate:modelValue":r[3]||(r[3]=t=>e(d).confirmPassword=t),type:e(p).confirm?"text":"password",placeholder:e(s)("user.backend.password.confirmPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:S(E(P,["prevent"]),["enter"])},{trailing:i(()=>[n(f,{variant:"ghost",size:"xs",icon:e(p).confirm?"i-lucide-eye-off":"i-lucide-eye",onClick:r[2]||(r[2]=t=>R("confirm"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),a("div",we,l(e(s)("user.backend.password.passwordHelp")),1)])]),reset:i(()=>[a("div",me,[a("div",fe,[a("div",ve,[n(B,{name:"i-lucide-alert-triangle",class:"mt-0.5 size-5 text-orange-600 dark:text-orange-400"}),a("div",ge,[a("h4",_e,l(e(s)("user.backend.password.resetConfirmTitle")),1),a("p",be,l(e(s)("user.backend.password.resetConfirmDesc")),1),a("ul",he,[a("li",null,l(e(s)("user.backend.password.resetWarning1")),1),a("li",null,l(e(s)("user.backend.password.resetWarning2")),1)])])])])])]),_:1},8,["modelValue","items"])])]),_:1},8,["open","title"]),n(K,{open:e(m),"onUpdate:open":r[7]||(r[7]=t=>V(m)?m.value=t:null),title:e(s)("user.backend.password.resetSuccessTitle"),ui:{content:"max-w-md overflow-y-auto h-fit"},"show-footer":!0,"onUpdate:modelValue":r[8]||(r[8]=t=>!t&&x())},{footer:i(()=>[a("div",$e,[n(f,{onClick:x},{default:i(()=>[C(l(e(s)("user.backend.password.copyAndClose")),1)]),_:1})])]),default:i(()=>[a("div",ye,[a("div",Pe,[a("div",xe,[n(B,{name:"i-lucide-check-circle",class:"text-primary mt-0.5 size-5"}),a("div",Ve,[a("h4",Ce,l(e(s)("user.backend.password.newPasswordGenerated")),1),a("p",Ue,l(e(s)("user.backend.password.newPasswordDesc")),1),a("div",Fe,[a("div",Re,[a("code",Te,l(e(h)),1),n(f,{variant:"ghost",size:"xs",icon:"i-lucide-copy",onClick:$,class:"shrink-0"})])])])])])])]),_:1},8,["open","title"])])}}});export{Ye as default};
