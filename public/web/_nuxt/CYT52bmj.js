import F from"./--UdezPG.js";import{_ as z}from"./BYwSSEjb.js";import{_ as B}from"./CqN3ElKI.js";import C from"./CfxLE1oh.js";import{_ as R}from"./CyGK14vg.js";import{_ as D}from"./BLu746J3.js";import{d as j,b as H,aq as A,s as M,a1 as W,aK as G,j as K,o as L,k as a,l as n,q as p,p as e,v as d,_ as P,x as g}from"#entry";import{_ as Z}from"./DNgvVYsj.js";import{_ as O}from"./BYK_1AlN.js";import{E as c}from"./XBYuZpdu.js";import{a as X,b as J,c as Q}from"./P4eVxJUJ.js";import{c as Y,a as x}from"./BUyfW8JT.js";import"./BgHJjJs-.js";import"./BaNg8fjw.js";import"./DlAUqK2U.js";import"./8-c-A7PB.js";import"./DN9ov8OT.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./nBDBqKnC.js";import"./9bDOsXij.js";import"./B22A-h4k.js";import"./BwTGIg9g.js";import"./BWWuJQeZ.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./b-_TUx9i.js";import"./Cfcu-t3n.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./CP4Zo7YT.js";import"./XpsTG8vq.js";import"./DaWZu8wl.js";const ee={class:"text-xs"},oe={class:"text-xs"},te={class:"text-xs"},se={class:"text-xs"},ne={class:"flex items-center gap-2"},ae={class:"text-xs"},le={class:"flex justify-end gap-4 pt-8"},He=j({__name:"add-extension",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["close"],setup(y,{emit:k}){const v=k,r=y,{t:o}=H(),u=A(),_=M(!1),s=W({name:"",icon:"",packName:"",description:"",version:"",type:1,supportTerminal:[],author:{avatar:"",name:"",homepage:""},...r.initialData}),V=Y({name:x().required(o("extensions.develop.form.nameRequired")),packName:x().required(o("extensions.develop.form.keyRequired")).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,o("extensions.develop.form.keyFormat")),description:x().required(o("extensions.develop.form.descriptionRequired")),version:x().required(o("extensions.develop.form.versionRequired")).matches(/^\d+\.\d+\.\d+$/,o("extensions.develop.form.versionFormat"))}),h=()=>{Object.keys(s).forEach(l=>{const t=l;typeof s[t]=="string"&&(s[t]="")}),s.type=1,s.supportTerminal=[c.WEB],u.info(o("extensions.develop.messages.formReset"))},$=async l=>{try{const{exists:t}=await X(l,r.isEdit?r.id?.toString():void 0);return t?(u.error(o("extensions.develop.form.keyExists")),_.value=o("extensions.develop.form.keyExists"),!1):(_.value=!1,!0)}catch(t){return console.error("Failed to check identifier uniqueness:",t),u.error(o("extensions.develop.messages.checkIdentifierError")),!1}},{isLock:E,lockFn:q}=G(async()=>{try{const l={name:s.name,identifier:s.packName,description:s.description,version:s.version,icon:s.icon,author:s.author||{avatar:"",name:"",homepage:""},type:s.type,status:1,supportTerminal:s.supportTerminal.map(t=>Number(t))};return r.isEdit&&r.id?(await J(r.id.toString(),l),u.success(o("extensions.develop.messages.updateSuccess"))):(await Q(l),u.success(o("extensions.develop.messages.createSuccess"))),v("close",!0),!0}catch(l){return console.error("Failed to submit form:",l),u.error(o("extensions.develop.messages.submitError")),!1}});return(l,t)=>{const f=F,m=z,T=B,N=C,U=R,w=D,b=P,I=Z,S=O;return L(),K(S,{title:l.$t("extensions.modal.addExtension"),description:l.$t("extensions.modal.addExtensionDescription"),ui:{content:"max-w-xl"},onClose:t[10]||(t[10]=i=>v("close",!1))},{default:a(()=>[n(I,{ref:"formRef",state:e(s),schema:e(V),class:"w-full space-y-2",onSubmit:e(q)},{default:a(()=>[n(m,{label:e(o)("extensions.develop.form.name"),required:"",name:"name"},{default:a(()=>[n(f,{modelValue:e(s).name,"onUpdate:modelValue":t[0]||(t[0]=i=>e(s).name=i),placeholder:e(o)("extensions.develop.form.nameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(m,{label:e(o)("extensions.develop.form.icon"),required:"",name:"icon"},{help:a(()=>[p("span",ee,d(e(o)("extensions.develop.form.iconRecommendation")),1)]),default:a(()=>[n(T,{modelValue:e(s).icon,"onUpdate:modelValue":t[1]||(t[1]=i=>e(s).icon=i),class:"size-20",text:e(o)("extensions.develop.form.addIcon"),icon:"i-lucide-upload",accept:".jpg,.png,.jpeg,.gif",maxCount:1,single:!0},null,8,["modelValue","text"])]),_:1},8,["label"]),n(m,{label:e(o)("extensions.develop.form.packName"),required:"",name:"packName",error:e(_)},{help:a(()=>[p("span",oe,d(e(o)("extensions.develop.form.packNameHelp")),1)]),default:a(()=>[n(f,{modelValue:e(s).packName,"onUpdate:modelValue":[t[2]||(t[2]=i=>e(s).packName=i),t[3]||(t[3]=i=>$(e(s).packName))],placeholder:e(o)("extensions.develop.form.packNameInput"),size:"lg",ui:{root:"w-full"},disabled:r.isEdit},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label","error"]),n(m,{label:e(o)("extensions.develop.form.description"),required:"",name:"description"},{default:a(()=>[n(N,{modelValue:e(s).description,"onUpdate:modelValue":t[4]||(t[4]=i=>e(s).description=i),placeholder:e(o)("extensions.develop.form.descriptionInput"),size:"lg",rows:2,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(m,{label:e(o)("extensions.develop.form.type"),required:"",name:"type"},{help:a(()=>[p("span",te,d(e(o)("extensions.develop.form.typeHelp")),1)]),default:a(()=>[n(U,{modelValue:e(s).type,"onUpdate:modelValue":t[5]||(t[5]=i=>e(s).type=i),items:[{label:l.$t("extensions.modal.extensionTypes.application"),value:1},{label:l.$t("extensions.modal.extensionTypes.function"),value:2}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),n(m,{label:e(o)("extensions.develop.form.supportTerminal"),required:"",name:"supportTerminal"},{help:a(()=>[p("span",se,d(e(o)("extensions.develop.form.supportTerminalHelp")),1)]),default:a(()=>[n(w,{modelValue:e(s).supportTerminal,"onUpdate:modelValue":t[6]||(t[6]=i=>e(s).supportTerminal=i),items:[{label:l.$t("extensions.modal.terminalTypes.web"),value:e(c).WEB.toString()},{label:l.$t("extensions.modal.terminalTypes.weixin"),value:e(c).WEIXIN.toString(),disabled:!0},{label:l.$t("extensions.modal.terminalTypes.h5"),value:e(c).H5.toString(),disabled:!0},{label:l.$t("extensions.modal.terminalTypes.mp"),value:e(c).MP.toString(),disabled:!0},{label:l.$t("extensions.modal.terminalTypes.api"),value:e(c).API.toString()}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),n(m,{label:e(o)("extensions.develop.form.version"),required:"",name:"version"},{help:a(()=>[p("span",ae,d(e(o)("extensions.develop.form.versionHelp")),1)]),default:a(()=>[p("div",ne,[n(f,{modelValue:e(s).version,"onUpdate:modelValue":t[7]||(t[7]=i=>e(s).version=i),placeholder:"0",length:"3",ui:{root:"w-full",base:"pl-18"}},{leading:a(()=>[...t[11]||(t[11]=[p("span",{class:"text-muted-foreground pl-1 text-sm"}," Version ",-1)])]),_:1},8,["modelValue"])])]),_:1},8,["label"]),n(m,{label:e(o)("extensions.develop.form.authorName"),name:"author.name"},{default:a(()=>[n(f,{modelValue:e(s).author.name,"onUpdate:modelValue":t[8]||(t[8]=i=>e(s).author.name=i),placeholder:e(o)("extensions.develop.form.authorNameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),p("div",le,[n(b,{color:"neutral",variant:"outline",size:"lg",onClick:t[9]||(t[9]=i=>v("close",!1))},{default:a(()=>[g(d(e(o)("console-common.cancel")),1)]),_:1}),n(b,{color:"neutral",size:"lg",onClick:h},{default:a(()=>[g(d(e(o)("console-common.reset")),1)]),_:1}),n(b,{color:"primary",size:"lg",loading:e(E),type:"submit"},{default:a(()=>[g(d(r.isEdit?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])]),_:1},8,["title","description"])}}});export{He as default};
