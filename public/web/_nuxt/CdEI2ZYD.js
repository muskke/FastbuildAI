import{_ as ue}from"./B9WZOnAv.js";import de from"./CfxLE1oh.js";import{d as W,e as H,s as V,aq as B,b as A,g as O,j as E,o as C,k as w,l as x,_ as J,n as S,q as b,v as K,p as a,A as P,x as me,f as pe,a6 as fe,bB as q,bt as ge,ap as ve,cy as he,aS as G,aK as xe,w as be,i as ye,G as _e,c as we,t as Fe,r as j,z as Q,an as Ue}from"#entry";import{_ as Y}from"./BqoA6bN6.js";import Le from"./--UdezPG.js";import{_ as Te}from"./Bu7cOM_l.js";import{_ as ze}from"./BO1GPLSL.js";import{u as Se}from"./C1DLXs69.js";import{j as ke}from"./B1XcE43x.js";import{_ as Re}from"./DlAUqK2U.js";const $e={class:"text-background text-xs whitespace-pre-line"},Ce={class:"p-3"},Oe={class:"flex items-center gap-2"},Ie=["accept","disabled"],je=W({__name:"prompt-file-upload",props:{disabled:{type:Boolean},maxSize:{},accept:{}},emits:["file-select","url-submit"],setup(t,{emit:m}){const l=m,p=t,h=Se(),T=H("fileInputRefs"),i=V(""),d=V(!1),c=B(),{t:g}=A(),y=O(()=>{if(!h.selectedModel)return".pdf,.doc,.docx,.txt,.md";const n=h.selectedModel.features||[],s=[],f=[".pdf",".docx",".txt",".md",".rtf",".csv",".xlsx",".xls",".pptx"];return s.push(...f),n.includes("vision")&&s.push(".jpg",".jpeg",".png",".gif",".webp",".bmp"),n.includes("audio")&&s.push(".mp3",".wav",".flac",".aac",".ogg",".m4a"),s.join(",")}),k=O(()=>{const s=p.maxSize||100,f=h.selectedModel?.features?.includes("vision")||!1,U=g("common.chat.messages.uploadAttachmentTextOnly"),L=g("common.chat.messages.fileUploadLimit",{count:10,size:s}),z=f?g("common.chat.messages.supportsImage"):"";return`${U}
${L}${z}`}),_=()=>{d.value=!1,T.value?.click()};function F(n){const s=n.target,f=s.files?.[0];f&&l("file-select",f),s.value=""}function e(n){try{const U=new URL(n).pathname.split(".").pop()?.toLowerCase()||"";return U?`.${U}`:""}catch{const s=n.split(".").pop()?.toLowerCase()||"";return s?`.${s}`:""}}function o(n){return n?y.value.split(",").map(f=>f.trim()).includes(n.toLowerCase()):!1}function u(){const n=i.value.trim();if(!n)return;try{new URL(n)}catch{c.error(g("common.message.invalidUrl"));return}const s=e(n);if(!o(s)){c.error(g("common.message.unsupportedFileType"));return}l("url-submit",n),i.value="",d.value=!1}return(n,s)=>{const f=J,U=Y,L=Le,z=Te,I=ze;return C(),E(I,{open:a(d),"onUpdate:open":s[2]||(s[2]=R=>P(d)?d.value=R:null)},{content:w(()=>[b("div",Ce,[b("div",null,[x(L,{modelValue:a(i),"onUpdate:modelValue":s[1]||(s[1]=R=>P(i)?i.value=R:null),ui:{root:"w-full",trailing:"!pe-0 !pr-1"},placeholder:a(g)("common.chat.messages.inputUrlPlaceholder")},{trailing:w(()=>[x(f,{size:"xs",onClick:S(u,["stop"])},{default:w(()=>[me(K(a(g)("common.confirm")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),x(z,{class:"my-2",ui:{container:"text-xs font-normal text-muted-foreground"},label:"OR"}),b("div",Oe,[x(f,{size:"sm",label:a(g)("common.upload"),ui:{base:"flex-1 justify-center"},icon:"i-lucide-cloud-upload",variant:"outline",disabled:t.disabled,onClick:_},null,8,["label","disabled"])]),b("input",{ref_key:"fileInputRefs",ref:T,type:"file",accept:t.accept||a(y),class:"hidden",disabled:t.disabled,onChange:F},null,40,Ie)])]),default:w(()=>[x(U,{"delay-duration":0,ui:{content:"w-xs h-auto"}},{content:w(()=>[b("div",$e,K(a(k)),1)]),default:w(()=>[x(f,{onClick:s[0]||(s[0]=S(()=>{},["stop"])),size:"lg",variant:"ghost",icon:"i-lucide-paperclip",class:"rounded-full font-bold",disabled:t.disabled},null,8,["disabled"])]),_:1})]),_:1},8,["open"])}}}),Ee=["jpg","jpeg","png","gif","bmp","webp","svg"],Ve=["mp4","webm","ogg","mov","avi","wmv","flv","mkv"],Ne=["mp3","wav","ogg","m4a","aac","flac","wma"],Me=t=>t.extension?t.extension.toLowerCase():(t.name||t.originalName||"").split(".").pop()?.toLowerCase()||"",D=(t,m,l)=>{const p=Me(t),h=t.type?.toLowerCase()||"";return m.includes(p)||h.startsWith(l)},Pe=t=>D(t,Ee,"image/"),Be=t=>D(t,Ve,"video/"),Ae=t=>D(t,Ne,"audio/"),X=t=>Pe(t)?"image":Be(t)?"video":Ae(t)?"audio":"file";function De(){const{t}=A(),m=B(),l=pe([]),p=O(()=>l.value.some(e=>e.status==="uploading")),h=()=>`${Date.now()}-${Math.random().toString(36).slice(2,11)}`,T=e=>l.value.find(o=>o.id===e),i=(e,o)=>{const u=T(e);u&&Object.assign(u,o)},d=e=>{e.startsWith("blob:")&&URL.revokeObjectURL(e)},c=async e=>{const o=h(),u=URL.createObjectURL(e);l.value.push({id:o,name:e.name,size:e.size,url:u,progress:0,status:"uploading",mediaType:X(e),file:e});try{const n=await q({file:e,description:`Prompt file: ${e.name}`},{onProgress:s=>i(o,{progress:s})});return d(u),i(o,{status:"success",progress:100,url:n.url,result:n}),m.success(t("common.message.uploadSuccess")),n}catch(n){return console.error("File upload failed:",n),i(o,{status:"error",error:n instanceof Error?n.message:t("common.message.uploadFailed")}),m.error(t("common.message.uploadFailed")),null}},g=async e=>{try{new URL(e.trim())}catch{return m.error(t("common.message.invalidUrl")),!1}const o=`url-${h()}`,u=e.trim(),n=u.split("/").pop()||"Remote File";l.value.push({id:o,name:n,size:0,url:u,progress:0,status:"uploading",mediaType:"image"});try{const s=await ge({url:u,description:`Remote file: ${n}`});return i(o,{status:"success",progress:100,url:s.url,size:s.size,name:s.originalName,mediaType:X(s),result:s}),m.success(t("common.message.urlAdded")),!0}catch(s){return i(o,{status:"error",error:s instanceof Error?s.message:t("common.message.uploadFailed")}),m.error(t("common.message.uploadFailed")),!1}},y=e=>{const o=l.value.findIndex(u=>u.id===e.id);o!==-1&&(d(l.value[o]?.url??""),l.value.splice(o,1))},k=()=>{l.value.forEach(e=>d(e.url)),l.value=[]},_=async e=>{if(!e.file)return m.error(t("common.message.fileNotFound")),null;Object.assign(e,{status:"uploading",progress:0,error:void 0});try{const o=await q({file:e.file,description:`Prompt file: ${e.file.name}`},{onProgress:u=>e.progress=u});return d(e.url),Object.assign(e,{status:"success",progress:100,url:o.url,result:o}),m.success(t("common.message.uploadSuccess")),o}catch(o){return console.error("File upload failed:",o),Object.assign(e,{status:"error",error:o instanceof Error?o.message:t("common.message.uploadFailed")}),m.error(t("common.message.uploadFailed")),null}},F=()=>l.value.filter(e=>e.status==="success"&&e.result).map(e=>{switch(e.mediaType){case"image":return{type:"image_url",image_url:{url:e.url}};case"video":return{type:"video_url",video_url:{url:e.url}};case"audio":{const o=e.name.split(".").pop()?.toLowerCase()||"mp3";return{type:"input_audio",input_audio:{data:e.url,format:o}}}default:return{type:"file_url",name:e.name,url:e.url}}});return{files:fe(l),isUploading:p,uploadFile:c,addUrl:g,removeFile:y,clearFiles:k,retryUpload:_,generateFilesList:F}}const Ke={class:"flex items-center gap-2"},qe={class:"flex items-end justify-between p-0 sm:p-2"},Ge={class:"flex items-center gap-2"},Qe={class:"flex items-center gap-2"},Xe=W({__name:"chats-prompt",props:{modelValue:{default:""},fileList:{default:()=>[]},placeholder:{default:""},isLoading:{type:Boolean,default:!1},rows:{default:1},needAuth:{type:Boolean,default:!1},attachmentSizeLimit:{default:10}},emits:["update:modelValue","update:fileList","submit","stop"],setup(t,{emit:m}){const l=m,p=t,h=H("uTextareaRefs"),T=O(()=>h.value?.textareaRef||null),i=G(p,"modelValue",l),d=G(p,"fileList",l),{t:c}=A(),g=ve(),y=B(),{focused:k}=he(T,{initialValue:!1}),_=V(""),F=V(""),e=O(()=>F.value!==""&&i.value.trim()===F.value.trim()),{files:o,isUploading:u,uploadFile:n,addUrl:s,removeFile:f,retryUpload:U,generateFilesList:L,clearFiles:z}=De();function I(){h.value?.textareaRef?.focus(),!g.isAgreed&&p.needAuth&&Ue("/login")}function R(r){r.isComposing||r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),p.isLoading?l("stop"):l("submit",i.value))}function Z(){if(p.isLoading)l("stop");else{if(!i.value.trim()&&o.value.length===0)return;l("submit",i.value),z(),d.value=[]}}async function ee(r){await n(r)&&(d.value=L())}async function te(r){await s(r)&&(d.value=L())}function se(r){"id"in r&&(f(r),d.value=L())}async function oe(r){"id"in r&&await U(r)&&(d.value=L())}const{lockFn:ae,isLock:$}=xe(async()=>{if(!i.value.trim()){y.warning(c("common.chat.messages.enterQuestion"));return}if(!p.isLoading)try{_.value=i.value.trim();const r=localStorage.getItem("modelId")||void 0,v=await ke({modelId:r,text:_.value});v.optimizedText?(F.value=v.optimizedText,i.value=v.optimizedText,y.success(c("common.chat.messages.optimizeSuccess"))):y.warning(c("common.chat.messages.optimizeEmpty"))}catch(r){console.error("文案优化失败:",r);const v=r?.message||c("common.chat.messages.optimizeFailed");y.error(v)}});function ne(){_.value&&(i.value=_.value,F.value="",_.value="")}return be(()=>p.fileList,r=>{r.length===0&&o.value.length>0&&z()}),ye(()=>_e(()=>{g.isAgreed&&I()})),(r,v)=>{const ie=ue,re=de,N=J,M=Y,le=je;return C(),we("div",{class:Q(["chat-action-bar w-full rounded-md border p-1.5 transition-[border-color_box-shadow] duration-200 sm:rounded-2xl",a(k)?"ring-primary/15 border-primary ring-3":"border-border"]),onClick:S(I,["stop"])},[b("div",Ke,[j(r.$slots,"panel-top",{},void 0,!0)]),a(o).length>0?(C(),E(ie,{key:0,files:[...a(o)],"show-actions":!0,class:"p-1.5",onRemove:se,onRetry:oe},null,8,["files"])):Fe("",!0),x(re,{ref_key:"uTextareaRefs",ref:h,modelValue:a(i),"onUpdate:modelValue":v[0]||(v[0]=ce=>P(i)?i.value=ce:null),class:Q(["custom-textarea-wrapper w-full",{"optimizing-text":a($)}]),style:{"--ui-bg-elevated":"var(--color-background)"},variant:"ghost",rows:t.rows,maxrows:8,highlight:!1,autoresize:!0,ui:{base:"resize-none custom-textarea text-base min-h-[40px] focus:bg-transparent hover:bg-transparent"},placeholder:t.placeholder||a(c)("common.chat.messages.inputPlaceholder"),disabled:a($),onKeydown:R},null,8,["modelValue","class","rows","placeholder","disabled"]),b("div",qe,[b("div",Ge,[j(r.$slots,"panel-left",{},()=>[v[1]||(v[1]=b("div",null,null,-1))],!0)]),j(r.$slots,"panel-right",{},()=>[b("div",Qe,[a(e)?(C(),E(M,{key:0,text:a(c)("common.chat.messages.revertText"),"delay-duration":0,arrow:!0},{default:w(()=>[x(N,{icon:"i-lucide-undo-2",class:"rounded-full font-bold",size:"lg",variant:"ghost",color:"primary",disabled:p.isLoading,onClick:S(ne,["stop"])},null,8,["disabled"])]),_:1},8,["text"])):(C(),E(M,{key:1,text:a($)?a(c)("common.chat.messages.optimizing"):a(i)?.trim()?a(c)("common.chat.messages.optimizeText"):a(c)("common.chat.messages.enterQuestion"),"delay-duration":0,arrow:!0},{default:w(()=>[x(N,{icon:"i-lucide-sparkles",class:"rounded-full font-bold",size:"lg",variant:"ghost",color:"primary",disabled:a($)||!a(i)?.trim()||p.isLoading,loading:a($),onClick:S(a(ae),["stop"])},null,8,["disabled","loading","onClick"])]),_:1},8,["text"])),x(le,{disabled:a(u),maxSize:t.attachmentSizeLimit,onFileSelect:ee,onUrlSubmit:te},null,8,["disabled","maxSize"]),j(r.$slots,"panel-right-item",{},void 0,!0),x(M,{content:{align:"center",side:"top",sideOffset:8},text:t.isLoading?a(c)("common.chat.messages.stopGeneration"):a(i)?.length?a(c)("common.chat.messages.sendMessage"):a(c)("common.chat.messages.enterQuestion"),"delay-duration":0,arrow:!0,disabled:t.isLoading||!!a(i)?.length},{default:w(()=>[x(N,{icon:t.isLoading?"i-lucide-square":"i-lucide-arrow-up",class:"rounded-full font-bold",size:"lg",disabled:!t.isLoading&&!a(i)?.length,color:t.isLoading?"error":"primary",onClick:S(Z,["stop"])},null,8,["icon","disabled","color"])]),_:1},8,["text","disabled"])])],!0)])],2)}}}),We=Re(Xe,[["__scopeId","data-v-338ef5b5"]]),it=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"}));export{We as _,Ae as a,it as c,X as g,Be as i};
