import{d as L,ap as Q,aI as R,g as A,b as Y,aL as T,aJ as j,i as G,j as w,o as h,k as c,c as K,p as e,l as r,y as W,q as p,x as g,v as k,_ as X}from"#entry";import Z from"./BruVSCWF.js";import{_ as ee}from"./DS-TE4M7.js";import oe from"./Dg6D3RQ3.js";import{_ as ae}from"./CRoF6I1E.js";import{_ as re}from"./ql0_WxJN.js";import{_ as te}from"./5XG8SC4l.js";import{_ as le}from"./D-6Co9ha.js";import{_ as ie}from"./C7UmhjTd.js";import{_ as se}from"./CXUt0j5Y.js";import{b as ne,c as ce,d as me,e as de}from"./CbK4UO9G.js";import{c as E,a as U}from"./BUyfW8JT.js";import"./BgHJjJs-.js";import"./DHFmmngs.js";import"./CR1AS2Ry.js";import"./Btvd554H.js";import"./BPKB8n-W.js";import"./B-DdbQ-X.js";import"./V9POJiZu.js";import"./MN31c9CG.js";import"./BstbYvQo.js";import"./DuSMYVIA.js";import"./BdImEx5p.js";import"./oFTPHjuc.js";import"./BcsO9TDZ.js";import"./DlAUqK2U.js";import"./C3zg6GHm.js";import"./BFVs1AfH.js";import"./kRIii9yh.js";import"./C6Y-ieo6.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./3UOIlTK8.js";import"./-Eb02sIQ.js";import"./Dk6FGhu1.js";import"./CCcv9mzY.js";import"./BFAo_s2U.js";import"./Cb04SOqd.js";import"./VGKgjfSv.js";import"./DaWZu8wl.js";const pe={key:0,class:"flex items-center justify-center",style:{height:"400px"}},ue={class:"flex flex-col gap-4 pb-2"},fe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},be={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ve={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ke={class:"space-y-4"},_e={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ge={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ye={class:"py-4"},he={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Ue={class:"pb-2"},Ve={class:"flex flex-col gap-4 p-4"},$e={class:"flex flex-col"},je={class:"flex w-fit flex-col items-start gap-2"},we={class:"flex w-full items-start gap-1 rounded-lg bg-blue-50 p-2 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-200"},xe={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Se=`{
    "mcpServers": {
        "Your MCP Server Name": {
            "url": "xxxxx",
            // type: sse or streamable-http
            "type": "sse or streamable-http",
            "headers": {
                "Content-Type": "application/json",
                "Authorization": "Bearer Your Token"
                ...
            },
            ...
        }
    }
}`,vo=L({__name:"edit",props:{id:{},isJsonImport:{type:Boolean}},emits:["close","change-update"],setup(x,{emit:N}){const V=Q(),O=R(),M=x,f=N,v=A(()=>M.id||O.query.id||null),{t:o}=Y(),t=T({name:"",providerName:"",description:"",icon:"",isDisabled:!1,url:"",sortOrder:0,communicationType:void 0,timeout:60,isQuickMenu:!1,alias:"",providerUrl:"",customHeaders:""}),y=T({jsonImport:""}),C=E({name:U().required(o("ai-mcp.backend.form.name")),url:U().required(o("ai-mcp.backend.form.baseUrlPlaceholder")).test("is-valid-url",o("ai-mcp.backend.form.baseUrlPlaceholder"),n=>{if(!n)return!1;if(/^(https?:\/\/)?[\w\d-]+(\.[\w\d-]+)+([\w\d\-.,@?^=%&:/~+#]*[\w\d=#])?$/.test(n))return!0;try{return new URL(n),!0}catch{return!1}}),communicationType:U().required(o("ai-mcp.backend.form.communicationType"))}),D=E({jsonImport:U().required(o("ai-mcp.backend.validation.jsonRequired")).test("is-valid-json",o("ai-mcp.backend.validation.jsonFormatError"),n=>{if(!n)return!1;try{return JSON.parse(n),!0}catch{return!1}}).test("validate-required-fields",(n,a)=>{if(!n)return!0;try{const m=JSON.parse(n);if(!m.mcpServers||typeof m.mcpServers!="object")return a.createError({message:o("ai-mcp.backend.validation.missingMcpServers")});const i=m.mcpServers;if(Object.keys(i).length===0)return a.createError({message:o("ai-mcp.backend.validation.emptyMcpServers")});for(const[d,b]of Object.entries(i)){if(!b||typeof b!="object")return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.invalidConfig")}`});const u=b;if(!u.url)return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.missingUrl")}`});if(typeof u.url!="string")return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.invalidUrlType")}`});if(!u.type)return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.missingType")}`});if(typeof u.type!="string")return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.invalidTypeValue")}`});if(!["sse","streamable-http"].includes(u.type))return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.invalidTypeEnum")}`});if(u.headers!==void 0&&(typeof u.headers!="object"||u.headers===null))return a.createError({message:`"${d}" ${o("ai-mcp.backend.validation.invalidHeaders")}`})}return!0}catch{return a.createError({message:o("console-ai-mcp-server.validation.jsonFormatError")})}})}),{lockFn:F,isLock:q}=j(async()=>{try{const n=await ne(v.value);Object.keys(t).forEach(a=>{const m=a,i=n[m];if(i!==void 0)if(m==="customHeaders")if(typeof i=="object"&&i!==null){const s=Object.entries(i).map(([d,b])=>`${d}=${b}`).join(",");t[m]=s}else t[m]=i||"";else typeof i=="object"&&i!==null?Object.keys(i).length>0&&(t[m]=i):t[m]=i})}catch(n){console.error("获取供应商详情失败:",n)}}),z=n=>{if(!n?.trim())return{};const a={};return n.split(/[,\n]/).filter(i=>i.trim()).forEach(i=>{const[s,...d]=i.split("=");if(s?.trim()&&d.length>0){const b=d.join("=");a[s.trim()]=b.trim()}}),a},{lockFn:H,isLock:S}=j(async()=>{const{customHeaders:n,...a}=t,m=z(n),i={...a,customHeaders:m};try{let s="";v.value?(s=(await ce(v.value,i)).id,f("change-update",[s]),V.success(o("ai-mcp.backend.updateSuccess"))):(s=(await me(i)).id,f("change-update",[s]),V.success(o("ai-mcp.backend.createSuccess"))),f("close",!0)}catch(s){console.error("提交失败:",s)}}),{lockFn:B}=j(async()=>{try{const n=await de(y.jsonImport||"");V.success(`${o("ai-mcp.backend.jsonImportTotal")} ${n.total} ${o("ai-mcp.backend.jsonImportUnit")}，
            ${o("console-common.create")} ${n.created} ${o("ai-mcp.backend.jsonImportUnit")}，
            ${o("console-common.update")} ${n.updated} ${o("ai-mcp.backend.jsonImportUnit")}`);const a=n.results.map(m=>m.id);f("change-update",a),f("close",!0)}catch(n){console.error("JSON导入失败:",n)}});return G(async()=>v.value&&await F()),(n,a)=>{const m=W,i=Z,s=ee,d=oe,b=ae,u=re,$=te,_=X,I=le,P=ie,J=se;return h(),w(J,{title:e(v)?e(o)("ai-mcp.backend.editTitle"):e(o)("ai-mcp.backend.addTitle"),description:e(v)?e(o)("ai-mcp.backend.editTitle"):e(o)("ai-mcp.backend.addTitle"),ui:{content:"max-w-2xl overflow-y-auto h-fit"},"onUpdate:modelValue":a[16]||(a[16]=l=>!l&&f("close")),onClose:a[17]||(a[17]=l=>f("close"))},{default:c(()=>[e(q)?(h(),K("div",pe,[r(m,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):x.isJsonImport?(h(),w(I,{key:2,state:e(y),schema:e(D),onSubmit:e(B)},{default:c(()=>[p("div",Ue,[r(s,{label:e(o)("ai-mcp.backend.form.jsonImport"),name:"jsonImport",required:""},{hint:c(()=>[r(P,{mode:"click","open-delay":0,"close-delay":0},{content:c(()=>[p("div",Ve,[p("div",$e,[p("div",je,[p("div",we,[r(m,{size:"20",name:"i-tabler-alert-circle"}),p("span",null,k(e(o)("ai-mcp.backend.jsonImportCorrectExample")),1)]),p("pre",{class:"bg-muted w-full overflow-x-auto rounded-lg p-4 text-sm"},[p("code",null,k(Se))])])])])]),default:c(()=>[r(_,{variant:"link",class:"text-primary cursor-pointer text-xs"},{default:c(()=>[g(k(e(o)("ai-mcp.backend.jsonImportExample")),1)]),_:1})]),_:1})]),default:c(()=>[r(d,{modelValue:e(y).jsonImport,"onUpdate:modelValue":a[14]||(a[14]=l=>e(y).jsonImport=l),placeholder:e(o)("ai-mcp.backend.form.jsonImportPlaceholder"),rows:13,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",xe,[r(_,{color:"neutral",variant:"soft",size:"lg",onClick:a[15]||(a[15]=l=>f("close"))},{default:c(()=>[g(k(e(o)("console-common.cancel")),1)]),_:1}),r(_,{color:"primary",size:"lg",type:"submit",loading:e(S)},{default:c(()=>[g(k(e(v)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])):(h(),w(I,{key:1,state:e(t),schema:e(C),onSubmit:e(H)},{default:c(()=>[p("div",ue,[p("div",fe,[r(s,{label:e(o)("ai-mcp.backend.form.name"),name:"name",required:""},{default:c(()=>[r(i,{modelValue:e(t).name,"onUpdate:modelValue":a[0]||(a[0]=l=>e(t).name=l),placeholder:e(o)("ai-mcp.backend.form.name"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(s,{label:e(o)("ai-mcp.backend.form.alias"),name:"alias"},{default:c(()=>[r(i,{modelValue:e(t).alias,"onUpdate:modelValue":a[1]||(a[1]=l=>e(t).alias=l),placeholder:e(o)("ai-mcp.backend.form.alias"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),r(s,{label:e(o)("ai-mcp.backend.form.baseUrl"),name:"url",required:"",description:e(o)("ai-mcp.backend.form.baseUrlTips")},{default:c(()=>[r(d,{modelValue:e(t).url,"onUpdate:modelValue":a[2]||(a[2]=l=>e(t).url=l),placeholder:e(o)("ai-mcp.backend.form.baseUrlPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label","description"]),r(s,{label:e(o)("ai-mcp.backend.form.type"),name:"communicationType",required:""},{default:c(()=>[r(b,{modelValue:e(t).communicationType,"onUpdate:modelValue":a[3]||(a[3]=l=>e(t).communicationType=l),placeholder:e(o)("ai-mcp.backend.form.type"),ui:{base:"w-full"},items:[{label:"sse",value:"sse"},{label:"streamable-http",value:"streamable-http"}]},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(s,{label:e(o)("ai-mcp.backend.form.headers"),name:"headers"},{default:c(()=>[r(d,{modelValue:e(t).customHeaders,"onUpdate:modelValue":a[4]||(a[4]=l=>e(t).customHeaders=l),placeholder:e(o)("ai-mcp.backend.form.customHeadersPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),p("div",be,[r(s,{label:e(o)("ai-mcp.backend.form.providerName"),name:"providerName"},{default:c(()=>[r(i,{modelValue:e(t).providerName,"onUpdate:modelValue":a[5]||(a[5]=l=>e(t).providerName=l),placeholder:e(o)("ai-mcp.backend.form.providerName"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(s,{label:e(o)("ai-mcp.backend.form.providerUrl"),name:"providerUrl"},{default:c(()=>[r(i,{modelValue:e(t).providerUrl,"onUpdate:modelValue":a[6]||(a[6]=l=>e(t).providerUrl=l),placeholder:e(o)("ai-mcp.backend.form.providerUrl"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",ve,[r(s,{label:e(o)("ai-mcp.backend.form.icon"),name:"iconUrl"},{default:c(()=>[r(u,{modelValue:e(t).icon,"onUpdate:modelValue":a[7]||(a[7]=l=>e(t).icon=l),class:"h-24 w-24",text:"上传图标",icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1},null,8,["modelValue"])]),_:1},8,["label"]),p("div",ke,[p("div",_e,[r(s,{label:e(o)("ai-mcp.backend.form.isDisabled"),name:"isDisabled"},{default:c(()=>[r($,{"model-value":!e(t).isDisabled,"onUpdate:modelValue":a[8]||(a[8]=l=>e(t).isDisabled=!l),"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"lg",label:e(t).isDisabled?e(o)("ai-mcp.backend.form.isActiveDisabled"):e(o)("ai-mcp.backend.form.isActiveEnabled")},null,8,["model-value","label"])]),_:1},8,["label"]),r(s,{label:e(o)("ai-mcp.backend.form.isQuickMenu"),name:"isQuickMenu"},{default:c(()=>[r($,{"model-value":e(t).isQuickMenu,"onUpdate:modelValue":a[9]||(a[9]=l=>e(t).isQuickMenu=l),"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"lg"},null,8,["model-value"])]),_:1},8,["label"])]),p("div",ge,[r(s,{label:e(o)("ai-mcp.backend.form.sortOrder"),name:"sortOrder"},{default:c(()=>[r(i,{modelValue:e(t).sortOrder,"onUpdate:modelValue":a[10]||(a[10]=l=>e(t).sortOrder=l),type:"number",placeholder:e(o)("ai-mcp.backend.form.sortOrder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(s,{label:e(o)("ai-mcp.backend.form.timeOut"),name:"timeout"},{default:c(()=>[r(i,{modelValue:e(t).timeout,"onUpdate:modelValue":a[11]||(a[11]=l=>e(t).timeout=l),type:"number",placeholder:e(o)("ai-mcp.backend.form.timeOut"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])])]),p("div",ye,[r(s,{label:e(o)("ai-mcp.backend.form.description"),name:"description"},{default:c(()=>[r(d,{modelValue:e(t).description,"onUpdate:modelValue":a[12]||(a[12]=l=>e(t).description=l),autoresize:"",placeholder:e(o)("ai-mcp.backend.form.descriptionPlaceholder"),rows:3,maxrows:8,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",he,[r(_,{color:"neutral",variant:"soft",size:"lg",onClick:a[13]||(a[13]=l=>f("close"))},{default:c(()=>[g(k(e(o)("console-common.cancel")),1)]),_:1}),r(_,{color:"primary",size:"lg",type:"submit",loading:e(S)},{default:c(()=>[g(k(e(v)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"]))]),_:1},8,["title","description"])}}});export{vo as default};
