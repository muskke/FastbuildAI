import $ from"./BruVSCWF.js";import{_ as V}from"./DS-TE4M7.js";import{_ as g}from"./CTGUoxQr.js";import{d as x,b as A,ap as h,aL as B,g as C,j as I,o as S,k as n,l as r,q as z,p as e,_ as F,x as _,v as b,bK as M,ao as q}from"#entry";import{_ as N}from"./D-6Co9ha.js";import{_ as R}from"./CXUt0j5Y.js";import{c as D,e as E}from"./BUyfW8JT.js";import"./BgHJjJs-.js";import"./DHFmmngs.js";import"./CR1AS2Ry.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./C3zg6GHm.js";import"./DVnbt8cp.js";import"./DuSMYVIA.js";import"./-Eb02sIQ.js";import"./Dk6FGhu1.js";import"./BPKB8n-W.js";import"./MN31c9CG.js";import"./CCcv9mzY.js";import"./BFAo_s2U.js";import"./Cb04SOqd.js";import"./VGKgjfSv.js";import"./DaWZu8wl.js";const G={class:"flex justify-end gap-2"},pe=x({__name:"edit-power",props:{user:{}},emits:["close"],setup(p,{emit:w}){const m=p,i=w,{t:o}=A(),c=h(),a=B({type:1,amount:0}),y=D({amount:E().required(o("user.backend.form.adjustAmountRequired")).min(0,o("user.backend.form.adjustAmountMin"))}),k=C(()=>{if(!m.user)return 0;const s=m.user.power||0,t=a.amount||0;return a.type===1?s+t:Math.max(0,s-t)}),v=async()=>{try{if(!m.user?.id){c.error("用户ID不存在");return}await M(m.user.id,a.amount,a.type);const s=q();s.userInfo?.id===m.user?.id&&s.getUser(),c.success(o("user.backend.form.adjustPowerSuccess")),i("close",!0)}catch(s){console.error("调整余额失败:",s),c.error(o("user.backend.form.adjustPowerError"))}};return(s,t)=>{const d=$,u=V,j=g,f=F,U=N,P=R;return S(),I(P,{title:e(o)("user.backend.form.editPower"),ui:{content:"max-w-sm overflow-y-auto h-fit"},onClose:t[3]||(t[3]=l=>i("close",!1))},{default:n(()=>[r(U,{state:e(a),schema:e(y),class:"space-y-4",onSubmit:v},{default:n(()=>[r(u,{label:e(o)("user.backend.form.currentPower"),name:"currentPower"},{default:n(()=>[r(d,{"model-value":p.user?.power||0,size:"lg",disabled:"",variant:"subtle",class:"w-full",type:"number"},null,8,["model-value"])]),_:1},8,["label"]),r(u,{label:e(o)("user.backend.form.powerAdjust"),name:"type"},{default:n(()=>[r(j,{modelValue:e(a).type,"onUpdate:modelValue":t[0]||(t[0]=l=>e(a).type=l),items:[{label:e(o)("user.backend.form.add"),value:1},{label:e(o)("user.backend.form.reduce"),value:0}],orientation:"horizontal",color:"primary"},null,8,["modelValue","items"])]),_:1},8,["label"]),r(u,{label:e(o)("user.backend.form.adjustAmount"),name:"amount"},{default:n(()=>[r(d,{modelValue:e(a).amount,"onUpdate:modelValue":t[1]||(t[1]=l=>e(a).amount=l),placeholder:e(o)("user.backend.form.adjustAmountInput"),size:"lg",class:"w-full",type:"number",min:"0"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:e(o)("user.backend.form.adjustedPower"),name:"adjustedPower"},{default:n(()=>[r(d,{"model-value":e(k),size:"lg",disabled:"",variant:"subtle",class:"w-full",type:"number"},null,8,["model-value"])]),_:1},8,["label"]),z("div",G,[r(f,{color:"neutral",variant:"soft",onClick:t[2]||(t[2]=l=>i("close",!1))},{default:n(()=>[_(b(e(o)("console-common.cancel")),1)]),_:1}),r(f,{color:"primary",type:"submit"},{default:n(()=>[_(b(e(o)("console-common.confirm")),1)]),_:1})])]),_:1},8,["state","schema"])]),_:1},8,["title"])}}});export{pe as default};
