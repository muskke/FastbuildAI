import{d as L,aq as Q,aJ as R,g as A,b as K,aM as T,aK as j,i as Y,j as w,o as h,k as c,c as G,p as e,l as r,y as W,q as p,x as g,v as k,_ as X}from"#entry";import Z from"./--UdezPG.js";import{_ as ee}from"./BYwSSEjb.js";import oe from"./CfxLE1oh.js";import{_ as ae}from"./EHoVw6ZP.js";import{_ as re}from"./CqN3ElKI.js";import{_ as te}from"./ZZC6mEJB.js";import{_ as le}from"./DNgvVYsj.js";import{_ as se}from"./BO1GPLSL.js";import{_ as ie}from"./BYK_1AlN.js";import{b as ne,c as ce,d as de,e as me}from"./BNVdDQJV.js";import{c as E,a as U}from"./BUyfW8JT.js";import"./BgHJjJs-.js";import"./8-c-A7PB.js";import"./DN9ov8OT.js";import"./TH-3OOuG.js";import"./b-_TUx9i.js";import"./DaNf1Wdt.js";import"./CKXZhss7.js";import"./Cfcu-t3n.js";import"./BstbYvQo.js";import"./B22A-h4k.js";import"./BaNg8fjw.js";import"./DlAUqK2U.js";import"./nBDBqKnC.js";import"./CLTNKp0S.js";import"./kRIii9yh.js";import"./C6Y-ieo6.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./Bub1HYiY.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./CP4Zo7YT.js";import"./XpsTG8vq.js";import"./DaWZu8wl.js";const pe={key:0,class:"flex items-center justify-center",style:{height:"400px"}},ue={class:"flex flex-col gap-4 pb-2"},fe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},be={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ve={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ke={class:"space-y-4"},_e={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ge={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ye={class:"py-4"},he={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Ue={class:"pb-2"},Ve={class:"flex flex-col gap-4 p-4"},$e={class:"flex flex-col"},je={class:"flex w-fit flex-col items-start gap-2"},we={class:"flex w-full items-start gap-1 rounded-lg bg-blue-50 p-2 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-200"},xe={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Se=`{
    "mcpServers": {
        "Your MCP Server Name": {
            "url": "xxxxx",
            // type: sse or streamable-http
            "type": "sse or streamable-http",
            "headers": {
                "Content-Type": "application/json",
                "Authorization": "Bearer Your Token"
                ...
            },
            ...
        }
    }
}`,fo=L({__name:"edit",props:{id:{},isJsonImport:{type:Boolean}},emits:["close","change-update"],setup(x,{emit:M}){const V=Q(),N=R(),O=x,f=M,v=A(()=>O.id||N.query.id||null),{t:o}=K(),t=T({name:"",providerName:"",description:"",icon:"",isDisabled:!1,url:"",sortOrder:0,communicationType:void 0,timeout:60,isQuickMenu:!1,alias:"",providerUrl:"",customHeaders:""}),y=T({jsonImport:""}),q=E({name:U().required(o("ai-mcp.backend.form.name")),url:U().required(o("ai-mcp.backend.form.baseUrlPlaceholder")).test("is-valid-url",o("ai-mcp.backend.form.baseUrlPlaceholder"),n=>{if(!n)return!1;if(/^(https?:\/\/)?[\w\d-]+(\.[\w\d-]+)+([\w\d\-.,@?^=%&:/~+#]*[\w\d=#])?$/.test(n))return!0;try{return new URL(n),!0}catch{return!1}}),communicationType:U().required(o("ai-mcp.backend.form.communicationType"))}),C=E({jsonImport:U().required(o("ai-mcp.backend.validation.jsonRequired")).test("is-valid-json",o("ai-mcp.backend.validation.jsonFormatError"),n=>{if(!n)return!1;try{return JSON.parse(n),!0}catch{return!1}}).test("validate-required-fields",(n,a)=>{if(!n)return!0;try{const d=JSON.parse(n);if(!d.mcpServers||typeof d.mcpServers!="object")return a.createError({message:o("ai-mcp.backend.validation.missingMcpServers")});const s=d.mcpServers;if(Object.keys(s).length===0)return a.createError({message:o("ai-mcp.backend.validation.emptyMcpServers")});for(const[m,b]of Object.entries(s)){if(!b||typeof b!="object")return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidConfig")}`});const u=b;if(!u.url)return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.missingUrl")}`});if(typeof u.url!="string")return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidUrlType")}`});if(!u.type)return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.missingType")}`});if(typeof u.type!="string")return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidTypeValue")}`});if(!["sse","streamable-http"].includes(u.type))return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidTypeEnum")}`});if(u.headers!==void 0&&(typeof u.headers!="object"||u.headers===null))return a.createError({message:`"${m}" ${o("ai-mcp.backend.validation.invalidHeaders")}`})}return!0}catch{return a.createError({message:o("console-ai-mcp-server.validation.jsonFormatError")})}})}),{lockFn:D,isLock:F}=j(async()=>{try{const n=await ne(v.value);Object.keys(t).forEach(a=>{const d=a,s=n[d];if(s!==void 0)if(d==="customHeaders")if(typeof s=="object"&&s!==null){const i=Object.entries(s).map(([m,b])=>`${m}=${b}`).join(",");t[d]=i}else t[d]=s||"";else typeof s=="object"&&s!==null?Object.keys(s).length>0&&(t[d]=s):t[d]=s})}catch(n){console.error("获取供应商详情失败:",n)}}),z=n=>{if(!n?.trim())return{};const a={};return n.split(/[,\n]/).filter(s=>s.trim()).forEach(s=>{const[i,...m]=s.split("=");if(i?.trim()&&m.length>0){const b=m.join("=");a[i.trim()]=b.trim()}}),a},{lockFn:H,isLock:S}=j(async()=>{const{customHeaders:n,...a}=t,d=z(n),s={...a,customHeaders:d};try{let i="";v.value?(i=(await ce(v.value,s)).id,f("change-update",[i]),V.success(o("ai-mcp.backend.updateSuccess"))):(i=(await de(s)).id,f("change-update",[i]),V.success(o("ai-mcp.backend.createSuccess"))),f("close",!0)}catch(i){console.error("提交失败:",i)}}),{lockFn:B}=j(async()=>{try{const n=await me(y.jsonImport||"");V.success(`${o("ai-mcp.backend.jsonImportTotal")} ${n.total} ${o("ai-mcp.backend.jsonImportUnit")}，
            ${o("console-common.create")} ${n.created} ${o("ai-mcp.backend.jsonImportUnit")}，
            ${o("console-common.update")} ${n.updated} ${o("ai-mcp.backend.jsonImportUnit")}`);const a=n.results.map(d=>d.id);f("change-update",a),f("close",!0)}catch(n){console.error("JSON导入失败:",n)}});return Y(async()=>v.value&&await D()),(n,a)=>{const d=W,s=Z,i=ee,m=oe,b=ae,u=re,$=te,_=X,I=le,P=se,J=ie;return h(),w(J,{title:e(v)?e(o)("ai-mcp.backend.editTitle"):e(o)("ai-mcp.backend.addTitle"),description:e(v)?e(o)("ai-mcp.backend.editTitle"):e(o)("ai-mcp.backend.addTitle"),ui:{content:"max-w-2xl overflow-y-auto h-fit"},"onUpdate:modelValue":a[16]||(a[16]=l=>!l&&f("close")),onClose:a[17]||(a[17]=l=>f("close"))},{default:c(()=>[e(F)?(h(),G("div",pe,[r(d,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):x.isJsonImport?(h(),w(I,{key:2,state:e(y),schema:e(C),onSubmit:e(B)},{default:c(()=>[p("div",Ue,[r(i,{label:e(o)("ai-mcp.backend.form.jsonImport"),name:"jsonImport",required:""},{hint:c(()=>[r(P,{mode:"click","open-delay":0,"close-delay":0},{content:c(()=>[p("div",Ve,[p("div",$e,[p("div",je,[p("div",we,[r(d,{size:"20",name:"i-tabler-alert-circle"}),p("span",null,k(e(o)("ai-mcp.backend.jsonImportCorrectExample")),1)]),p("pre",{class:"bg-muted w-full overflow-x-auto rounded-lg p-4 text-sm"},[p("code",null,k(Se))])])])])]),default:c(()=>[r(_,{variant:"link",class:"text-primary cursor-pointer text-xs"},{default:c(()=>[g(k(e(o)("ai-mcp.backend.jsonImportExample")),1)]),_:1})]),_:1})]),default:c(()=>[r(m,{modelValue:e(y).jsonImport,"onUpdate:modelValue":a[14]||(a[14]=l=>e(y).jsonImport=l),placeholder:e(o)("ai-mcp.backend.form.jsonImportPlaceholder"),rows:13,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",xe,[r(_,{color:"neutral",variant:"soft",size:"lg",onClick:a[15]||(a[15]=l=>f("close"))},{default:c(()=>[g(k(e(o)("console-common.cancel")),1)]),_:1}),r(_,{color:"primary",size:"lg",type:"submit",loading:e(S)},{default:c(()=>[g(k(e(v)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])):(h(),w(I,{key:1,state:e(t),schema:e(q),onSubmit:e(H)},{default:c(()=>[p("div",ue,[p("div",fe,[r(i,{label:e(o)("ai-mcp.backend.form.name"),name:"name",required:""},{default:c(()=>[r(s,{modelValue:e(t).name,"onUpdate:modelValue":a[0]||(a[0]=l=>e(t).name=l),placeholder:e(o)("ai-mcp.backend.form.name"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:e(o)("ai-mcp.backend.form.alias"),name:"alias"},{default:c(()=>[r(s,{modelValue:e(t).alias,"onUpdate:modelValue":a[1]||(a[1]=l=>e(t).alias=l),placeholder:e(o)("ai-mcp.backend.form.alias"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),r(i,{label:e(o)("ai-mcp.backend.form.baseUrl"),name:"url",required:"",description:e(o)("ai-mcp.backend.form.baseUrlTips")},{default:c(()=>[r(m,{modelValue:e(t).url,"onUpdate:modelValue":a[2]||(a[2]=l=>e(t).url=l),placeholder:e(o)("ai-mcp.backend.form.baseUrlPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label","description"]),r(i,{label:e(o)("ai-mcp.backend.form.type"),name:"communicationType",required:""},{default:c(()=>[r(b,{modelValue:e(t).communicationType,"onUpdate:modelValue":a[3]||(a[3]=l=>e(t).communicationType=l),placeholder:e(o)("ai-mcp.backend.form.type"),ui:{base:"w-full"},items:[{label:"sse",value:"sse"},{label:"streamable-http",value:"streamable-http"}]},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:e(o)("ai-mcp.backend.form.headers"),name:"headers"},{default:c(()=>[r(m,{modelValue:e(t).customHeaders,"onUpdate:modelValue":a[4]||(a[4]=l=>e(t).customHeaders=l),placeholder:e(o)("ai-mcp.backend.form.customHeadersPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),p("div",be,[r(i,{label:e(o)("ai-mcp.backend.form.providerName"),name:"providerName"},{default:c(()=>[r(s,{modelValue:e(t).providerName,"onUpdate:modelValue":a[5]||(a[5]=l=>e(t).providerName=l),placeholder:e(o)("ai-mcp.backend.form.providerName"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:e(o)("ai-mcp.backend.form.providerUrl"),name:"providerUrl"},{default:c(()=>[r(s,{modelValue:e(t).providerUrl,"onUpdate:modelValue":a[6]||(a[6]=l=>e(t).providerUrl=l),placeholder:e(o)("ai-mcp.backend.form.providerUrl"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",ve,[r(i,{label:e(o)("ai-mcp.backend.form.icon"),name:"iconUrl"},{default:c(()=>[r(u,{modelValue:e(t).icon,"onUpdate:modelValue":a[7]||(a[7]=l=>e(t).icon=l),class:"h-24 w-24",text:"上传图标",icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1},null,8,["modelValue"])]),_:1},8,["label"]),p("div",ke,[p("div",_e,[r(i,{label:e(o)("ai-mcp.backend.form.isDisabled"),name:"isDisabled"},{default:c(()=>[r($,{"model-value":!e(t).isDisabled,"onUpdate:modelValue":a[8]||(a[8]=l=>e(t).isDisabled=!l),"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"lg",label:e(t).isDisabled?e(o)("ai-mcp.backend.form.isActiveDisabled"):e(o)("ai-mcp.backend.form.isActiveEnabled")},null,8,["model-value","label"])]),_:1},8,["label"]),r(i,{label:e(o)("ai-mcp.backend.form.isQuickMenu"),name:"isQuickMenu"},{default:c(()=>[r($,{"model-value":e(t).isQuickMenu,"onUpdate:modelValue":a[9]||(a[9]=l=>e(t).isQuickMenu=l),"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"lg"},null,8,["model-value"])]),_:1},8,["label"])]),p("div",ge,[r(i,{label:e(o)("ai-mcp.backend.form.sortOrder"),name:"sortOrder"},{default:c(()=>[r(s,{modelValue:e(t).sortOrder,"onUpdate:modelValue":a[10]||(a[10]=l=>e(t).sortOrder=l),type:"number",placeholder:e(o)("ai-mcp.backend.form.sortOrder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{label:e(o)("ai-mcp.backend.form.timeOut"),name:"timeout"},{default:c(()=>[r(s,{modelValue:e(t).timeout,"onUpdate:modelValue":a[11]||(a[11]=l=>e(t).timeout=l),type:"number",placeholder:e(o)("ai-mcp.backend.form.timeOut"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])])]),p("div",ye,[r(i,{label:e(o)("ai-mcp.backend.form.description"),name:"description"},{default:c(()=>[r(m,{modelValue:e(t).description,"onUpdate:modelValue":a[12]||(a[12]=l=>e(t).description=l),autoresize:"",placeholder:e(o)("ai-mcp.backend.form.descriptionPlaceholder"),rows:3,maxrows:8,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),p("div",he,[r(_,{color:"neutral",variant:"soft",size:"lg",onClick:a[13]||(a[13]=l=>f("close"))},{default:c(()=>[g(k(e(o)("console-common.cancel")),1)]),_:1}),r(_,{color:"primary",size:"lg",type:"submit",loading:e(S)},{default:c(()=>[g(k(e(v)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"]))]),_:1},8,["title","description"])}}});export{fo as default};
