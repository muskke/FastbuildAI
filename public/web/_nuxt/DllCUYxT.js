const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CnRno43X.js","./IZm275qp.js","./Dg6D3RQ3.js","./DS-TE4M7.js","./BgHJjJs-.js","./CoK0jBu7.js","./CQBV3TNh.js","./BFVs1AfH.js","./DHFmmngs.js","./kRIii9yh.js","./Btvd554H.js","./MN31c9CG.js","./C6Y-ieo6.js","./BPKB8n-W.js","./B-DdbQ-X.js","./V9POJiZu.js","./CuOaO1Pb.js","./D6yWePie.js","./DuSMYVIA.js","./3UOIlTK8.js","./DduSJdeS.js","./VGKgjfSv.js","./Dkb19qXD.js","./BMSQkwth.js","./DaWZu8wl.js","./5XG8SC4l.js","./CR1AS2Ry.js","./C3zg6GHm.js","./D-6Co9ha.js","./CXUt0j5Y.js","./-Eb02sIQ.js","./Dk6FGhu1.js","./CCcv9mzY.js","./BFAo_s2U.js","./Cb04SOqd.js","./ChM0pAjz.js","./D-hk-k_E.js","./BUyfW8JT.js","./BNXi4epI.js","./i5AwkGQh.js","./BcsO9TDZ.js","./DlAUqK2U.js","./C304YI96.js","./BruVSCWF.js","./CRoF6I1E.js","./BstbYvQo.js"])))=>i.map(i=>d[i]);
import{d as Me,b as Ve,ap as Ae,b8 as Ee,s as R,i as Ue,G as ie,w as te,aY as X,aZ as ee,g as L,aR as at,j as $,o as s,b6 as st,k as p,q as a,l as u,c as m,t as _,T as nt,p as e,C as ot,v as k,_ as Be,y as De,x as Re,F as S,B as A,n as Ce,z as ae,A as re,f as lt,aS as it,h as he,aK as ye,aI as rt,Q as ct,e as ut,aM as dt,O as $e,au as mt,ao as ft,bE as Te,af as pt,aU as vt,D as gt,R as _e,E as ht,br as _t,U as xe}from"#entry";import{_ as xt}from"./DfmzrqHf.js";import{_ as yt,a as kt}from"./lwzf8G4w.js";import{_ as bt}from"./COxNVqQJ.js";import{_ as wt}from"./RuzXXHQK.js";import{_ as Le}from"./i5AwkGQh.js";import{_ as Ct}from"./BkAysFbf.js";import{g as $t,h as Tt,i as St,j as zt,k as Se,l as Ft,m as It}from"./D-hk-k_E.js";import{e as Mt}from"./B1XcE43x.js";import{e as ze}from"./Bni8bPEl.js";import Vt from"./BruVSCWF.js";import{_ as At}from"./DS-TE4M7.js";import{_ as Et}from"./CQBV3TNh.js";import{_ as Ut}from"./BNWstlnh.js";import{_ as Bt}from"./CcXhcZIb.js";import{g as Dt}from"./eeyg4-1U.js";import{u as Fe}from"./BREwXy1w.js";import{d as Rt}from"./Cb04SOqd.js";import{_ as Lt}from"./DlAUqK2U.js";import{u as Ie}from"./BV27uQF0.js";import{u as jt}from"./BM6CYti3.js";const Nt={class:"relative h-full flex-1"},Pt={key:0,class:"flex h-full min-h-0 w-[240px] flex-col"},qt={class:"border-border/50 border-b p-4"},Ot={class:"flex items-center gap-3"},Gt={class:"min-w-0 flex-1"},Qt={class:"truncate font-medium"},Ht={class:"h-full flex-1 overflow-hidden"},Kt={key:0,class:"text-muted-foreground flex h-full flex-col items-center justify-center text-center text-sm"},Yt={class:"mb-2"},Zt={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},Jt={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},Wt={class:"flex flex-col gap-1"},Xt={class:"block flex-1 truncate text-left"},ea={key:0,class:"flex flex-col gap-4 py-4"},ta={class:"px-2 py-1"},aa={class:"flex flex-col gap-1"},sa={key:0,class:"absolute top-4 left-4 z-50 flex items-center gap-2"},na={class:"group relative"},oa={class:"block flex-1 truncate text-left text-sm"},la={key:0,class:"text-muted-foreground flex h-full w-50 flex-col items-center justify-center text-center text-sm"},ia={class:"mb-2"},ra={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},ca={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},ua={class:"flex flex-col gap-1"},da={class:"block flex-1 truncate text-left"},ma={key:0,class:"flex flex-col gap-4 py-4"},fa={class:"px-2 py-1"},pa={class:"flex flex-col gap-1"},va=Me({inheritAttrs:!1,__name:"chats-list",props:{agent:{},publishToken:{},accessToken:{},modelValue:{}},emits:["update:modelValue","new-conversation","switch-conversation"],async setup(b,{emit:h}){let T,Y;const v=b,j=h,ce=Vt,C=At,{t:Z}=Ve(),se=Ae(),x=at(v,"modelValue",j),E=Ee("(max-width: 768px)"),z=R(!1),w=R(!1);Ue(()=>{ie(()=>{E.value||(z.value=!0)})}),te(E,c=>{c?z.value=!1:(w.value=!1,z.value=!0)},{immediate:!1});const{data:ue,pending:q}=([T,Y]=X(()=>ee(()=>`public-agent-conversations-${v.publishToken}-${v.accessToken}`,()=>v.accessToken?$t(v.publishToken,v.accessToken,{page:1,pageSize:50}):{items:[]},{watch:[()=>v.accessToken]})),T=await T,Y(),T),g=L(()=>ue.value?.items||[]),U=L(()=>g.value?.length?Dt(g.value,"updatedAt",Z):[]);te(g,c=>{c?.length>0&&((v.modelValue?c.some(M=>M.id===v.modelValue):!1)?v.modelValue||j("switch-conversation",c[0]):(x.value=null,j("switch-conversation",c[0])))},{immediate:!0});const H=c=>{w.value=!1,j("switch-conversation",c)},N=()=>{j("new-conversation")},J=()=>{E.value?(w.value=!0,z.value=!1):(w.value=!1,z.value=!0)},F=async c=>{const o=lt(c.title);try{const M=it({setup(){return()=>he("div",{class:"py-2"},[he(C,{label:"对话标题",size:"lg",required:!0,error:o.value.trim()?"":"对话标题不能为空"},{default:()=>he(ce,{modelValue:o.value,"onUpdate:modelValue":I=>{o.value=I},placeholder:"请输入对话标题",maxlength:50,class:"w-full"})})])}});await Fe({title:"编辑对话标题",content:M,confirmText:"保存",cancelText:"取消",color:"primary",ui:{content:"!w-sm"}}),o.value.trim()&&o.value!==c.title&&await B(c.id,o.value)}catch(M){console.log("用户取消编辑操作:",M)}},B=async(c,o)=>{try{await Tt(v.publishToken,v.accessToken,c,{title:o}),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),se.success("对话标题更新成功")}catch(M){console.error("更新对话标题失败:",M)}},O=async c=>{if(v.accessToken)try{await St(v.publishToken,v.accessToken,c.id),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),v.modelValue===c.id&&(x.value=null,j("new-conversation")),se.success(Z("common.message.deleteSuccess"))}catch(o){console.error("删除对话失败:",o)}},ne=async c=>{try{await Fe({color:"error",title:"确认删除",content:"确定要删除这个会话吗？删除后无法恢复。",confirmText:"删除",cancelText:"取消",ui:{content:"!w-sm"}})&&await O(c)}catch(o){console.log("用户取消删除操作:",o)}},de=c=>[{label:"编辑",color:"primary",icon:"i-lucide-pencil",onSelect:()=>F(c)},{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ne(c)}];return Rt({o:()=>w.value=!w.value}),(c,o)=>{const M=ot,I=De,D=Be,n=Et,K=Ut,oe=Le,me=Bt,fe=st;return s(),$(fe,null,{default:p(()=>[a("div",Nt,[u(nt,{name:"sidebar"},{default:p(()=>[e(z)?(s(),m("div",Pt,[a("div",qt,[a("div",Ot,[u(M,{src:b.agent?.avatar,alt:b.agent?.name,size:"sm"},null,8,["src","alt"]),a("div",Gt,[a("h2",Qt,k(b.agent?.name),1)]),u(D,{color:"neutral",variant:"ghost",size:"sm",class:"p-2",onClick:o[0]||(o[0]=i=>z.value=!1)},{default:p(()=>[u(I,{name:"i-lucide-panel-left",class:"size-5"})]),_:1})]),u(D,{class:"mt-3 w-full",color:"primary",variant:"soft",onClick:N},{default:p(()=>[u(I,{name:"i-lucide-plus",class:"mr-2 size-4"}),o[4]||(o[4]=Re(" 新建会话 ",-1))]),_:1})]),a("div",Ht,[!e(U).length&&!e(q)?(s(),m("div",Kt,[a("div",Yt,[u(I,{name:"i-lucide-message-circle",size:"lg",class:"text-muted-foreground"})]),o[5]||(o[5]=a("p",null,"暂无会话记录",-1)),o[6]||(o[6]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(s(),$(oe,{key:1,class:"grid h-full"},{default:p(()=>[a("div",Zt,[(s(!0),m(S,null,A(e(U),i=>(s(),m("div",{key:i.key,class:"flex flex-col gap-2"},[a("div",Jt,k(i.label),1),a("div",Wt,[(s(!0),m(S,null,A(i.items,f=>(s(),m("div",{key:f.id,class:"group relative"},[u(D,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===b.modelValue?"soft":"ghost",color:f.id===b.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",Xt,k(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),u(n,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[u(I,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===b.modelValue}]),onClick:o[1]||(o[1]=Ce(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(q)?(s(),m("div",ea,[(s(),m(S,null,A(3,i=>a("div",{key:`group-${i}`,class:"flex flex-col gap-2"},[a("div",ta,[u(K,{class:"h-4 w-16"})]),a("div",aa,[(s(!0),m(S,null,A(i===1?3:i===2?2:1,f=>(s(),$(K,{key:`item-${i}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))]),o[7]||(o[7]=a("div",{class:"border-border/50 border-t pt-2"},[a("div",{class:"text-muted-foreground flex items-center justify-center gap-1 text-xs"},[a("span",null,"Powered by"),a("a",{href:"https://buildingai.cc",target:"_blank",class:"text-primary font-medium hover:underline"}," BuildingAI ")])],-1))])):_("",!0)]),_:1}),e(z)?_("",!0):(s(),m("div",sa,[u(D,{color:"neutral",variant:"soft",size:"lg",class:"p-2",onClick:J},{default:p(()=>[u(I,{name:"i-lucide-panel-right",class:"size-5"})]),_:1}),o[9]||(o[9]=a("div",{class:"text-muted-foreground mx-1"},"/",-1)),a("div",na,[b.modelValue?(s(),$(n,{key:1,items:[{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ne(e(g).find(i=>i.id===b.modelValue))},{label:"新建对话",color:"primary",icon:"i-lucide-plus",onSelect:()=>N()}],ui:{content:"w-32",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"bottom",align:"center"}},{default:p(()=>[u(D,{label:e(g).find(i=>i.id===b.modelValue)?.title||"当前对话",variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:p(()=>[a("span",oa,k(e(g).find(i=>i.id===b.modelValue)?.title||"当前对话"),1),u(I,{name:"i-lucide-chevron-down",class:"size-5"})]),_:1},8,["label"])]),_:1},8,["items"])):(s(),$(D,{key:0,variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:p(()=>[...o[8]||(o[8]=[a("span",{class:"block flex-1 truncate text-left text-sm"},"New Chat",-1)])]),_:1}))])])),u(me,{open:e(w),"onUpdate:open":o[3]||(o[3]=i=>re(w)?w.value=i:null),side:"left",ui:{content:"!w-fit flex-0 max-w-fit"}},{content:p(()=>[!e(U).length&&!e(q)?(s(),m("div",la,[a("div",ia,[u(I,{name:"i-lucide-message-circle",size:"lg",class:"text-gray-400"})]),o[10]||(o[10]=a("p",null,"暂无会话记录",-1)),o[11]||(o[11]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(s(),$(oe,{key:1,class:"h-full"},{default:p(()=>[a("div",ra,[(s(!0),m(S,null,A(e(U),i=>(s(),m("div",{key:i.key,class:"flex flex-col gap-2"},[a("div",ca,k(i.label),1),a("div",ua,[(s(!0),m(S,null,A(i.items,f=>(s(),m("div",{key:f.id,class:"group relative"},[u(D,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===b.modelValue?"soft":"ghost",color:f.id===b.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",da,k(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),u(n,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[u(I,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===b.modelValue}]),onClick:o[2]||(o[2]=Ce(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(q)?(s(),m("div",ma,[(s(),m(S,null,A(3,i=>a("div",{key:`group-${i}`,class:"flex flex-col gap-2"},[a("div",fa,[u(K,{class:"h-4 w-16"})]),a("div",pa,[(s(!0),m(S,null,A(i===1?3:i===2?2:1,f=>(s(),$(K,{key:`item-${i}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))]),_:1},8,["open"])])]),_:1})}}}),ga=Lt(va,[["__scopeId","data-v-e3d15c41"]]),ha={class:"bg-secondary h-full flex-none"},_a={key:0,class:"flex h-full w-full items-center justify-center"},xa={class:"flex items-center gap-3"},ya={class:"text-lg"},ka={key:1,class:"flex h-full w-full items-center justify-center"},ba={class:"text-center"},wa={class:"mb-2 text-xl font-semibold"},Ca={class:"text-muted-foreground"},$a={class:"text-muted-foreground text-sm"},Ta={key:0,class:"flex items-center gap-2"},Sa={class:"my-2 flex items-center gap-1"},za={class:"text-muted-foreground flex-none text-xs"},Fa={key:1,class:"mb-2 space-y-2"},Ia={key:2,class:"bg-background shadow-default my-6 w-full rounded-2xl"},Ma={class:"text-foreground border-muted/10 text-md flex items-center justify-between border-b p-4 font-medium"},Va={class:"flex items-center gap-2"},Aa={key:0,class:"mt-2 p-4"},Ea={class:"w-full max-w-[800px] p-4 lg:py-2"},Ua={key:0,class:"mb-3"},Ba={class:"flex flex-wrap gap-2"},Da={key:0,class:"text-muted-foreground text-xs"},ls=Me({__name:"chat",props:{billingMode:{}},async setup(b){let h,T;const Y=_e(()=>xe(()=>import("./CnRno43X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url)),v=_e(()=>xe(()=>import("./BNXi4epI.js"),__vite__mapDeps([38,39,1,40,41,29,30,31,13,18,11,32,33,34,21]),import.meta.url)),j=_e(()=>xe(()=>import("./C304YI96.js"),__vite__mapDeps([42,43,1,3,4,2,44,8,26,10,13,14,15,11,45,18,28,37,24]),import.meta.url)),ce=b,{t:C}=Ve(),Z=Ee("(max-width: 768px)"),{params:se}=rt(),x=L(()=>se.id||""),E=Ae(),z=ct(),w=ut("scrollAreaRef"),{height:ue}=dt(w),q=$e(`public_agent_conversation_${x.value}`),g=R(q.value||null),U=R(!0),H=R(""),N=R(null),J=R({question:"",answer:"",enabled:!0}),F=R(!1);te(g,t=>{q.value=t});const B=mt({page:1,pageSize:15}),O=R(!1),{data:ne,refresh:de}=([h,T]=X(async()=>ee(`access-token-${x.value}`,async()=>{const t=`public_agent_token_${x.value}`,l=$e(t);if(l.value)return{accessToken:l.value,fromCache:!0};try{const d=await zt(x.value);return l.value=d.accessToken,{...d,fromCache:!1}}catch(d){throw console.error("生成访问令牌失败:",d),d}})),h=await h,T(),h),c=L(()=>ne.value?.accessToken||""),{data:o,refresh:M}=([h,T]=X(()=>ee(()=>!g.value||!c.value?(console.log("conversationId.value",g.value),{items:[],total:0,page:B.page,pageSize:B.pageSize}):Se(x.value,c.value,g.value,B),{transform:t=>t},"$zgx5FY2pBK")),h=await h,T(),h),{data:I}=([h,T]=X(()=>ee("chat-config",()=>Mt())),h=await h,T(),h);o.value||(H.value="智能体不存在或未发布"),o.value?.items?.length||(g.value=null),O.value=o.value?.total>(o.value?.items?.length||0);const D=L(()=>o.value?.items?o.value.items.map(t=>({...t,id:t.id||Ie(),avatar:n.value?.chatAvatar||n.value?.avatar,status:"completed"})):[]),{data:n,pending:K}=([h,T]=X(()=>ee(`public-agent-${x.value}`,()=>Ft(x.value,c.value))),h=await h,T(),h),oe=()=>{g.value=null,B.page=1,i.value=[],F.value=!0,n.value&&(n.value.formFieldsInputs={})},me=async t=>{t.id!==g.value&&(g.value=t.id,B.page=1,M(),G())},fe=t=>{if(!n.value)return;const l=t.slice().reverse().find(d=>d?.role==="user"&&d.formFieldsInputs);console.log("lastUserMessage",l),n.value.formFieldsInputs=l?.formFieldsInputs||{}},{messages:i,input:f,files:W,handleSubmit:je,reload:Ne,stop:Pe,status:qe,error:Oe}=jt({api:It,initialMessages:[],chatConfig:{get avatar(){return n.value?.chatAvatar||n.value?.avatar}},body:{publishToken:x.value,accessToken:c.value,saveConversation:!0,get conversationId(){return g.value},get billingMode(){return ce.billingMode},get formFields(){return n.value?.formFields||[]},get formFieldsInputs(){return n.value?.formFieldsInputs||{}}},onToolCall(){},onResponse(t){t.status===401&&ft().logout(!0)},onUpdate(t){t.type==="conversation_id"&&(g.value=t.data,ye(`public-agent-conversations-${x.value}-${c.value}`))},onError(t){console.error("聊天错误:",t?.message||"发送失败")},onFinish(t){console.log("聊天完成:",t)}}),pe=L(()=>qe.value==="loading"),Ge=async()=>{if(!(!O.value||!g.value||!x.value||!c.value)){B.page++;try{const t=await Se(x.value,c.value,g.value,B),l=t.items?.reverse().map(d=>({id:d.id||Ie(),role:d.role,content:d.content,status:"completed",mcpToolCalls:d.mcpToolCalls}))||[];i.value.unshift(...l),O.value=t.total>i.value.length}catch(t){B.page--,console.error("加载更多消息失败:",t),O.value=!0}}},ve=Te(t=>{const l=t.target,d=40;U.value=l.scrollHeight-(l.scrollTop+l.clientHeight)<=d},100),G=async(t=!0)=>{await ie(),w.value?.scrollToBottom(t)},ke=()=>{if(!n.value)return E.error("智能体信息未加载"),!1;const t=n.value.formFields||[],l=n.value.formFieldsInputs||{};if(t.length===0)return!0;const d=[];return t.forEach(y=>{if(y.required){const V=l[y.name];(!V||typeof V=="string"&&V.trim()==="")&&d.push(`${y.label}是必填字段`)}}),d.length>0?(E.error(`表单验证失败: ${d.join(", ")}`),!1):!0},Qe=()=>{ke()&&(F.value=!1)},le=async t=>{if(!(!t.trim()||pe.value)){if(!n.value)return E.error("智能体信息未加载");if(!c.value)return E.error("请先生成访问令牌");ke()&&(await je(t),G())}};te(D,t=>{t&&(i.value=[...t],fe(t),ie(()=>{t.length>0?G(!1):F.value=!0}))},{immediate:!0}),te(()=>i.value.at(-1)?.content,()=>{ie(()=>{U.value&&G(!1)})},{flush:"post"});const He=t=>{z.create(v).open({context:t})},Ke=(t,l=null)=>{N.value=l,z.create(Y).open({agentId:n.value?.id,annotationId:t,messageId:l,isPublic:!0,publishToken:x.value,accessToken:c.value,initialData:void 0,onResult:y=>{be(!0,y)}})},Ye=(t,l)=>{const d=i.value[l-1];if(!d||d.role!=="user"){E.error("找不到对应的用户问题");return}J.value={question:ze(d.content),answer:ze(t.content),enabled:!0},N.value=t.id||null,z.create(Y).open({agentId:n.value?.id,annotationId:null,messageId:t.id||null,isPublic:!0,publishToken:x.value,accessToken:c.value,initialData:J.value,onResult:V=>{be(!0,V)}})};function be(t,l){if(l?.id&&N.value){const d=i.value.findIndex(y=>y.id===N.value);if(d>=0){const y=i.value[d];y&&!y.metadata&&(y.metadata={}),y?.metadata&&(y.metadata.annotations={annotationId:l.id,createdBy:"",question:"",similarity:1})}}N.value=null,J.value={question:"",answer:"",enabled:!0}}let ge=null;return Ue(async()=>{G(!1);const t=w.value?.getViewportElement(),l=t&&t.viewportElement;if(l){l.addEventListener("scroll",ve,{passive:!0}),ve({target:l});const d=Te(()=>{U.value&&G(!1)},50);ge=new MutationObserver(()=>{d()}),ge.observe(l,{childList:!0,subtree:!1,characterData:!1})}}),pt(()=>{const t=w.value?.getViewportElement();(t&&t.viewportElement)?.removeEventListener("scroll",ve),ge?.disconnect()}),vt({title:L(()=>n.value?`${n.value.name} - BuildingAI`:"BuildingAI"),link:[{rel:"icon",href:L(()=>n.value?.avatar||"/favicon.ico")},{rel:"apple-touch-icon",href:L(()=>n.value?.avatar||"/favicon.ico")}]}),(t,l)=>{const d=De,y=xt,V=Be,we=kt,Ze=bt,Je=wt,We=yt,Xe=Le,et=_t,tt=Ct;return s(),m("div",{class:ae(["ai-chat bg-secondary flex h-full min-h-0 items-center justify-center rounded-l-xl p-2",{"p-0!":e(Z)}])},[a("div",ha,[u(ga,{agent:e(n),"publish-token":e(x),"access-token":e(c),modelValue:e(g),"onUpdate:modelValue":l[0]||(l[0]=r=>re(g)?g.value=r:null),onNewConversation:oe,onSwitchConversation:me},null,8,["agent","publish-token","access-token","modelValue"])]),a("div",{class:ae(["bg-background flex h-full min-h-0 w-full flex-col items-center rounded-xl",{"rounded-none!":e(Z)}])},[e(K)?(s(),m("div",_a,[a("div",xa,[u(d,{name:"i-lucide-loader-2",class:"text-primary size-6 animate-spin"}),a("span",ya,k(t.$t("ai-agent.frontend.chat.loadingAgent")),1)])])):e(H)?(s(),m("div",ka,[a("div",ba,[u(d,{name:"i-lucide-alert-circle",class:"text-error mx-auto mb-4 size-12"}),a("h2",wa,k(t.$t("ai-agent.frontend.chat.loadingFailed")),1),a("p",Ca,k(e(H)),1)])])):e(n)?(s(),m(S,{key:2},[l[6]||(l[6]=a("div",{class:"flex h-12 w-full items-center justify-center"},null,-1)),u(Xe,{class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:w,onInView:l[3]||(l[3]=r=>G(!1))},{default:p(()=>[u(We,{loading:!1,"has-more":e(O),threshold:500,"content-class":"max-w-[800px] w-full space-y-3 p-4 lg:py-4",onLoadMore:Ge},{default:p(()=>[e(i).length===0&&(!e(F)||!e(n).formFields?.length)&&e(n).openingStatement?.length&&e(n).openingQuestions?.length?(s(),$(we,{key:0,messages:[{role:"assistant",avatar:e(n)?.chatAvatar||e(n)?.avatar,content:e(n)?.openingStatement||""}],"scroll-area-height":200,assistant:{actions:[]}},{content:p(({message:r})=>[u(y,{content:r.content.toString(),"show-run-button":!1},null,8,["content"]),a("div",{class:ae(["flex flex-col gap-2",{"ml-4":e(n)?.avatar}])},[a("div",$a,k(t.$t("ai-agent.frontend.chat.youCanAskMe")),1),(s(!0),m(S,null,A(e(n)?.openingQuestions||[],P=>(s(),m("div",{key:P},[u(V,{label:P,color:"primary",variant:"soft",onClick:Q=>le(P)},null,8,["label","onClick"])]))),128))],2)]),_:1},8,["messages"])):_("",!0),e(i).length!==0?(s(),$(we,{key:1,messages:e(i),"scroll-area-height":e(ue),error:e(Oe),assistant:{actions:[{label:e(C)("ai-chat.frontend.messages.retry"),icon:"i-lucide-rotate-cw-square",onClick:()=>e(Ne)()},{label:e(C)("ai-agent.frontend.chat.chatContext"),icon:"i-lucide-file-type",show:!e(n).showContext,onClick:r=>{r?.metadata?.context?He(r.metadata.context):e(E).error(e(C)("ai-agent.backend.configuration.noChatContext"))}},{label:e(C)("ai-agent.frontend.chat.annotation"),icon:"i-lucide-wrap-text",show:!e(n).enableFeedback,onClick:(r,P)=>{const Q=r.metadata?.annotations?.annotationId;Q?Ke(Q,r.id):Ye(r,P)}}]},"spacing-offset":160},{content:p(({message:r,index:P})=>[r.content.length?(s(),$(y,{key:0,content:r.content.toString(),"show-run-button":!1},{before:p(()=>[r.status==="loading"?(s(),m("div",Ta,[u(d,{name:"i-lucide-loader-2",class:"animate-spin"}),a("span",null,k(e(C)("ai-chat.frontend.messages.thinking")),1)])):_("",!0)]),after:p(()=>[r.metadata?.references&&r.metadata.references.length>0&&r.role==="assistant"&&!e(pe)&&e(n).showReference?(s(),m(S,{key:0},[a("div",Sa,[a("span",za,k(e(C)("ai-agent.frontend.chat.reference")),1),r.metadata?.references&&r.metadata.references.length>0&&r.role==="assistant"?(s(),$(Ze,{key:0,size:"xs",type:"dashed"})):_("",!0)]),u(Je,{references:r.metadata.references},null,8,["references"])],64)):_("",!0)]),_:2},1032,["content"])):_("",!0),r.metadata?.suggestions&&e(i).length-1===P?(s(),m("div",Fa,[(s(!0),m(S,null,A(r.metadata.suggestions,Q=>(s(),m("div",{key:Q},[u(V,{label:Q,color:"primary",variant:"soft",onClick:Ra=>le(Q)},null,8,["label","onClick"])]))),128))])):_("",!0)]),_:1},8,["messages","scroll-area-height","error","assistant"])):_("",!0),e(n).formFields&&e(n).formFields.length>0?(s(),m("div",Ia,[a("div",Ma,[a("span",Va,[u(d,{name:"i-lucide-bot-message-square",class:"text-primary size-7"}),Re(" "+k(e(C)("ai-agent.frontend.chat.newConversationSettings")),1)]),e(i).length||!e(F)?(s(),$(V,{key:0,color:"primary",variant:"ghost",size:"sm",onClick:l[1]||(l[1]=r=>F.value=!e(F))},{default:p(()=>[a("span",null,k(e(F)?e(C)("console-common.close"):e(C)("console-common.edit")),1)]),_:1})):_("",!0)]),gt(a("div",null,[u(e(j),{inputs:e(n).formFieldsInputs,"onUpdate:inputs":l[2]||(l[2]=r=>e(n).formFieldsInputs=r),formFields:e(n).formFields,class:"w-full bg-transparent pt-0",formClass:"bg-muted hover:bg-muted"},null,8,["inputs","formFields"])],512),[[ht,e(F)]]),e(i).length===0&&e(F)?(s(),m("div",Aa,[u(V,{color:"primary",class:"w-full justify-center",onClick:Qe},{default:p(()=>[a("span",null,k(e(C)("ai-agent.frontend.chat.startConversation")),1)]),_:1})])):_("",!0)])):_("",!0)]),_:1},8,["has-more"])]),_:1},512),a("div",Ea,[e(n).quickCommands?.length?(s(),m("div",Ua,[a("div",Ba,[(s(!0),m(S,null,A(e(n).quickCommands,r=>(s(),$(V,{key:r.name,color:"neutral",variant:"soft",size:"sm",onClick:P=>le(r.content)},{default:p(()=>[r.avatar?(s(),$(et,{key:0,src:r.avatar,class:"h-4 w-4"},null,8,["src"])):_("",!0),a("span",null,k(r.name),1)]),_:2},1032,["onClick"]))),128))])])):_("",!0),u(tt,{modelValue:e(f),"onUpdate:modelValue":l[4]||(l[4]=r=>re(f)?f.value=r:null),"file-list":e(W),"onUpdate:fileList":l[5]||(l[5]=r=>re(W)?W.value=r:null),"is-loading":e(pe),placeholder:e(C)("ai-chat.frontend.and",{name:e(n).name}),attachmentSizeLimit:e(I)?.attachmentSizeLimit,class:"sticky bottom-0 z-10 [view-transition-name:chat-prompt]",rows:1,onStop:e(Pe),onSubmit:le},{"panel-right-item":p(()=>[(e(n).billingConfig?.price??0)>0?(s(),m("span",Da,k(e(C)("ai-chat.frontend.singleRunConsumption",{price:e(n).billingConfig?.price??0})),1)):_("",!0)]),_:1},8,["modelValue","file-list","is-loading","placeholder","attachmentSizeLimit","onStop"])])],64)):_("",!0)],2)],2)}}});export{ls as _};
