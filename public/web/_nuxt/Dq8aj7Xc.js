import N from"./--UdezPG.js";import{_ as H}from"./BYwSSEjb.js";import{d as P,b as j,au as z,s as g,aM as K,g as L,i as G,j as b,o as p,k as i,l as d,q as r,c as J,p as e,t as Q,_ as W,x as V,v as m,B as X,ay as Y,y as Z,F as ee}from"#entry";import{_ as te}from"./JOupiI7i.js";import{_ as ae}from"./BO1GPLSL.js";import se from"./CfxLE1oh.js";import{_ as le}from"./DNgvVYsj.js";import{_ as oe}from"./BYK_1AlN.js";import{g as re}from"./BK7wxorZ.js";import{g as ne,a as ie}from"./ahy3UiMC.js";import{a as k,c as de}from"./BUyfW8JT.js";import{u as me}from"./DqVgEjI6.js";import"./BgHJjJs-.js";import"./PB-3MFNY.js";import"./TH-3OOuG.js";import"./B22A-h4k.js";import"./b-_TUx9i.js";import"./Cv1u6XyE.js";import"./CKTa8Hyi.js";import"./8-c-A7PB.js";import"./DN9ov8OT.js";import"./kRIii9yh.js";import"./CKXZhss7.js";import"./pUN2d83w.js";import"./nBDBqKnC.js";import"./Cfcu-t3n.js";import"./CLTNKp0S.js";import"./C6Y-ieo6.js";import"./DaNf1Wdt.js";import"./Cpt2kRVT.js";import"./Bub1HYiY.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./CP4Zo7YT.js";import"./XpsTG8vq.js";import"./DaWZu8wl.js";const ce={class:"grid grid-cols-2 items-center gap-4"},pe={class:"text-muted-foreground inline-flex cursor-help items-center gap-1"},ue={class:"text-xs"},fe={class:"max-w-100 space-y-3 p-3"},_e={class:"space-y-2"},be={class:"text-sm font-semibold"},ve={class:"text-muted-foreground space-y-2 text-xs"},he={class:"space-y-1"},ke={class:"font-medium"},ye={class:"bg-muted rounded p-2 font-mono text-xs"},xe={class:"text-success"},ge={class:"bg-muted rounded p-2 font-mono text-xs"},Ve={class:"text-error"},Ue={class:"mt-3 rounded bg-blue-50 p-2"},Ie={class:"mb-1 text-xs font-medium text-blue-600"},we={class:"text-xs text-blue-600"},qe={class:"mt-6 flex justify-end gap-2"},pt=P({__name:"list-edit",props:{id:{}},emits:["close","submit"],setup(w,{emit:q}){const u=w,f=q,{t:o}=j(),$=z(),v=g([]),c=g([]),t=K({name:"",templateId:void 0,fieldValues:[],remark:"",status:1,sortOrder:0}),T=g(!1),F=L(()=>{const l={name:k().trim().required(o("ai-secret.backend.list.edit.keyTypeRequired")),templateId:k().trim().required(o("ai-secret.backend.list.edit.keyTypeRequired")),remark:k()};return c.value&&c.value.length>0&&c.value.forEach((a,n)=>{if(!a.required)return;const _=a.name||`customField_${n}`;l[_]=k().required(o("ai-secret.backend.list.edit.fieldRequired")+a.name)}),de(l)}),U=()=>{c.value&&c.value.length>0&&c.value.forEach(l=>{l.name&&(l.name in t||(t[l.name]=""))})},R=async()=>{try{const l=await re(u.id);t.name=l.name||"",t.remark=l.remark||"",t.status=l.status||1,t.sortOrder=l.sortOrder||0;const a=v.value.some(n=>n.value===l.templateId);T.value=a,a?t.templateId=l.templateId:t.templateId=void 0,l.fieldValues&&Array.isArray(l.fieldValues)&&l.fieldValues.forEach(n=>{n.name&&n.value!==void 0&&(t[n.name]=n.value)})}catch(l){console.error("获取API密钥详情失败:",l)}},S=async()=>{(await ne()).forEach(a=>{v.value.push({label:a.name,value:a.id||""})}),u.id?console.log(t.templateId):t.templateId=v.value[0]?.value,t.templateId&&y(t.templateId)},C=()=>{f("close"),$.push({path:me("secret-templates:list")})},y=async l=>{const a=await ie(l);c.value=a.fieldConfig,U()},D=()=>{const l=c.value.map(n=>({name:n.name||"",value:String(t[n.name||""]||"")})),a={name:t.name,templateId:t.templateId,remark:t.remark,status:t.status,sortOrder:t.sortOrder,fieldValues:l};u.id?f("submit",a,u.id):f("submit",a),f("close")};return G(async()=>{U(),await S(),u.id&&await R(),await y(t.templateId||"")}),(l,a)=>{const n=N,_=H,x=W,E=te,B=Z,O=ae,I=se,A=le,M=oe;return p(),b(M,{title:u.id?e(o)("ai-secret.backend.list.edit.title"):e(o)("ai-secret.backend.list.add"),ui:{content:"max-w-2xl overflow-y-auto h-fit"},onClose:a[5]||(a[5]=s=>f("close"))},{default:i(()=>[d(A,{state:e(t),schema:e(F),class:"space-y-4",onSubmit:D},{default:i(()=>[r("div",ce,[d(_,{label:e(o)("ai-secret.backend.list.edit.name"),name:"name",required:""},{default:i(()=>[d(n,{modelValue:e(t).name,"onUpdate:modelValue":a[0]||(a[0]=s=>e(t).name=s),placeholder:e(o)("ai-secret.backend.list.edit.nameRequired"),class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(_,{label:e(o)("ai-secret.backend.list.edit.keyType"),name:"templateId",required:""},{hint:i(()=>[d(x,{variant:"link",class:"cursor-pointer gap-0 p-0","trailing-icon":"i-lucide-arrow-right",ui:{trailingIcon:"size-4"},onClick:a[1]||(a[1]=s=>C())},{default:i(()=>[V(m(e(o)("ai-secret.backend.type.addType")),1)]),_:1})]),default:i(()=>[e(v).length>0?(p(),b(E,{key:0,modelValue:e(t).templateId,"onUpdate:modelValue":[a[2]||(a[2]=s=>e(t).templateId=s),y],items:e(v),"label-key":"label","value-key":"value",placeholder:e(o)("ai-secret.backend.list.edit.keyTypeRequired"),class:"w-full"},null,8,["modelValue","items","placeholder"])):Q("",!0)]),_:1},8,["label"])]),(p(!0),J(ee,null,X(e(c),s=>(p(),b(_,{key:s.name,label:s.name,name:s.name,required:s.required},Y({default:i(()=>[s.type==="number"?(p(),b(n,{key:0,modelValue:e(t)[s.name],"onUpdate:modelValue":h=>e(t)[s.name]=h,type:"number",placeholder:s.placeholder,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):s.type==="text"?(p(),b(n,{key:1,modelValue:e(t)[s.name],"onUpdate:modelValue":h=>e(t)[s.name]=h,placeholder:s.placeholder,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(p(),b(I,{key:2,modelValue:e(t)[s.name],"onUpdate:modelValue":h=>e(t)[s.name]=h,placeholder:s.placeholder,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]),_:2},[s.name==="baseUrl"?{name:"hint",fn:i(()=>[d(O,{mode:"hover","open-delay":0},{content:i(()=>[r("div",fe,[r("div",_e,[r("h4",be,m(e(o)("ai-secret.backend.list.edit.baseUrlHelpTitle")),1),r("div",ve,[r("p",null,m(e(o)("ai-secret.backend.list.edit.baseUrlHelpDesc")),1),r("div",he,[r("div",ke,m(e(o)("ai-secret.backend.list.edit.baseUrlExample"))+": ",1),r("div",ye,[r("div",xe," ✓ "+m(e(o)("ai-secret.backend.list.edit.baseUrlCorrect")),1),a[6]||(a[6]=r("div",{class:"text-muted-foreground text-xs"}," https://api.openai.com/v1 ",-1))]),r("div",ge,[r("div",Ve," ✗ "+m(e(o)("ai-secret.backend.list.edit.baseUrlIncorrect")),1),a[7]||(a[7]=r("div",{class:"text-muted-foreground text-xs"}," https://api.openai.com/v1/chat/completions ",-1))])]),r("div",Ue,[r("div",Ie,m(e(o)("ai-secret.backend.list.edit.openaiFormatNote")),1),r("div",we,m(e(o)("ai-secret.backend.list.edit.openaiFormatDesc")),1)])])])])]),default:i(()=>[r("span",pe,[d(B,{name:"i-lucide-help-circle",class:"size-3.5"}),r("span",ue,m(e(o)("ai-secret.backend.list.edit.baseUrlHelp")),1)])]),_:1})]),key:"0"}:void 0]),1032,["label","name","required"]))),128)),d(_,{label:e(o)("ai-secret.backend.list.edit.remark"),name:"remark"},{default:i(()=>[d(I,{modelValue:e(t).remark,"onUpdate:modelValue":a[3]||(a[3]=s=>e(t).remark=s),placeholder:e(o)("ai-secret.backend.list.edit.remarkRequired"),class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r("div",qe,[d(x,{color:"neutral",variant:"soft",onClick:a[4]||(a[4]=s=>f("close"))},{default:i(()=>[V(m(e(o)("console-common.cancel")),1)]),_:1}),d(x,{color:"primary",type:"submit"},{default:i(()=>[V(m(e(o)("console-common.save")),1)]),_:1})])]),_:1},8,["state","schema"])]),_:1},8,["title"])}}});export{pt as default};
