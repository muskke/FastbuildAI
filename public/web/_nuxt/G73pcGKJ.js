const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CWAAXUde.js","./CDmbk8fH.js","./--UdezPG.js","./BYwSSEjb.js","./BgHJjJs-.js","./CbuHra-u.js","./8-c-A7PB.js","./B22A-h4k.js","./Cpt2kRVT.js","./pUN2d83w.js","./9bDOsXij.js","./CBooyAK7.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./b-_TUx9i.js","./Cfcu-t3n.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./XpsTG8vq.js","./BfeZ9Wne.js","./CyGK14vg.js","./DN9ov8OT.js","./nBDBqKnC.js","./DNgvVYsj.js","./BUyfW8JT.js","./DaWZu8wl.js"])))=>i.map(i=>d[i]);
import{d as W,b as X,aq as Y,Q as ee,aM as oe,s as ae,g as V,aK as se,i as le,c as C,o as k,l as t,k as n,q as d,t as E,p as e,v as m,_ as te,ay as re,n as ne,x as p,j as v,bM as de,R as U,U as I}from"#entry";import{_ as ie}from"./CqN3ElKI.js";import{_ as me}from"./ZZC6mEJB.js";import ue from"./--UdezPG.js";import{_ as ce}from"./BYwSSEjb.js";import{_ as pe}from"./JOupiI7i.js";import{_ as fe}from"./Bu7cOM_l.js";import{_ as _e}from"./DAQypLay.js";import{_ as be}from"./EHoVw6ZP.js";import{_ as ke}from"./DNgvVYsj.js";import{g as he,P as R,v as ge}from"./C_EXknkZ.js";import{e as $,a as f,c as z}from"./BUyfW8JT.js";import"./BaNg8fjw.js";import"./DlAUqK2U.js";import"./BgHJjJs-.js";import"./DN9ov8OT.js";import"./nBDBqKnC.js";import"./PB-3MFNY.js";import"./TH-3OOuG.js";import"./B22A-h4k.js";import"./b-_TUx9i.js";import"./Cv1u6XyE.js";import"./CKTa8Hyi.js";import"./8-c-A7PB.js";import"./kRIii9yh.js";import"./CKXZhss7.js";import"./pUN2d83w.js";import"./Cfcu-t3n.js";import"./DaNf1Wdt.js";import"./BstbYvQo.js";import"./DaWZu8wl.js";const ve={class:"grid grid-cols-1 gap-8 p-1 lg:grid-cols-3"},we={class:"shadow-default h-fit rounded-lg lg:col-span-1"},xe={class:"flex flex-col items-center space-y-4",style:{padding:"80px 24px 40px"}},ye={class:"border-default relative rounded-full border border-dashed p-2"},Ve={class:"mt-6 px-12 text-center text-xs"},Ce={class:"text-muted-foreground"},Ee={class:"mt-6 flex w-full items-center justify-between"},Ue={class:"text-secondary-foreground text-sm font-medium"},Ie={class:"text-muted-foreground mt-2 text-xs"},Re={key:0,class:"mt-4 w-full"},$e={class:"shadow-default space-y-6 rounded-lg p-6 lg:col-span-2"},ze={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},qe={class:"text-muted-foreground text-xs"},Ae={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Fe={class:"grid grid-cols-2 gap-6"},Ne={class:"text-muted-foreground text-xs"},Pe={class:"flex justify-end gap-4"},bo=W({__name:"user-form",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["submit-success","cancel","refresh"],setup(q,{emit:A}){const F=U(()=>I(()=>import("./CWAAXUde.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url)),N=U(()=>I(()=>import("./BfeZ9Wne.js"),__vite__mapDeps([21,2,1,3,4,22,6,23,8,9,24,10,7,25,12,13,14,15,16,17,18,19,20,26,27]),import.meta.url)),i=q,h=A,{t:o}=X(),w=Y(),x=ee(),{userNo:Se,...P}=i.initialData||{},s=oe({username:"",nickname:"",email:"",phone:"",phoneAreaCode:he(),avatar:"",password:"",roleId:void 0,status:1,source:0,...P}),y=ae([]),S=V(()=>R.map(r=>({label:`${r.flag} ${o(r.i18nKey)} +${r.areaCode}`,value:r.areaCode}))),D=V(()=>{const r={username:f().required(o("user.backend.form.usernameRequired")).matches(/^[a-zA-Z0-9_]*$/,o("user.backend.form.usernameFormat")),nickname:f().required(o("user.backend.form.nicknameRequired")),email:f().email(o("user.backend.form.emailFormat")).nullable(),phone:f().test("phone-format",o("user.backend.form.phoneFormat"),function(a){if(!a)return!0;const _=R.find(g=>g.areaCode===s.phoneAreaCode);return _?ge(a,_.code):!1}).nullable(),phoneAreaCode:f().matches(/^\d{1,4}$/,o("user.backend.form.areaCodeFormat")).nullable(),status:$().required(o("user.backend.form.statusRequired")),source:$().required(o("user.backend.form.sourceRequired"))};return i.isEdit?z(r):z({...r,password:f().required(o("user.backend.form.passwordRequired")).min(6,o("user.backend.form.passwordMinLength"))})}),L=async()=>{try{const r=await de();y.value=[{label:o("user.backend.form.noRole"),value:"null"},...r.map(a=>({label:a.name,value:a.id}))]}catch(r){console.error("Get role list failed:",r),w.error(o("user.backend.form.getRoleListFailed"))}},M=()=>{Object.keys(s).forEach(r=>{const a=r;typeof s[a]=="string"?s[a]="":typeof s[a]=="number"&&(s[a]=r==="status"?1:0)}),w.info(o("user.backend.form.formReset"))},B=async()=>{if(!i.id)return;await x.create(N).open({user:{id:i.id,power:s.power}}).result&&h("refresh")},O=async()=>{if(!i.id)return;await x.create(F).open({userid:i.id}).result},j=()=>{O()},{isLock:H,lockFn:T}=se(async()=>{try{s.roleId==="null"&&(s.roleId=void 0),h("submit-success",{...s})}catch(r){return console.error(o("user.backend.form.formValidationFailed")+":",r),!1}});return le(()=>L()),(r,a)=>{const _=ie,g=me,b=te,c=ue,u=ce,K=pe,G=fe,Q=_e,Z=be,J=ke;return k(),C("div",null,[t(J,{state:e(s),schema:e(D),class:"space-y-8",onSubmit:e(T)},{default:n(()=>[d("div",ve,[d("div",we,[d("div",xe,[d("div",ye,[t(_,{modelValue:e(s).avatar,"onUpdate:modelValue":a[0]||(a[0]=l=>e(s).avatar=l),class:"bg-muted h-32 w-32 overflow-hidden rounded-full! border-none!",text:e(o)("user.backend.form.addAvatar"),icon:"i-lucide-camera",accept:".jpg,.png,.jpeg",maxCount:1,single:!0},null,8,["modelValue","text"])]),d("div",Ve,[d("p",Ce,m(e(o)("user.backend.form.avatarFormats")),1)]),d("div",Ee,[d("div",null,[d("h4",Ue,m(e(o)("user.backend.form.statusLabel")),1),d("p",Ie,m(e(o)("user.backend.form.statusHelp")),1)]),t(g,{"model-value":!!e(s).status,"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"xl",onChange:a[1]||(a[1]=l=>e(s).status=e(s).status?0:1)},null,8,["model-value"])]),i.isEdit?(k(),C("div",Re,[t(u,{label:e(o)("user.backend.form.power"),name:"power"},{default:n(()=>[t(c,{modelValue:e(s).power,"onUpdate:modelValue":a[2]||(a[2]=l=>e(s).power=l),disabled:!0,variant:"subtle",size:"xl",class:"w-full",type:"number"},{trailing:n(()=>[t(b,{class:"cursor-pointer",color:"primary",variant:"link",size:"sm",icon:"i-lucide-edit","aria-label":"Clear input",onClick:B})]),_:1},8,["modelValue"])]),_:1},8,["label"])])):E("",!0)])]),d("div",$e,[d("div",ze,[t(u,{label:e(o)("user.backend.form.username"),name:"username",required:""},re({default:n(()=>[t(c,{modelValue:e(s).username,"onUpdate:modelValue":a[3]||(a[3]=l=>e(s).username=l),placeholder:e(o)("user.backend.form.usernameInput"),size:"xl",disabled:i.isEdit,class:"w-full"},null,8,["modelValue","placeholder","disabled"])]),_:2},[i.isEdit?void 0:{name:"hint",fn:n(()=>[d("span",qe,m(e(o)("user.backend.form.usernameHelp")),1)]),key:"0"}]),1032,["label"]),t(u,{label:e(o)("user.backend.form.nickname"),name:"nickname",required:""},{default:n(()=>[t(c,{modelValue:e(s).nickname,"onUpdate:modelValue":a[4]||(a[4]=l=>e(s).nickname=l),placeholder:e(o)("user.backend.form.nicknameInput"),size:"xl",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),d("div",Ae,[t(u,{label:e(o)("user.backend.form.phone"),name:"phone"},{default:n(()=>[t(c,{modelValue:e(s).phone,"onUpdate:modelValue":a[7]||(a[7]=l=>e(s).phone=l),placeholder:e(o)("user.backend.form.phoneInput"),size:"xl",autocomplete:"off",ui:{root:"w-full",base:"!pl-28"}},{leading:n(()=>[d("div",{class:"flex items-center text-sm",onClick:a[6]||(a[6]=ne(()=>{},["stop","prevent"]))},[t(K,{modelValue:e(s).phoneAreaCode,"onUpdate:modelValue":a[5]||(a[5]=l=>e(s).phoneAreaCode=l),items:e(S),"trailing-icon":"heroicons:chevron-up-down-20-solid",class:"w-fit",size:"lg",ui:{base:"!ring-0",content:"z-999 w-64"},"value-key":"value"},{default:n(()=>[p(" + "+m(e(s).phoneAreaCode),1)]),item:n(({item:l})=>[p(m(l.label),1)]),_:1},8,["modelValue","items"])]),t(G,{class:"h-1/2",orientation:"vertical"})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(u,{label:e(o)("user.backend.form.email"),name:"email"},{default:n(()=>[t(c,{modelValue:e(s).email,"onUpdate:modelValue":a[8]||(a[8]=l=>e(s).email=l),placeholder:e(o)("user.backend.form.emailInput"),size:"xl",type:"email",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),d("div",Fe,[i.isEdit?E("",!0):(k(),v(u,{key:0,label:e(o)("user.backend.form.password"),name:"password",required:""},{hint:n(()=>[d("span",Ne,m(e(o)("user.backend.form.passwordHelp")),1)]),default:n(()=>[t(Q,{modelValue:e(s).password,"onUpdate:modelValue":a[9]||(a[9]=l=>e(s).password=l),placeholder:e(o)("user.backend.form.passwordInput"),size:"xl",type:"password",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),t(u,{label:e(o)("user.backend.form.role"),name:"roleId"},{default:n(()=>[t(Z,{modelValue:e(s).roleId,"onUpdate:modelValue":a[10]||(a[10]=l=>e(s).roleId=l),"label-key":"label","value-key":"value",items:e(y),placeholder:e(o)("user.backend.form.roleSelect"),size:"xl",class:"w-full"},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),t(u,{label:e(o)("user.backend.form.realName"),name:"realName"},{default:n(()=>[t(c,{modelValue:e(s).realName,"onUpdate:modelValue":a[11]||(a[11]=l=>e(s).realName=l),placeholder:e(o)("user.backend.form.realNameInput"),size:"xl",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),d("div",Pe,[t(b,{color:"neutral",variant:"outline",size:"lg",onClick:a[12]||(a[12]=l=>h("cancel")),class:"px-8"},{default:n(()=>[p(m(e(o)("console-common.cancel")),1)]),_:1}),i.id?(k(),v(b,{key:0,color:"neutral",size:"lg",onClick:j,class:"px-8"},{default:n(()=>[p(m(e(o)("user.backend.password.resetTab")),1)]),_:1})):(k(),v(b,{key:1,color:"neutral",size:"lg",onClick:M,class:"px-8"},{default:n(()=>[p(m(e(o)("console-common.reset")),1)]),_:1})),t(b,{color:"primary",size:"lg",loading:e(H),type:"submit",class:"px-8"},{default:n(()=>[p(m(i.isEdit?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])])])]),_:1},8,["state","schema","onSubmit"])])}}});export{bo as default};
