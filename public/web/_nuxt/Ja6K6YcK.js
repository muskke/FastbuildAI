const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Do-VSyvA.js","./CpacWlXu.js","./CfxLE1oh.js","./BYwSSEjb.js","./BgHJjJs-.js","./iqoKNu2e.js","./B1Lg5z9T.js","./CLTNKp0S.js","./8-c-A7PB.js","./kRIii9yh.js","./TH-3OOuG.js","./Cfcu-t3n.js","./C6Y-ieo6.js","./b-_TUx9i.js","./DaNf1Wdt.js","./CKXZhss7.js","./Cpt2kRVT.js","./pUN2d83w.js","./B22A-h4k.js","./Bub1HYiY.js","./lw_U4-W2.js","./XpsTG8vq.js","./DyWX1Ime.js","./BMSQkwth.js","./DaWZu8wl.js","./B_gLqRAo.js","./ZZC6mEJB.js","./DN9ov8OT.js","./nBDBqKnC.js","./DNgvVYsj.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./BDS0FVMi.js","./DTJhkpWV.js","./BUyfW8JT.js","./BpWKzIts.js","./D-yR6Fj9.js","./Dn8X9Gvz.js","./DlAUqK2U.js","./BhaAGfJt.js","./--UdezPG.js","./EHoVw6ZP.js","./BstbYvQo.js"])))=>i.map(i=>d[i]);
import{d as Ie,b as Me,aq as Ae,b9 as Ee,s as L,i as Ue,G as ie,w as te,aZ as X,a_ as ee,g as R,aS as at,j as $,o as s,b7 as st,k as p,q as a,l as u,c as m,t as _,T as nt,p as e,C as lt,v as k,_ as Be,y as De,x as Le,F as S,B as A,n as Ce,z as ae,A as re,f as ot,aT as it,h as he,aL as ye,aJ as rt,Q as ct,e as ut,aN as dt,O as $e,a1 as mt,ap as ft,bF as Te,ah as pt,aV as vt,D as gt,R as _e,E as ht,bs as _t,U as xe}from"#entry";import{_ as xt}from"./Bfc6LCc8.js";import{_ as yt,a as kt}from"./l1H0tvBk.js";import{_ as bt}from"./Bu7cOM_l.js";import{_ as wt}from"./BvA0VnH0.js";import{_ as Re}from"./D-yR6Fj9.js";import{_ as Ct}from"./CdEI2ZYD.js";import{g as $t,h as Tt,i as St,j as Ft,k as Se,l as zt,m as Vt}from"./DTJhkpWV.js";import{e as It}from"./B1XcE43x.js";import{e as Fe}from"./Bni8bPEl.js";import Mt from"./--UdezPG.js";import{_ as At}from"./BYwSSEjb.js";import{_ as Et}from"./B1Lg5z9T.js";import{_ as Ut}from"./BsoAYZfI.js";import{_ as Bt}from"./D_xVtNgx.js";import{g as Dt}from"./eeyg4-1U.js";import{u as ze}from"./B93AZ-4h.js";import{d as Lt}from"./CP4Zo7YT.js";import{_ as Rt}from"./DlAUqK2U.js";import{u as Ve}from"./BI1JbAYD.js";import{u as jt}from"./DqNHTeRY.js";const Nt={class:"relative h-full flex-1"},qt={key:0,class:"flex h-full min-h-0 w-[240px] flex-col"},Pt={class:"border-border/50 border-b p-4"},Ot={class:"flex items-center gap-3"},Gt={class:"min-w-0 flex-1"},Qt={class:"truncate font-medium"},Ht={class:"h-full flex-1 overflow-hidden"},Kt={key:0,class:"text-muted-foreground flex h-full flex-col items-center justify-center text-center text-sm"},Jt={class:"mb-2"},Yt={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},Zt={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},Wt={class:"flex flex-col gap-1"},Xt={class:"block flex-1 truncate text-left"},ea={key:0,class:"flex flex-col gap-4 py-4"},ta={class:"px-2 py-1"},aa={class:"flex flex-col gap-1"},sa={key:0,class:"absolute top-4 left-4 z-50 flex items-center gap-2"},na={class:"group relative"},la={class:"block flex-1 truncate text-left text-sm"},oa={key:0,class:"text-muted-foreground flex h-full w-50 flex-col items-center justify-center text-center text-sm"},ia={class:"mb-2"},ra={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},ca={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},ua={class:"flex flex-col gap-1"},da={class:"block flex-1 truncate text-left"},ma={key:0,class:"flex flex-col gap-4 py-4"},fa={class:"px-2 py-1"},pa={class:"flex flex-col gap-1"},va=Ie({inheritAttrs:!1,__name:"chats-list",props:{agent:{},publishToken:{},accessToken:{},modelValue:{}},emits:["update:modelValue","new-conversation","switch-conversation"],async setup(b,{emit:h}){let T,J;const v=b,j=h,ce=Mt,C=At,{t:Y}=Me(),se=Ae(),x=at(v,"modelValue",j),E=Ee("(max-width: 768px)"),F=L(!1),w=L(!1);Ue(()=>{ie(()=>{E.value||(F.value=!0)})}),te(E,c=>{c?F.value=!1:(w.value=!1,F.value=!0)},{immediate:!1});const{data:ue,pending:P}=([T,J]=X(()=>ee(()=>`public-agent-conversations-${v.publishToken}-${v.accessToken}`,()=>v.accessToken?$t(v.publishToken,v.accessToken,{page:1,pageSize:50}):{items:[]},{watch:[()=>v.accessToken]})),T=await T,J(),T),g=R(()=>ue.value?.items||[]),U=R(()=>g.value?.length?Dt(g.value,"updatedAt",Y):[]);te(g,c=>{c?.length>0&&((v.modelValue?c.some(I=>I.id===v.modelValue):!1)?v.modelValue||j("switch-conversation",c[0]):(x.value=null,j("switch-conversation",c[0])))},{immediate:!0});const H=c=>{w.value=!1,j("switch-conversation",c)},N=()=>{j("new-conversation")},Z=()=>{E.value?(w.value=!0,F.value=!1):(w.value=!1,F.value=!0)},z=async c=>{const l=ot(c.title);try{const I=it({setup(){return()=>he("div",{class:"py-2"},[he(C,{label:"对话标题",size:"lg",required:!0,error:l.value.trim()?"":"对话标题不能为空"},{default:()=>he(ce,{modelValue:l.value,"onUpdate:modelValue":V=>{l.value=V},placeholder:"请输入对话标题",maxlength:50,class:"w-full"})})])}});await ze({title:"编辑对话标题",content:I,confirmText:"保存",cancelText:"取消",color:"primary",ui:{content:"!w-sm"}}),l.value.trim()&&l.value!==c.title&&await B(c.id,l.value)}catch(I){console.log("用户取消编辑操作:",I)}},B=async(c,l)=>{try{await Tt(v.publishToken,v.accessToken,c,{title:l}),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),se.success("对话标题更新成功")}catch(I){console.error("更新对话标题失败:",I)}},O=async c=>{if(v.accessToken)try{await St(v.publishToken,v.accessToken,c.id),await ye(`public-agent-conversations-${v.publishToken}-${v.accessToken}`),v.modelValue===c.id&&(x.value=null,j("new-conversation")),se.success(Y("common.message.deleteSuccess"))}catch(l){console.error("删除对话失败:",l)}},ne=async c=>{try{await ze({color:"error",title:"确认删除",content:"确定要删除这个会话吗？删除后无法恢复。",confirmText:"删除",cancelText:"取消",ui:{content:"!w-sm"}})&&await O(c)}catch(l){console.log("用户取消删除操作:",l)}},de=c=>[{label:"编辑",color:"primary",icon:"i-lucide-pencil",onSelect:()=>z(c)},{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ne(c)}];return Lt({o:()=>w.value=!w.value}),(c,l)=>{const I=lt,V=De,D=Be,n=Et,K=Ut,le=Re,me=Bt,fe=st;return s(),$(fe,null,{default:p(()=>[a("div",Nt,[u(nt,{name:"sidebar"},{default:p(()=>[e(F)?(s(),m("div",qt,[a("div",Pt,[a("div",Ot,[u(I,{src:b.agent?.avatar,alt:b.agent?.name,size:"sm"},null,8,["src","alt"]),a("div",Gt,[a("h2",Qt,k(b.agent?.name),1)]),u(D,{color:"neutral",variant:"ghost",size:"sm",class:"p-2",onClick:l[0]||(l[0]=i=>F.value=!1)},{default:p(()=>[u(V,{name:"i-lucide-panel-left",class:"size-5"})]),_:1})]),u(D,{class:"mt-3 w-full",color:"primary",variant:"soft",onClick:N},{default:p(()=>[u(V,{name:"i-lucide-plus",class:"mr-2 size-4"}),l[4]||(l[4]=Le(" 新建会话 ",-1))]),_:1})]),a("div",Ht,[!e(U).length&&!e(P)?(s(),m("div",Kt,[a("div",Jt,[u(V,{name:"i-lucide-message-circle",size:"lg",class:"text-muted-foreground"})]),l[5]||(l[5]=a("p",null,"暂无会话记录",-1)),l[6]||(l[6]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(s(),$(le,{key:1,class:"grid h-full"},{default:p(()=>[a("div",Yt,[(s(!0),m(S,null,A(e(U),i=>(s(),m("div",{key:i.key,class:"flex flex-col gap-2"},[a("div",Zt,k(i.label),1),a("div",Wt,[(s(!0),m(S,null,A(i.items,f=>(s(),m("div",{key:f.id,class:"group relative"},[u(D,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===b.modelValue?"soft":"ghost",color:f.id===b.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",Xt,k(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),u(n,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[u(V,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===b.modelValue}]),onClick:l[1]||(l[1]=Ce(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(P)?(s(),m("div",ea,[(s(),m(S,null,A(3,i=>a("div",{key:`group-${i}`,class:"flex flex-col gap-2"},[a("div",ta,[u(K,{class:"h-4 w-16"})]),a("div",aa,[(s(!0),m(S,null,A(i===1?3:i===2?2:1,f=>(s(),$(K,{key:`item-${i}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))]),l[7]||(l[7]=a("div",{class:"border-border/50 border-t pt-2"},[a("div",{class:"text-muted-foreground flex items-center justify-center gap-1 text-xs"},[a("span",null,"Powered by"),a("a",{href:"https://buildingai.cc",target:"_blank",class:"text-primary font-medium hover:underline"}," BuildingAI ")])],-1))])):_("",!0)]),_:1}),e(F)?_("",!0):(s(),m("div",sa,[u(D,{color:"neutral",variant:"soft",size:"lg",class:"p-2",onClick:Z},{default:p(()=>[u(V,{name:"i-lucide-panel-right",class:"size-5"})]),_:1}),l[9]||(l[9]=a("div",{class:"text-muted-foreground mx-1"},"/",-1)),a("div",na,[b.modelValue?(s(),$(n,{key:1,items:[{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>ne(e(g).find(i=>i.id===b.modelValue))},{label:"新建对话",color:"primary",icon:"i-lucide-plus",onSelect:()=>N()}],ui:{content:"w-32",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"bottom",align:"center"}},{default:p(()=>[u(D,{label:e(g).find(i=>i.id===b.modelValue)?.title||"当前对话",variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:p(()=>[a("span",la,k(e(g).find(i=>i.id===b.modelValue)?.title||"当前对话"),1),u(V,{name:"i-lucide-chevron-down",class:"size-5"})]),_:1},8,["label"])]),_:1},8,["items"])):(s(),$(D,{key:0,variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:p(()=>[...l[8]||(l[8]=[a("span",{class:"block flex-1 truncate text-left text-sm"},"New Chat",-1)])]),_:1}))])])),u(me,{open:e(w),"onUpdate:open":l[3]||(l[3]=i=>re(w)?w.value=i:null),side:"left",ui:{content:"!w-fit flex-0 max-w-fit"}},{content:p(()=>[!e(U).length&&!e(P)?(s(),m("div",oa,[a("div",ia,[u(V,{name:"i-lucide-message-circle",size:"lg",class:"text-gray-400"})]),l[10]||(l[10]=a("p",null,"暂无会话记录",-1)),l[11]||(l[11]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(s(),$(le,{key:1,class:"h-full"},{default:p(()=>[a("div",ra,[(s(!0),m(S,null,A(e(U),i=>(s(),m("div",{key:i.key,class:"flex flex-col gap-2"},[a("div",ca,k(i.label),1),a("div",ua,[(s(!0),m(S,null,A(i.items,f=>(s(),m("div",{key:f.id,class:"group relative"},[u(D,{label:f.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:f.id===b.modelValue?"soft":"ghost",color:f.id===b.modelValue?"primary":"neutral",onClick:W=>H(f)},{default:p(()=>[a("span",da,k(f.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),u(n,{items:[de(f)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:p(()=>[u(V,{name:"i-lucide-ellipsis",size:14,class:ae(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":f.id===b.modelValue}]),onClick:l[2]||(l[2]=Ce(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(U).length&&e(P)?(s(),m("div",ma,[(s(),m(S,null,A(3,i=>a("div",{key:`group-${i}`,class:"flex flex-col gap-2"},[a("div",fa,[u(K,{class:"h-4 w-16"})]),a("div",pa,[(s(!0),m(S,null,A(i===1?3:i===2?2:1,f=>(s(),$(K,{key:`item-${i}-${f}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):_("",!0)])]),_:1}))]),_:1},8,["open"])])]),_:1})}}}),ga=Rt(va,[["__scopeId","data-v-e3d15c41"]]),ha={class:"bg-secondary h-full flex-none"},_a={key:0,class:"flex h-full w-full items-center justify-center"},xa={class:"flex items-center gap-3"},ya={class:"text-lg"},ka={key:1,class:"flex h-full w-full items-center justify-center"},ba={class:"text-center"},wa={class:"mb-2 text-xl font-semibold"},Ca={class:"text-muted-foreground"},$a={class:"text-muted-foreground text-sm"},Ta={key:0,class:"flex items-center gap-2"},Sa={class:"my-2 flex items-center gap-1"},Fa={class:"text-muted-foreground flex-none text-xs"},za={key:1,class:"mb-2 space-y-2"},Va={key:2,class:"bg-background shadow-default my-6 w-full rounded-2xl"},Ia={class:"text-foreground border-muted/10 text-md flex items-center justify-between border-b p-4 font-medium"},Ma={class:"flex items-center gap-2"},Aa={key:0,class:"mt-2 p-4"},Ea={class:"w-full max-w-[800px] p-4 lg:py-2"},Ua={key:0,class:"mb-3"},Ba={class:"flex flex-wrap gap-2"},Da={key:0,class:"text-muted-foreground text-xs"},os=Ie({__name:"chat",props:{billingMode:{}},async setup(b){let h,T;const J=_e(()=>xe(()=>import("./Do-VSyvA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url)),v=_e(()=>xe(()=>import("./BpWKzIts.js"),__vite__mapDeps([39,40,1,41,42,30,31,32,13,18,11,33,34,35,21]),import.meta.url)),j=_e(()=>xe(()=>import("./BhaAGfJt.js"),__vite__mapDeps([43,44,1,3,4,2,45,8,27,10,13,14,15,11,46,18,29,38,24]),import.meta.url)),ce=b,{t:C}=Me(),Y=Ee("(max-width: 768px)"),{params:se}=rt(),x=R(()=>se.id||""),E=Ae(),F=ct(),w=ut("scrollAreaRef"),{height:ue}=dt(w),P=$e(`public_agent_conversation_${x.value}`),g=L(P.value||null),U=L(!0),H=L(""),N=L(null),Z=L({question:"",answer:"",enabled:!0}),z=L(!1);te(g,t=>{P.value=t});const B=mt({page:1,pageSize:15}),O=L(!1),{data:ne,refresh:de}=([h,T]=X(async()=>ee(`access-token-${x.value}`,async()=>{const t=`public_agent_token_${x.value}`,o=$e(t);if(o.value)return{accessToken:o.value,fromCache:!0};try{const d=await Ft(x.value);return o.value=d.accessToken,{...d,fromCache:!1}}catch(d){throw console.error("生成访问令牌失败:",d),d}})),h=await h,T(),h),c=R(()=>ne.value?.accessToken||""),{data:l,refresh:I}=([h,T]=X(()=>ee(()=>!g.value||!c.value?(console.log("conversationId.value",g.value),{items:[],total:0,page:B.page,pageSize:B.pageSize}):Se(x.value,c.value,g.value,B),{transform:t=>t},"$zgx5FY2pBK")),h=await h,T(),h),{data:V}=([h,T]=X(()=>ee("chat-config",()=>It())),h=await h,T(),h);l.value||(H.value="智能体不存在或未发布"),l.value?.items?.length||(g.value=null),O.value=l.value?.total>(l.value?.items?.length||0);const D=R(()=>l.value?.items?l.value.items.map(t=>({...t,id:t.id||Ve(),avatar:n.value?.chatAvatar||n.value?.avatar,status:"completed"})):[]),{data:n,pending:K}=([h,T]=X(()=>ee(`public-agent-${x.value}`,()=>zt(x.value,c.value))),h=await h,T(),h),le=()=>{g.value=null,B.page=1,i.value=[],z.value=!0,n.value&&(n.value.formFieldsInputs={})},me=async t=>{t.id!==g.value&&(g.value=t.id,B.page=1,I(),G())},fe=t=>{if(!n.value)return;const o=t.slice().reverse().find(d=>d?.role==="user"&&d.formFieldsInputs);console.log("lastUserMessage",o),n.value.formFieldsInputs=o?.formFieldsInputs||{}},{messages:i,input:f,files:W,handleSubmit:je,reload:Ne,stop:qe,status:Pe,error:Oe}=jt({api:Vt,initialMessages:[],chatConfig:{get avatar(){return n.value?.chatAvatar||n.value?.avatar}},body:{publishToken:x.value,accessToken:c.value,saveConversation:!0,get conversationId(){return g.value},get billingMode(){return ce.billingMode},get formFields(){return n.value?.formFields||[]},get formFieldsInputs(){return n.value?.formFieldsInputs||{}}},onToolCall(){},onResponse(t){t.status===401&&ft().logout(!0)},onUpdate(t){t.type==="conversation_id"&&(g.value=t.data,ye(`public-agent-conversations-${x.value}-${c.value}`))},onError(t){console.error("聊天错误:",t?.message||"发送失败")},onFinish(t){console.log("聊天完成:",t)}}),pe=R(()=>Pe.value==="loading"),Ge=async()=>{if(!(!O.value||!g.value||!x.value||!c.value)){B.page++;try{const t=await Se(x.value,c.value,g.value,B),o=t.items?.reverse().map(d=>({id:d.id||Ve(),role:d.role,content:d.content,status:"completed",mcpToolCalls:d.mcpToolCalls}))||[];i.value.unshift(...o),O.value=t.total>i.value.length}catch(t){B.page--,console.error("加载更多消息失败:",t),O.value=!0}}},ve=Te(t=>{const o=t.target,d=40;U.value=o.scrollHeight-(o.scrollTop+o.clientHeight)<=d},100),G=async(t=!0)=>{await ie(),w.value?.scrollToBottom(t)},ke=()=>{if(!n.value)return E.error("智能体信息未加载"),!1;const t=n.value.formFields||[],o=n.value.formFieldsInputs||{};if(t.length===0)return!0;const d=[];return t.forEach(y=>{if(y.required){const M=o[y.name];(!M||typeof M=="string"&&M.trim()==="")&&d.push(`${y.label}是必填字段`)}}),d.length>0?(E.error(`表单验证失败: ${d.join(", ")}`),!1):!0},Qe=()=>{ke()&&(z.value=!1)},oe=async t=>{if(!(!t.trim()||pe.value)){if(!n.value)return E.error("智能体信息未加载");if(!c.value)return E.error("请先生成访问令牌");ke()&&(await je(t),G())}};te(D,t=>{t&&(i.value=[...t],fe(t),ie(()=>{t.length>0?G(!1):z.value=!0}))},{immediate:!0}),te(()=>i.value.at(-1)?.content,()=>{ie(()=>{U.value&&G(!1)})},{flush:"post"});const He=t=>{F.create(v).open({context:t})},Ke=(t,o=null)=>{N.value=o,F.create(J).open({agentId:n.value?.id,annotationId:t,messageId:o,isPublic:!0,publishToken:x.value,accessToken:c.value,initialData:void 0,onResult:y=>{be(!0,y)}})},Je=(t,o)=>{const d=i.value[o-1];if(!d||d.role!=="user"){E.error("找不到对应的用户问题");return}Z.value={question:Fe(d.content),answer:Fe(t.content),enabled:!0},N.value=t.id||null,F.create(J).open({agentId:n.value?.id,annotationId:null,messageId:t.id||null,isPublic:!0,publishToken:x.value,accessToken:c.value,initialData:Z.value,onResult:M=>{be(!0,M)}})};function be(t,o){if(o?.id&&N.value){const d=i.value.findIndex(y=>y.id===N.value);if(d>=0){const y=i.value[d];y&&!y.metadata&&(y.metadata={}),y?.metadata&&(y.metadata.annotations={annotationId:o.id,createdBy:"",question:"",similarity:1})}}N.value=null,Z.value={question:"",answer:"",enabled:!0}}let ge=null;return Ue(async()=>{G(!1);const t=w.value?.getViewportElement(),o=t&&t.viewportElement;if(o){o.addEventListener("scroll",ve,{passive:!0}),ve({target:o});const d=Te(()=>{U.value&&G(!1)},50);ge=new MutationObserver(()=>{d()}),ge.observe(o,{childList:!0,subtree:!1,characterData:!1})}}),pt(()=>{const t=w.value?.getViewportElement();(t&&t.viewportElement)?.removeEventListener("scroll",ve),ge?.disconnect()}),vt({title:R(()=>n.value?`${n.value.name} - BuildingAI`:"BuildingAI"),link:[{rel:"icon",href:R(()=>n.value?.avatar||"/favicon.ico")},{rel:"apple-touch-icon",href:R(()=>n.value?.avatar||"/favicon.ico")}]}),(t,o)=>{const d=De,y=xt,M=Be,we=kt,Ye=bt,Ze=wt,We=yt,Xe=Re,et=_t,tt=Ct;return s(),m("div",{class:ae(["ai-chat bg-secondary flex h-full min-h-0 items-center justify-center rounded-l-xl p-2",{"p-0!":e(Y)}])},[a("div",ha,[u(ga,{agent:e(n),"publish-token":e(x),"access-token":e(c),modelValue:e(g),"onUpdate:modelValue":o[0]||(o[0]=r=>re(g)?g.value=r:null),onNewConversation:le,onSwitchConversation:me},null,8,["agent","publish-token","access-token","modelValue"])]),a("div",{class:ae(["bg-background flex h-full min-h-0 w-full flex-col items-center rounded-xl",{"rounded-none!":e(Y)}])},[e(K)?(s(),m("div",_a,[a("div",xa,[u(d,{name:"i-lucide-loader-2",class:"text-primary size-6 animate-spin"}),a("span",ya,k(t.$t("ai-agent.frontend.chat.loadingAgent")),1)])])):e(H)?(s(),m("div",ka,[a("div",ba,[u(d,{name:"i-lucide-alert-circle",class:"text-error mx-auto mb-4 size-12"}),a("h2",wa,k(t.$t("ai-agent.frontend.chat.loadingFailed")),1),a("p",Ca,k(e(H)),1)])])):e(n)?(s(),m(S,{key:2},[o[6]||(o[6]=a("div",{class:"flex h-12 w-full items-center justify-center"},null,-1)),u(Xe,{class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:w,onInView:o[3]||(o[3]=r=>G(!1))},{default:p(()=>[u(We,{loading:!1,"has-more":e(O),threshold:500,"content-class":"max-w-[800px] w-full space-y-3 p-4 lg:py-4",onLoadMore:Ge},{default:p(()=>[e(i).length===0&&(!e(z)||!e(n).formFields?.length)&&e(n).openingStatement?.length&&e(n).openingQuestions?.length?(s(),$(we,{key:0,messages:[{role:"assistant",avatar:e(n)?.chatAvatar||e(n)?.avatar,content:e(n)?.openingStatement||""}],"scroll-area-height":200,assistant:{actions:[]}},{content:p(({message:r})=>[u(y,{content:r.content.toString(),"show-run-button":!1},null,8,["content"]),a("div",{class:ae(["flex flex-col gap-2",{"ml-4":e(n)?.avatar}])},[a("div",$a,k(t.$t("ai-agent.frontend.chat.youCanAskMe")),1),(s(!0),m(S,null,A(e(n)?.openingQuestions||[],q=>(s(),m("div",{key:q},[u(M,{label:q,color:"primary",variant:"soft",onClick:Q=>oe(q)},null,8,["label","onClick"])]))),128))],2)]),_:1},8,["messages"])):_("",!0),e(i).length!==0?(s(),$(we,{key:1,messages:e(i),"scroll-area-height":e(ue),error:e(Oe),assistant:{actions:[{label:e(C)("ai-chat.frontend.messages.retry"),icon:"i-lucide-rotate-cw-square",onClick:()=>e(Ne)()},{label:e(C)("ai-agent.frontend.chat.chatContext"),icon:"i-lucide-file-type",show:!e(n).showContext,onClick:r=>{r?.metadata?.context?He(r.metadata.context):e(E).error(e(C)("ai-agent.backend.configuration.noChatContext"))}},{label:e(C)("ai-agent.frontend.chat.annotation"),icon:"i-lucide-wrap-text",show:!e(n).enableFeedback,onClick:(r,q)=>{const Q=r.metadata?.annotations?.annotationId;Q?Ke(Q,r.id):Je(r,q)}}]},"spacing-offset":160},{content:p(({message:r,index:q})=>[r.content.length?(s(),$(y,{key:0,content:r.content.toString(),"show-run-button":!1},{before:p(()=>[r.status==="loading"?(s(),m("div",Ta,[u(d,{name:"i-lucide-loader-2",class:"animate-spin"}),a("span",null,k(e(C)("ai-chat.frontend.messages.thinking")),1)])):_("",!0)]),after:p(()=>[r.metadata?.references&&r.metadata.references.length>0&&r.role==="assistant"&&!e(pe)&&e(n).showReference?(s(),m(S,{key:0},[a("div",Sa,[a("span",Fa,k(e(C)("ai-agent.frontend.chat.reference")),1),r.metadata?.references&&r.metadata.references.length>0&&r.role==="assistant"?(s(),$(Ye,{key:0,size:"xs",type:"dashed"})):_("",!0)]),u(Ze,{references:r.metadata.references},null,8,["references"])],64)):_("",!0)]),_:2},1032,["content"])):_("",!0),r.metadata?.suggestions&&e(i).length-1===q?(s(),m("div",za,[(s(!0),m(S,null,A(r.metadata.suggestions,Q=>(s(),m("div",{key:Q},[u(M,{label:Q,color:"primary",variant:"soft",onClick:La=>oe(Q)},null,8,["label","onClick"])]))),128))])):_("",!0)]),_:1},8,["messages","scroll-area-height","error","assistant"])):_("",!0),e(n).formFields&&e(n).formFields.length>0?(s(),m("div",Va,[a("div",Ia,[a("span",Ma,[u(d,{name:"i-lucide-bot-message-square",class:"text-primary size-7"}),Le(" "+k(e(C)("ai-agent.frontend.chat.newConversationSettings")),1)]),e(i).length||!e(z)?(s(),$(M,{key:0,color:"primary",variant:"ghost",size:"sm",onClick:o[1]||(o[1]=r=>z.value=!e(z))},{default:p(()=>[a("span",null,k(e(z)?e(C)("console-common.close"):e(C)("console-common.edit")),1)]),_:1})):_("",!0)]),gt(a("div",null,[u(e(j),{inputs:e(n).formFieldsInputs,"onUpdate:inputs":o[2]||(o[2]=r=>e(n).formFieldsInputs=r),formFields:e(n).formFields,class:"w-full bg-transparent pt-0",formClass:"bg-muted hover:bg-muted"},null,8,["inputs","formFields"])],512),[[ht,e(z)]]),e(i).length===0&&e(z)?(s(),m("div",Aa,[u(M,{color:"primary",class:"w-full justify-center",onClick:Qe},{default:p(()=>[a("span",null,k(e(C)("ai-agent.frontend.chat.startConversation")),1)]),_:1})])):_("",!0)])):_("",!0)]),_:1},8,["has-more"])]),_:1},512),a("div",Ea,[e(n).quickCommands?.length?(s(),m("div",Ua,[a("div",Ba,[(s(!0),m(S,null,A(e(n).quickCommands,r=>(s(),$(M,{key:r.name,color:"neutral",variant:"soft",size:"sm",onClick:q=>oe(r.content)},{default:p(()=>[r.avatar?(s(),$(et,{key:0,src:r.avatar,class:"h-4 w-4"},null,8,["src"])):_("",!0),a("span",null,k(r.name),1)]),_:2},1032,["onClick"]))),128))])])):_("",!0),u(tt,{modelValue:e(f),"onUpdate:modelValue":o[4]||(o[4]=r=>re(f)?f.value=r:null),"file-list":e(W),"onUpdate:fileList":o[5]||(o[5]=r=>re(W)?W.value=r:null),"is-loading":e(pe),placeholder:e(C)("ai-chat.frontend.and",{name:e(n).name}),attachmentSizeLimit:e(V)?.attachmentSizeLimit,class:"sticky bottom-0 z-10 [view-transition-name:chat-prompt]",rows:1,onStop:e(qe),onSubmit:oe},{"panel-right-item":p(()=>[(e(n).billingConfig?.price??0)>0?(s(),m("span",Da,k(e(C)("ai-chat.frontend.singleRunConsumption",{price:e(n).billingConfig?.price??0})),1)):_("",!0)]),_:1},8,["modelValue","file-list","is-loading","placeholder","attachmentSizeLimit","onStop"])])],64)):_("",!0)],2)],2)}}});export{os as _};
