const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DC6wboFO.js","./CDmbk8fH.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./b-_TUx9i.js","./B22A-h4k.js","./Cfcu-t3n.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./XpsTG8vq.js","./Cwv7PZX5.js"])))=>i.map(i=>d[i]);
import{u as V,J as $,d as H,aY as J,b as Y,aq as Z,au as K,ap as X,Q as ee,a1 as te,aZ as re,g as se,R as S,ah as oe,c as i,p as t,q as r,l as d,v as o,F as ae,B as ne,k as y,t as b,C as ce,_ as ie,a_ as le,U as T,o as l,y as de,z as pe,x as w}from"#entry";import{_ as me}from"./CyGK14vg.js";import{u as ue}from"./BSZxZzsH.js";import"./BgHJjJs-.js";import"./8-c-A7PB.js";import"./DN9ov8OT.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./nBDBqKnC.js";import"./9bDOsXij.js";import"./B22A-h4k.js";import"./BzLCLO6P.js";const Q=()=>V("/recharge/center"),he=p=>$("/recharge/submitRecharge",p),U=p=>$("/pay/prepay",p),ge=p=>V("/pay/getPayResult",p),fe={class:"h-full"},_e={key:0,class:"flex h-full flex-col space-y-4 px-6 pt-6"},ye={class:"flex flex-1 flex-col space-y-8 overflow-y-auto"},xe={class:"bg-muted flex items-center gap-4 rounded-lg p-4"},ve={class:"text-lg font-medium"},ke={class:"text-center"},Ie={class:"space-y-4"},be={class:"text-lg font-medium"},we={key:0,class:"grid grid-cols-1 gap-x-4 gap-y-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Pe=["onClick"],Ce={key:0,class:"absolute -top-4 left-0 rounded-tl-md rounded-br-md bg-[#352B00] px-2 py-0.5 text-xs text-[#FFE7B5]"},Re={class:"mb-2 flex items-center gap-2"},Oe={class:"text-xl font-bold"},Me={class:"mb-4 text-lg font-medium"},Ee={class:"space-y-2"},Se={key:0,class:"flex items-center gap-2"},Te={class:"space-x-1 text-sm text-gray-600"},Qe={class:"font-bold"},Ue={key:1,class:"text-muted-foreground"},Ve={class:"space-y-4"},$e={class:"text-lg font-medium"},Ae={class:"flex flex-row items-center justify-start gap-6"},Be={class:"flex items-center gap-2"},De={class:"space-y-4"},ze={class:"text-lg font-medium"},Fe=["innerHTML"],Le={key:1,class:"text-muted-foreground text-sm"},Ne={class:"flex items-center justify-between border-t pt-4"},We={class:"text-lg"},Ge={class:"text-muted-foreground text-sm"},je={class:"flex items-center gap-4"},qe={key:0,class:"text-xl font-bold"},He={key:1,class:"flex h-full w-full items-center justify-center p-20"},Je={class:"w-full max-w-md p-8 text-center"},Ye={class:"mb-2 text-2xl font-bold"},Ze={class:"text-muted-foreground text-sm"},pt=H({__name:"recharge-center",async setup(p){let h,P;const A=S(()=>T(()=>import("./DC6wboFO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),B=S(()=>T(()=>import("./Cwv7PZX5.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),D=J(),{t:n}=Y(),x=Z(),C=K(),m=X(),R=ee(),e=te({_prepaidData:null,orderInfo:null,rechargeOptions:[],paymentMethods:[],selectedOptionIndex:0,selectedPaymentMethod:1,rechargeInstructions:void 0,rechargeSuccess:!1,isQrCodeExpired:!1}),{start:O,clear:v}=ue(async s=>{try{if(!e.orderInfo?.orderId){s();return}(await ge({orderId:e.orderInfo.orderId,from:"recharge"})).payStatus===1&&(s(),await z(),await m.getUser(),L())}catch(a){console.error("Payment polling error:",a)}},{interval:3e3,maxWaitTime:12e4,stopCondition:()=>e.isQrCodeExpired,onEnded:()=>{e.rechargeSuccess||(e.isQrCodeExpired=!0)}}),{data:k}=([h,P]=re(()=>le("rechargeCenterInfo",()=>Q(),{transform:s=>(e.paymentMethods=s.payWayList.map(a=>({value:a.payType,label:a.name,icon:a.logo})),e.rechargeInstructions=s.rechargeExplain,e.rechargeOptions=s.rechargeRule,s)})),h=await h,P(),h),z=async()=>{try{const s=await Q();e.paymentMethods=s.payWayList.map(a=>({value:a.payType,label:a.name,icon:a.logo})),e.rechargeInstructions=s.rechargeExplain,e.rechargeOptions=s.rechargeRule}catch(s){console.error("Failed to refresh recharge info:",s)}},g=se(()=>e.rechargeOptions.length===0?null:e.rechargeOptions[e.selectedOptionIndex]),F=async()=>{try{if(!g.value){x.error(n("marketing.frontend.recharge.noOptionSelected"));return}const s=await he({id:g.value.id,payType:e.selectedPaymentMethod});e.orderInfo=s;const a=await U({from:"recharge",orderId:s.orderId,payType:e.selectedPaymentMethod});E(a),e.isQrCodeExpired=!1,e.rechargeSuccess=!1,O()}catch(s){console.error("Recharge failed:",s)}},M=R.create(A),E=async s=>{await M.open({prepaidData:s,orderInfo:e.orderInfo,isQrCodeExpired:e.isQrCodeExpired,onRefreshQrCode:()=>W()}).result&&(v(),e.isQrCodeExpired=!1,x.warning(n("marketing.frontend.recharge.cancelPay")))},L=async()=>{const a=R.create(B).open();M.close(),await a.result&&j()},N=()=>{C.push(`/profile/${m.userInfo?.id}/power-detail`)},W=async()=>{try{if(v(),!e.orderInfo?.orderId){console.error("Order ID does not exist"),x.error(n("marketing.frontend.recharge.orderNotFound"));return}const s=await U({from:"recharge",orderId:e.orderInfo.orderId,payType:e.selectedPaymentMethod});E(s),e.isQrCodeExpired=!1,e.rechargeSuccess=!1,O()}catch(s){console.error("Failed to refresh QR code:",s)}},G=()=>{window.open("/agreement?type=agreement&item=payment","_blank")},j=()=>{C.push(`/profile/${m.userInfo?.id}/power-detail`)};return oe(()=>{v()}),(s,a)=>{const f=ce,_=de,q=me,I=ie;return l(),i("div",fe,[t(k)?.rechargeStatus?(l(),i("div",_e,[r("div",ye,[r("div",xe,[d(f,{src:t(m).userInfo.avatar,size:"3xl"},null,8,["src"]),r("div",null,[r("div",ve,[r("span",null,o(t(m).userInfo.nickname||t(n)("user.frontend.profile.notSet")),1)]),r("div",{class:"text-muted-foreground flex cursor-pointer items-center gap-1",onClick:N},[r("span",ke,o(t(n)("marketing.frontend.recharge.powerBalance"))+"： "+o(t(k)?.user.power),1),d(_,{name:"i-lucide-chevron-right",class:"text-sm"})])])]),r("div",Ie,[r("h2",be,o(t(n)("marketing.frontend.recharge.selectRechargePackage")),1),t(e).rechargeOptions.length>0?(l(),i("div",we,[(l(!0),i(ae,null,ne(t(e).rechargeOptions,(c,u)=>(l(),i("div",{key:u,class:pe(["border-muted relative cursor-pointer rounded-lg border p-4 transition-all duration-200",{"border-primary-500 bg-muted":t(e).selectedOptionIndex===u,"bg-primary/5":t(e).selectedOptionIndex===u,"hover:border-primary-300 border-gray-200":t(e).selectedOptionIndex!==u}]),onClick:Ke=>t(e).selectedOptionIndex=u},[c.label?(l(),i("div",Ce,o(c.label),1)):b("",!0),r("div",Re,[d(_,{name:"i-lucide-zap",class:"text-primary text-xl"}),r("span",Oe,o(c.power),1)]),r("div",Me,"¥ "+o(c.sellPrice),1),r("ul",Ee,[c.givePower?(l(),i("li",Se,[d(_,{name:"i-lucide-check",class:"text-sm text-green-500"}),r("span",Te,[r("span",null,o(t(n)("marketing.frontend.recharge.add")),1),r("span",Qe,o(c.givePower),1),r("span",null,o(t(n)("marketing.frontend.recharge.power")),1)])])):b("",!0)])],10,Pe))),128))])):(l(),i("div",Ue,o(t(n)("marketing.frontend.recharge.noRechargeOptions")),1))]),r("div",Ve,[r("h2",$e,o(t(n)("marketing.frontend.recharge.paymentMethod")),1),r("div",Ae,[d(q,{modelValue:t(e).selectedPaymentMethod,"onUpdate:modelValue":a[0]||(a[0]=c=>t(e).selectedPaymentMethod=c),orientation:"horizontal",variant:"card",color:"primary",items:t(e).paymentMethods},{label:y(({item:c})=>[r("div",Be,[d(f,{src:c?.icon,size:"2xs"},null,8,["src"]),r("span",null,o(c?.label),1)])]),_:1},8,["modelValue","items"])])]),r("div",De,[r("h2",ze,o(t(n)("marketing.frontend.recharge.rechargeInstructions.title")),1),t(e).rechargeInstructions?(l(),i("div",{key:0,innerHTML:t(e).rechargeInstructions,class:"text-muted-foreground space-y-2 text-sm whitespace-pre-wrap"},null,8,Fe)):(l(),i("div",Le,o(t(n)("marketing.frontend.recharge.rechargeInstructions.content")),1))])]),r("div",Ne,[r("div",We,[r("span",Ge,o(t(n)("marketing.frontend.recharge.agreement")),1),d(I,{variant:"link",class:"p-0",onClick:G},{default:y(()=>[w(" 《"+o(t(D).siteConfig?.agreement.paymentTitle||t(n)("marketing.frontend.recharge.payment"))+"》 ",1)]),_:1})]),r("div",je,[t(g)?(l(),i("div",qe," ¥ "+o(t(g)?.sellPrice),1)):b("",!0),d(I,{color:"primary",size:"lg",disabled:!t(k)?.rechargeRule.length,loadingAuto:"",onClick:F},{default:y(()=>[w(o(t(n)("marketing.frontend.recharge.immediatelyPurchase")),1)]),_:1},8,["disabled"])])])])):(l(),i("div",He,[r("div",Je,[d(_,{name:"i-lucide-lock",class:"text-primary mx-auto mb-4 text-4xl"}),r("h1",Ye,o(t(n)("marketing.frontend.recharge.notOpen")),1),r("p",Ze,o(t(n)("marketing.frontend.recharge.notOpenTip")),1),d(I,{class:"mt-6",icon:"i-tabler-arrow-left",variant:"soft",onClick:a[1]||(a[1]=c=>s.$router.back())},{default:y(()=>[w(o(t(n)("marketing.frontend.recharge.back")),1)]),_:1})])]))])}}});export{pt as default};
