const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CdEI2ZYD.js","./B9WZOnAv.js","./YsC0FLg2.js","./CBooyAK7.js","./BqoA6bN6.js","./TH-3OOuG.js","./Bub1HYiY.js","./B22A-h4k.js","./lw_U4-W2.js","./XpsTG8vq.js","./BaNg8fjw.js","./CfxLE1oh.js","./--UdezPG.js","./Bu7cOM_l.js","./BO1GPLSL.js","./CLTNKp0S.js","./8-c-A7PB.js","./kRIii9yh.js","./Cfcu-t3n.js","./C6Y-ieo6.js","./b-_TUx9i.js","./DaNf1Wdt.js","./CKXZhss7.js","./Cpt2kRVT.js","./pUN2d83w.js","./C1DLXs69.js","./B1XcE43x.js","./DlAUqK2U.js","./CBY9SXo7.js"])))=>i.map(i=>d[i]);
import{d as A,aJ as K,aq as W,b as H,g as J,s as g,a1 as R,aK as Q,c as m,o as u,q as t,v as n,p as e,l as f,k as _,_ as G,n as $,x as h,A as X,R as E,F as I,B as M,j as Y,t as V,y as Z,U as j,aT as ee,h as l}from"#entry";import{_ as te}from"./D-yR6Fj9.js";import{_ as se}from"./CBooyAK7.js";import{t as ae}from"./DpSZ1r7x.js";import{u as q}from"./B93AZ-4h.js";import"./Dn8X9Gvz.js";import"./DlAUqK2U.js";const oe={class:"flex h-full w-full flex-col px-6"},ne={class:"flex flex-col justify-center gap-1 pt-4"},le={class:"text-lg! font-bold"},ie={class:"text-muted-foreground text-sm"},re={class:"flex h-full min-h-0 gap-6 py-6"},ce={class:"flex h-full w-1/2 flex-col space-y-6"},de={class:"flex w-full items-center justify-between p-2"},ue={class:"text-muted-foreground text-sm"},me={class:"text-muted-foreground text-xs"},fe={class:"flex h-full min-h-0 flex-col"},_e={class:"mb-2 text-base font-medium"},pe=["onClick"],he={class:"min-w-0 flex-1"},xe={class:"mb-1 flex items-center justify-between"},ge={class:"flex items-center gap-2"},ve={class:"text-muted-foreground ml-2 text-xs"},be={class:"text-muted-foreground text-sm"},ye={class:"w-1/2 flex-none"},ke={class:"bg-muted flex h-full flex-col rounded-lg p-4"},we={class:"mb-4 text-base font-medium"},Ce={key:0,class:"text-muted-foreground flex flex-1 items-center justify-center py-8 text-center"},Te={key:1,class:"flex-1 space-y-4 overflow-auto"},Re={class:"space-y-3"},$e={class:"flex items-center justify-between"},Ee={class:"flex items-center gap-2"},Ie={class:"text-sm font-medium"},Me={class:"text-muted-foreground text-xs"},Ve={class:"flex items-center gap-2"},je={class:"text-muted-foreground line-clamp-2 text-sm leading-relaxed"},qe={key:0,class:"text-muted-foreground border-default border-t pt-3 text-xs"},Fe={class:"font-medium"},Pe=A({__name:"test",setup(Le){const F=E(()=>j(()=>import("./CdEI2ZYD.js").then(s=>s.c),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),import.meta.url)),L=E(()=>j(()=>import("./CBY9SXo7.js"),__vite__mapDeps([28,2]),import.meta.url)),{params:N}=K(),k=W(),{t:a}=H(),B=J(()=>N.id),r=g(""),p=g(null),w=Z,C=te,x=g(!1),i=R({retrievalMode:"hybrid",strategy:"weighted_score",topK:3,scoreThreshold:.5,scoreThresholdEnabled:!1,weightConfig:{semanticWeight:.7,keywordWeight:.3},rerankConfig:{enabled:!1}}),v=g([]),D=()=>{const s=R({retrievalMode:i.retrievalMode,strategy:i.strategy,topK:i.topK,scoreThreshold:i.scoreThreshold,scoreThresholdEnabled:i.scoreThresholdEnabled,weightConfig:{...i.weightConfig},rerankConfig:{...i.rerankConfig}});q({title:a("ai-datasets.backend.retrieval.retrievalConfig"),content:ee({setup(){return()=>l("div",{class:"py-4"},[l(L,{modelValue:s,"onUpdate:modelValue":c=>{Object.assign(s,c)}})])}}),confirmText:a("console-common.confirm"),cancelText:a("console-common.cancel"),ui:{content:"!w-2xl"}}).then(()=>{Object.assign(i,s),x.value=!0})},{lockFn:b,isLock:T}=Q(async()=>{if(!r.value.trim()){k.error(a("ai-datasets.backend.test.placeholder"));return}const s=Date.now().toString(),c=new Date().toLocaleString();try{const d={query:r.value,retrievalConfig:x.value?i:void 0};p.value=await ae(B.value,d),v.value.unshift({id:s,query:r.value,timestamp:c,success:!0}),k.success(a("ai-datasets.backend.test.success"))}catch(d){console.error("召回测试失败:",d),v.value.unshift({id:s,query:r.value,timestamp:c,success:!1,error:d instanceof Error?d.message:"未知错误"})}}),S=s=>{r.value=s.query,b()},U=s=>{switch(s){case"vector":return"i-heroicons-squares-2x2";case"fullText":return"i-heroicons-document-text";case"hybrid":return"i-heroicons-squares-2x2"}},z=s=>{switch(s){case"vector":return a("ai-datasets.backend.retrieval.vector");case"fullText":return a("ai-datasets.backend.retrieval.fullText");case"hybrid":return a("ai-datasets.backend.retrieval.hybrid")}};function O(s){q({title:`${a("ai-datasets.backend.segments.chunkDetail")} ${s.chunkIndex!==void 0?` #${s.chunkIndex}`:""}`,content:()=>l("div",{class:"space-y-3"},[l("div",{class:"flex items-center justify-between mb-2"},[l("span",{class:"inline-flex items-center"},[l(w,{name:"i-lucide-grip",class:"size-3 mr-1"}),l("span",{class:"text-sm font-medium"},`Chunks #${s.chunkIndex??"-"}`),l("span",{class:"text-muted-foreground text-xs ml-2"},`${s.contentLength??"-"} character`)]),l("span",{class:"inline-block bg-primary/10 text-primary rounded px-2 py-0.5 text-xs font-semibold"},`SCORE ${s.score?.toFixed(2)??"-"}`)]),l(C,{style:{height:"300px"},class:"rounded-lg border border-default bg-background mt-4",shadow:!1},[l("div",{class:"whitespace-pre-wrap text-sm p-2"},s.content)]),s.fileName?l("div",{class:"text-xs text-muted-foreground mt-2"},[l("span",{class:"font-medium"},`${a("ai-datasets.backend.segments.sourceFile")}:`),` ${s.fileName}`]):null]),ui:{content:"!w-3xl"}})}return(s,c)=>{const d=G,y=se;return u(),m("div",oe,[t("div",ne,[t("h1",le,n(e(a)("ai-datasets.backend.test.title")),1),t("p",ie,n(e(a)("ai-datasets.backend.test.description")),1)]),t("div",re,[t("div",ce,[f(e(F),{"is-loading":e(T),modelValue:e(r),"onUpdate:modelValue":c[0]||(c[0]=o=>X(r)?r.value=o:null),rows:6,placeholder:s.$t("ai-datasets.backend.test.placeholder"),onSubmit:e(b)},{"panel-top":_(()=>[t("div",de,[t("span",ue,n(e(a)("ai-datasets.backend.test.retrievalConfig")),1),f(d,{variant:"outline",size:"sm",icon:U(e(x)?e(i).retrievalMode:"hybrid"),onClick:D},{default:_(()=>[h(n(e(x)?z(e(i).retrievalMode):e(a)("ai-datasets.backend.retrieval.hybrid")),1)]),_:1},8,["icon"])])]),"panel-left":_(()=>[t("div",me,n(e(r).length)+" / 250",1)]),"panel-right":_(()=>[f(d,{loading:e(T),disabled:!e(r).trim(),color:"primary",size:"md",onClick:$(e(b),["stop"])},{default:_(()=>[h(n(e(a)("ai-datasets.backend.test.test")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1},8,["is-loading","modelValue","placeholder","onSubmit"]),t("div",fe,[t("h3",_e,n(e(a)("ai-datasets.backend.test.record")),1),f(e(C),{class:"grid h-full w-full",shadow:!1},{default:_(()=>[(u(!0),m(I,null,M(e(v).slice(0,10),o=>(u(),m("div",{key:o.id,class:"hover:bg-muted/50 mb-2 flex w-full cursor-pointer items-center justify-between rounded-lg border p-3",onClick:P=>S(o)},[t("div",he,[t("div",xe,[t("div",ge,[c[1]||(c[1]=t("span",{class:"text-sm font-medium"},"Retrieval Test",-1)),f(y,{color:o.success?"success":"error",variant:"soft",size:"xs"},{default:_(()=>[h(n(o.success?e(a)("console-common.messages.success"):e(a)("console-common.messages.failed")),1)]),_:2},1032,["color"])]),t("div",ve,n(o.timestamp),1)]),t("div",be,n(o.success?o.query:o.error),1)])],8,pe))),128))]),_:1})])]),t("div",ye,[t("div",ke,[t("h3",we,[h(n(e(p)?`${e(p).chunks.length} ${e(a)("ai-datasets.backend.test.recallParagraph")}`:e(a)("ai-datasets.backend.test.recallResult"))+" ",1),e(p)?.totalTime?(u(),Y(y,{key:0,label:`${e(p)?.totalTime}ms`,color:"primary",variant:"soft"},null,8,["label"])):V("",!0)]),e(p)?(u(),m("div",Te,[t("div",Re,[(u(!0),m(I,null,M(e(p).chunks,o=>(u(),m("div",{key:o.id,class:"bg-background space-y-3 rounded-lg p-4"},[t("div",$e,[t("div",Ee,[f(e(w),{name:"i-lucide-grip",class:"size-3"}),t("span",Ie,"Chunks #"+n(o.chunkIndex),1),t("span",Me,n(o.contentLength)+" character",1)]),t("div",Ve,[f(y,{label:`SCORE ${o.score?.toFixed(2)??"-"}`,color:"primary",variant:"soft"},null,8,["label"]),f(d,{variant:"ghost",size:"sm",icon:"i-lucide-external-link",onClick:$(P=>O(o),["stop"])},{default:_(()=>[h(n(e(a)("console-common.open")),1)]),_:1},8,["onClick"])])]),t("p",je,n(o.content),1),o?.fileName?(u(),m("div",qe,[t("span",Fe,n(e(a)("ai-datasets.backend.segments.sourceFile"))+": ",1),h(" "+n(o.fileName),1)])):V("",!0)]))),128))])])):(u(),m("div",Ce,n(e(a)("ai-datasets.backend.test.tip")),1))])])])])}}});export{Pe as default};
