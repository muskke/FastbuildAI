import{aQ as Q,b3 as X,aP as me,bg as fe,g as z,bd as I,j as k,o as a,k as C,t as f,l as y,p as m,r as M,z as b,m as L,d as S,b as V,c as d,q as n,y as U,v as u,F as A,B as O,x as q,bu as ge,bv as ve,C as Z,$ as he,ap as _e,e as ee,aN as xe,O as ye,S as be,D as K,b6 as we,_ as ke,Y as Ce,w as $e,i as ze,ah as Me,G as Te}from"#entry";import{_ as Ae}from"./B9WZOnAv.js";import{b as Oe,a as Se,C as Be}from"./BvoFq0Fi.js";import{b as N}from"./BI1JbAYD.js";import{S as Ue}from"./Bu7cOM_l.js";import{_ as qe}from"./ADUcesrP.js";import{_ as Ie}from"./BqoA6bN6.js";import{_ as Ne}from"./DBjGnECu.js";const Ve={slots:{root:"",content:"data-[state=open]:animate-[collapsible-down_200ms_ease-out] data-[state=closed]:animate-[collapsible-up_200ms_ease-out] overflow-hidden"}},j={__name:"Collapsible",props:{as:{type:null,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1},defaultOpen:{type:Boolean,required:!1},open:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(i,{emit:t}){const l=i,h=t,p=Q(),g=X(),_=me(fe(l,"as","defaultOpen","open","disabled","unmountOnHide"),h),v=z(()=>I({extend:I(Ve),...g.ui?.collapsible||{}})());return(s,$)=>(a(),k(m(Be),L(m(_),{class:v.value.root({class:[l.ui?.root,l.class]})}),{default:C(({open:o})=>[p.default?(a(),k(m(Oe),{key:0,"as-child":""},{default:C(()=>[M(s.$slots,"default",{open:o})]),_:2},1024)):f("",!0),y(m(Se),{class:b(v.value.content({class:l.ui?.content}))},{default:C(()=>[M(s.$slots,"content")]),_:3},8,["class"])]),_:3},16,["class"]))}},He={key:0,class:"bg-muted mb-2 rounded-lg p-2"},Re={class:"flex cursor-pointer flex-row items-center gap-2 p-1 text-xs select-none"},Le={class:"text-sm font-medium"},je={key:0,class:"text-sm font-medium"},De={key:0,class:"text-muted-foreground rounded p-2 text-sm whitespace-pre-wrap"},Ee=S({__name:"reference-reasoning",props:{reasoning:{default:void 0},messageId:{default:void 0},isThinking:{type:Boolean,default:!1},defaultOpen:{type:Boolean,default:!1}},setup(i){const{t}=V(),l=i,h=z(()=>{if(l.reasoning?.duration)return N(l.reasoning.duration);if(l.reasoning?.startTime&&l.reasoning?.endTime){const p=l.reasoning.endTime-l.reasoning.startTime;return N(p)}return null});return(p,g)=>{const _=U,v=j;return i.reasoning?.content||i.isThinking?(a(),d("div",He,[y(v,{unmountOnHide:!1,class:"group","default-open":i.defaultOpen},{content:C(()=>[i.reasoning?.content?(a(),d("div",De,u(i.reasoning.content),1)):f("",!0)]),default:C(()=>[n("div",Re,[y(_,{name:"i-lucide-atom",class:"text-primary size-4"}),n("div",Le,u(i.isThinking?m(t)("common.chat.reasoning.thinking"):m(t)("common.chat.reasoning.completed")),1),m(h)?(a(),d("div",je," ("+u(m(t)("common.chat.reasoning.duration"))+u(m(h))+") ",1)):f("",!0),y(_,{name:"i-lucide-chevron-down",class:"size-4 rotate-270 transition-transform duration-200 group-data-[state=open]:rotate-360"})])]),_:1},8,["default-open"])])):f("",!0)}}}),Fe={key:0,class:"bg-muted mb-2 rounded-lg p-2"},Pe={class:"flex w-full cursor-pointer flex-wrap items-center gap-2 text-xs select-none"},Je={class:"flex min-w-0 flex-1 flex-wrap items-center gap-2"},We={class:"shrink-0"},Ye=["title"],Ge={class:"text-md shrink-0"},Ke=["title"],Qe={class:"shrink-0"},Xe={key:1,class:"bg-secondary shrink-0 rounded px-2 py-1 text-xs"},Ze={class:"mt-3 space-y-3"},et={class:"bg-background rounded p-3"},tt={class:"text-foreground mb-2 text-xs font-medium"},at={class:"text-sm text-gray-800"},ot={class:"bg-background rounded p-3"},st={class:"text-foreground mb-2 text-xs font-medium"},rt={class:"text-muted-foreground flex flex-col gap-2 text-sm"},nt={class:"text-foreground font-bold"},lt=S({__name:"reference-knowledge",props:{references:{default:()=>[]}},setup(i){const{t}=V(),l={vector:t("common.datasets.retrieval.vector"),fullText:t("common.datasets.retrieval.fullText"),hybrid:t("common.datasets.retrieval.hybrid")};return(h,p)=>{const g=U,_=j;return i.references&&i.references.length>0?(a(),d("div",Fe,[(a(!0),d(A,null,O(i.references,(v,s)=>(a(),k(_,{class:"group",key:s,unmountOnHide:!1},{content:C(()=>[n("div",Ze,[n("div",et,[n("div",tt,u(m(t)("common.reference.request")),1),n("div",at,u(v?.userContent),1)]),n("div",ot,[n("div",st,u(m(t)("common.reference.response")),1),n("div",rt,[(a(!0),d(A,null,O(v?.chunks,($,o)=>(a(),d("div",{key:o},[n("span",nt," #chunk-"+u(o+1)+": ",1),q(" "+u($.content),1)]))),128))])])])]),default:C(()=>[n("div",Pe,[y(g,{name:"i-lucide-hammer",class:"text-primary size-4"}),n("div",Je,[n("div",We,u(m(t)("common.chat.knowledgeCall.start"))+" "+u(m(t)("common.chat.knowledgeCall.from")),1),n("div",{name:"knowledge",class:"bg-primary/15 text-primary max-w-[50vw] truncate rounded px-2 py-1 text-xs sm:max-w-[20rem]",title:v.datasetName},u(v.datasetName),9,Ye),n("div",Ge,u(m(t)("common.chat.knowledgeCall.call")),1),v.retrievalMode?(a(),d("div",{key:0,name:"knowledge",class:"bg-primary/15 text-primary max-w-[40vw] truncate rounded px-2 py-1 text-xs sm:max-w-[16rem]",title:l[v.retrievalMode]},u(l[v.retrievalMode]),9,Ke)):f("",!0),n("div",Qe,u(m(t)("common.chat.knowledgeCall.finished")),1),v.duration?(a(),d("div",Xe,u(m(t)("common.chat.toolCall.duration"))+" "+u(m(N)(v.duration)),1)):f("",!0)]),y(g,{name:"i-lucide-chevron-down",class:"ml-auto rotate-270 transition-transform duration-200 group-data-[state=open]:rotate-360"})])]),_:2},1024))),128))])):f("",!0)}}}),it={slots:{root:"flex gap-1.5",item:"group relative flex flex-1 gap-3",container:"relative flex items-center gap-1.5",indicator:"group-data-[state=completed]:text-inverted group-data-[state=active]:text-inverted text-muted",separator:"flex-1 rounded-full bg-elevated",wrapper:"w-full",date:"text-dimmed text-xs/5",title:"font-medium text-highlighted text-sm",description:"text-muted text-wrap text-sm"},variants:{orientation:{horizontal:{root:"flex-row w-full",item:"flex-col",separator:"h-0.5"},vertical:{root:"flex-col",container:"flex-col",separator:"w-0.5"}},color:{primary:{indicator:"group-data-[state=completed]:bg-primary group-data-[state=active]:bg-primary"},secondary:{indicator:"group-data-[state=completed]:bg-secondary group-data-[state=active]:bg-secondary"},success:{indicator:"group-data-[state=completed]:bg-success group-data-[state=active]:bg-success"},info:{indicator:"group-data-[state=completed]:bg-info group-data-[state=active]:bg-info"},warning:{indicator:"group-data-[state=completed]:bg-warning group-data-[state=active]:bg-warning"},error:{indicator:"group-data-[state=completed]:bg-error group-data-[state=active]:bg-error"},neutral:{indicator:"group-data-[state=completed]:bg-inverted group-data-[state=active]:bg-inverted"}},size:{"3xs":"","2xs":"",xs:"",sm:"",md:"",lg:"",xl:"","2xl":"","3xl":""},reverse:{true:""}},compoundVariants:[{color:"primary",reverse:!1,class:{separator:"group-data-[state=completed]:bg-primary"}},{color:"secondary",reverse:!1,class:{separator:"group-data-[state=completed]:bg-secondary"}},{color:"success",reverse:!1,class:{separator:"group-data-[state=completed]:bg-success"}},{color:"info",reverse:!1,class:{separator:"group-data-[state=completed]:bg-info"}},{color:"warning",reverse:!1,class:{separator:"group-data-[state=completed]:bg-warning"}},{color:"error",reverse:!1,class:{separator:"group-data-[state=completed]:bg-error"}},{color:"primary",reverse:!0,class:{separator:"group-data-[state=active]:bg-primary group-data-[state=completed]:bg-primary"}},{color:"secondary",reverse:!0,class:{separator:"group-data-[state=active]:bg-secondary group-data-[state=completed]:bg-secondary"}},{color:"success",reverse:!0,class:{separator:"group-data-[state=active]:bg-success group-data-[state=completed]:bg-success"}},{color:"info",reverse:!0,class:{separator:"group-data-[state=active]:bg-info group-data-[state=completed]:bg-info"}},{color:"warning",reverse:!0,class:{separator:"group-data-[state=active]:bg-warning group-data-[state=completed]:bg-warning"}},{color:"error",reverse:!0,class:{separator:"group-data-[state=active]:bg-error group-data-[state=completed]:bg-error"}},{color:"neutral",reverse:!1,class:{separator:"group-data-[state=completed]:bg-inverted"}},{color:"neutral",reverse:!0,class:{separator:"group-data-[state=active]:bg-inverted group-data-[state=completed]:bg-inverted"}},{orientation:"horizontal",size:"3xs",class:{wrapper:"pe-4.5"}},{orientation:"horizontal",size:"2xs",class:{wrapper:"pe-5"}},{orientation:"horizontal",size:"xs",class:{wrapper:"pe-5.5"}},{orientation:"horizontal",size:"sm",class:{wrapper:"pe-6"}},{orientation:"horizontal",size:"md",class:{wrapper:"pe-6.5"}},{orientation:"horizontal",size:"lg",class:{wrapper:"pe-7"}},{orientation:"horizontal",size:"xl",class:{wrapper:"pe-7.5"}},{orientation:"horizontal",size:"2xl",class:{wrapper:"pe-8"}},{orientation:"horizontal",size:"3xl",class:{wrapper:"pe-8.5"}},{orientation:"vertical",size:"3xs",class:{wrapper:"-mt-0.5 pb-4.5"}},{orientation:"vertical",size:"2xs",class:{wrapper:"pb-5"}},{orientation:"vertical",size:"xs",class:{wrapper:"mt-0.5 pb-5.5"}},{orientation:"vertical",size:"sm",class:{wrapper:"mt-1 pb-6"}},{orientation:"vertical",size:"md",class:{wrapper:"mt-1.5 pb-6.5"}},{orientation:"vertical",size:"lg",class:{wrapper:"mt-2 pb-7"}},{orientation:"vertical",size:"xl",class:{wrapper:"mt-2.5 pb-7.5"}},{orientation:"vertical",size:"2xl",class:{wrapper:"mt-3 pb-8"}},{orientation:"vertical",size:"3xl",class:{wrapper:"mt-3.5 pb-8.5"}}],defaultVariants:{size:"md",color:"primary"}},ct=["data-state"],ut={__name:"Timeline",props:ge({as:{type:null,required:!1},items:{type:Array,required:!0},size:{type:null,required:!1},color:{type:null,required:!1},orientation:{type:null,required:!1,default:"vertical"},defaultValue:{type:[String,Number],required:!1},reverse:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},{modelValue:{type:[String,Number]},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const t=i,l=Q(),h=ve(i,"modelValue"),p=X(),g=z(()=>I({extend:I(it),...p.ui?.timeline||{}})({orientation:t.orientation,size:t.size,color:t.color,reverse:t.reverse})),_=z(()=>{const s=h.value??t.defaultValue;return typeof s=="string"?t.items.findIndex($=>$.value===s)??-1:t.reverse?s!=null?t.items.length-1-s:-1:s??-1});function v(s){if(_.value!==-1)return s===_.value?"active":t.reverse?s>_.value?"completed":void 0:s<_.value?"completed":void 0}return(s,$)=>(a(),k(m(he),{as:i.as,"data-orientation":i.orientation,class:b(g.value.root({class:[t.ui?.root,t.class]}))},{default:C(()=>[(a(!0),d(A,null,O(i.items,(o,w)=>(a(),d("div",{key:o.value??w,class:b(g.value.item({class:[t.ui?.item,o.ui?.item,o.class]})),"data-state":v(w)},[n("div",{class:b(g.value.container({class:[t.ui?.container,o.ui?.container]}))},[y(Z,L({size:i.size,icon:o.icon},{ref_for:!0},typeof o.avatar=="object"?o.avatar:{},{class:g.value.indicator({class:[t.ui?.indicator,o.ui?.indicator]}),ui:{icon:"text-inherit",fallback:"text-inherit"}}),{default:C(()=>[M(s.$slots,o.slot?`${o.slot}-indicator`:"indicator",{item:o})]),_:2},1040,["size","icon","class"]),w<i.items.length-1?(a(),k(m(Ue),{key:0,class:b(g.value.separator({class:[t.ui?.separator,o.ui?.separator]})),orientation:t.orientation},null,8,["class","orientation"])):f("",!0)],2),n("div",{class:b(g.value.wrapper({class:[t.ui?.wrapper,o.ui?.wrapper]}))},[o.date?(a(),d("div",{key:0,class:b(g.value.date({class:[t.ui?.date,o.ui?.date]}))},[M(s.$slots,o.slot?`${o.slot}-date`:"date",{item:o},()=>[q(u(o.date),1)])],2)):f("",!0),o.title||l.title?(a(),d("div",{key:1,class:b(g.value.title({class:[t.ui?.title,o.ui?.title]}))},[M(s.$slots,o.slot?`${o.slot}-title`:"title",{item:o},()=>[q(u(o.title),1)])],2)):f("",!0),o.description||l.description?(a(),d("div",{key:2,class:b(g.value.description({class:[t.ui?.description,o.ui?.description]}))},[M(s.$slots,o.slot?`${o.slot}-description`:"description",{item:o},()=>[q(u(o.description),1)])],2)):f("",!0)],2)],10,ct))),128))]),_:3},8,["as","data-orientation","class"]))}},dt={key:0,class:"bg-muted mb-2 flex flex-col gap-1.5 rounded-lg p-2"},pt={class:"flex cursor-pointer flex-row items-center justify-between text-xs select-none"},mt={class:"flex flex-wrap items-center gap-2"},ft={name:"tools",class:"bg-primary/15 text-primary rounded px-2 py-1 text-xs"},gt={class:"text-md"},vt={name:"tools",class:"bg-primary/15 text-primary rounded px-2 py-1 text-xs"},ht={key:1,class:"bg-secondary rounded px-2 py-1 text-xs"},_t={key:0,class:"bg-background mt-3 rounded p-3"},xt={class:"text-foreground text-md mb-3 font-medium"},yt=S({__name:"reference-mcp-tool-call",props:{toolCalls:{default:()=>[]},messageId:{default:void 0}},setup(i){const{t}=V(),l=h=>{const p=[];return h?.input&&p.push({title:`${t("common.chat.toolCall.startCall")} ${h?.tool?.name}`,description:JSON.stringify(h.input),icon:"tabler:number-1"}),h?.output&&p.push({title:`${t("common.chat.toolCall.finishedCall")} ${h?.tool?.name}`,description:JSON.stringify(h.output),icon:"tabler:number-2"}),p};return(h,p)=>{const g=U,_=ut,v=j;return i.toolCalls&&i.toolCalls.length>0?(a(),d("div",dt,[(a(!0),d(A,null,O(i.toolCalls,(s,$)=>(a(),k(v,{unmountOnHide:!1,class:"group",key:$},{content:C(()=>[s&&s?.tool?(a(),d("div",_t,[n("div",xt,u(s?.tool?.name)+" "+u(m(t)("common.reference.callDetails")),1),y(_,{size:"xs","default-value":l(s).length,items:l(s),ui:{item:"w-[calc(100%-36px)]"}},null,8,["default-value","items"])])):f("",!0)]),default:C(()=>[n("div",pt,[n("div",mt,[!s?.output&&!s?.error?(a(),k(g,{key:0,name:"i-lucide-loader-2",class:"animate-spin"})):f("",!0),p[0]||(p[0]=n("svg",{class:"size-4",width:"195",height:"195",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[n("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),n("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),n("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)),n("div",null,u(!s.input&&!s.output?m(t)("common.chat.toolCall.start"):"")+" "+u(s.input&&!s.output?m(t)("common.chat.toolCall.calling"):"")+" "+u(m(t)("common.chat.toolCall.from")),1),n("div",ft,u(s?.mcpServer?.name),1),n("div",gt,u(m(t)("common.chat.toolCall.call")),1),n("div",vt,u(s?.tool?.name),1),n("div",null,u(s.input&&s.output?m(t)("common.chat.toolCall.finished"):""),1),s.duration?(a(),d("div",ht,u(m(t)("common.chat.toolCall.duration"))+u(m(N)(s.duration)),1)):f("",!0)]),y(g,{name:"i-lucide-chevron-down",class:"rotate-270 transition-transform duration-200 group-data-[state=open]:rotate-360"})])]),_:2},1024))),128))])):f("",!0)}}}),bt=S({__name:"chats-bubble",props:{type:{default:"system"},bubbleClass:{default:""},clickable:{type:Boolean},loading:{type:Boolean},timestamp:{}},setup(i){const t=i,l=z(()=>{const h="rounded-lg text-sm max-w-full break-words",p=t.type==="user"?"bg-primary-400 text-background px-4 py-3":"text-foreground";return[h,p,t.bubbleClass]});return(h,p)=>(a(),d("div",{class:b(l.value)},[M(h.$slots,"default")],2))}}),wt=["data-role"],kt={key:0,class:"flex justify-end"},Ct={key:0,class:"bg-background flex items-center gap-2 rounded-lg"},$t={key:4,class:"flex items-center gap-2 px-4 text-red-500"},zt={class:"prose dark:prose-invert whitespace-pre-wrap"},Mt={key:6,class:"prose dark:prose-invert whitespace-pre-wrap"},Tt={key:0,class:"action flex items-center justify-between pl-4"},At={class:"flex items-center gap-1"},Ot={key:1,class:"mt-1 flex items-center gap-2"},Dt=S({__name:"chats-messages",props:{messages:{default:()=>[]},assistant:{default:()=>({actions:[]})},error:{},spacingOffset:{default:0},scrollAreaHeight:{default:0}},emits:["file-preview"],setup(i,{emit:t}){const l=i,h=t,{t:p}=V(),{userInfo:g}=_e(),_=ee("lastUserMessageRef"),{height:v}=xe(_),s=ye(be.CHAT_WINDOW_STYLE,{default:()=>"conversation"}),$=z(()=>s.value==="conversation"),o=z(()=>["flex flex-col gap-4",l.spacingOffset>0?`pb-[${l.spacingOffset}px]`:""].filter(Boolean)),w=z(()=>[...l.messages]),B=z(()=>{const r=w.value;return r.length>0&&r[r.length-1]?.role!=="user"}),H=z(()=>{if(!B.value||!l.scrollAreaHeight)return 120;const r=v.value>0?v.value:80,c=l.scrollAreaHeight-r-60;return Math.max(c,120)}),te=r=>r.role==="user"?g?.avatar||"":r.avatar||"",ae=r=>({user:p("common.chat.messages.me"),assistant:r.model?.model||p("common.chat.messages.assistant")})[r.role]||p("common.chat.messages.unknown"),oe=r=>!!(r.metadata?.reasoning&&!r.metadata.reasoning.endTime),T=r=>typeof r=="string"?r:Array.isArray(r)&&r.find(c=>c.type==="text")?.text||"",D=r=>Array.isArray(r)?r.filter(c=>c.type==="image_url"&&c.image_url).map(c=>({url:c.image_url?.url||"",detail:c.image_url?.detail})):[],E=r=>Array.isArray(r)?r.filter(c=>c.type==="video_url"&&c.video_url).map(c=>({url:c.video_url?.url||""})):[],F=r=>Array.isArray(r)?r.filter(c=>c.type==="input_audio"&&c.input_audio).map(c=>({url:c.input_audio?.data||"",format:c.input_audio?.format||"mp3"})):[],P=r=>Array.isArray(r)?r.filter(c=>c.type==="file_url"&&c.url&&c.name).map(c=>({name:c.name||"Unknown file",url:c.url||""})):[],se=(r,c)=>r?typeof r=="string"?r||p("common.chat.messages.sendFailed"):typeof r=="object"?r.message||r.content||T(c.content)||p("common.chat.messages.sendFailed"):JSON.stringify(r):T(c.content)||p("common.chat.messages.sendFailed");return(r,c)=>{const re=Z,ne=Ae,J=U,le=Ee,ie=lt,ce=yt,W=qe,ue=ke,de=Ie,Y=Ne,pe=bt,G=we("dompurify-html");return a(),d("div",{class:b(o.value)},[(a(!0),d(A,null,O(w.value,(e,R)=>(a(),d("div",{key:e.id,class:b(["flex w-full gap-3",{"flex-row-reverse":$.value&&e.role==="user"}]),"data-role":e.role,ref_for:!0,ref:e.role==="user"&&!m(v)?"lastUserMessageRef":void 0},[e.role==="user"||e.role==="assistant"&&e.avatar?(a(),d("div",{key:0,class:b(["flex-none",{"pt-2":e.role==="assistant"}])},[y(re,{src:te(e),alt:ae(e),size:"xl"},null,8,["src","alt"])],2)):f("",!0),n("div",{class:b(["flex min-w-0 flex-1 flex-col gap-2",$.value&&e.role==="user"?"items-end":"items-start"])},[e.role==="user"&&(P(e.content).length>0||D(e.content).length>0||E(e.content).length>0||F(e.content).length>0)?(a(),d("div",kt,[y(ne,{files:[...P(e.content).map(x=>({...x,mediaType:"file"})),...D(e.content).map(x=>({name:x.url.split("/").pop()||"image",url:x.url,mediaType:"image"})),...E(e.content).map(x=>({name:x.url.split("/").pop()||"video",url:x.url,mediaType:"video"})),...F(e.content).map(x=>({name:x.url.split("/").pop()||`audio.${x.format}`,url:x.url,mediaType:"audio"}))],"show-actions":!1,class:"max-w-[70%] justify-end",onView:c[0]||(c[0]=x=>h("file-preview",x))},null,8,["files"])])):f("",!0),y(pe,{type:e.role==="user"?"user":"system",style:Ce({minHeight:R===w.value.length-1&&e.role!=="user"?`${H.value}px`:"auto",maxWidth:e.role==="user"?"70%":"auto",width:e.role!=="user"?"100%":"auto"})},{default:C(()=>[n("div",{class:b(["rounded-lg",{"bg-background p-4":e.role==="assistant"}])},[e.status==="loading"&&!e.mcpToolCalls?.length&&!Object.keys(e.metadata||{}).length?(a(),d("div",Ct,[y(J,{name:"i-lucide-loader-2",class:"animate-spin"}),n("span",null,u(m(p)("common.chat.messages.thinking")),1)])):f("",!0),e.role==="assistant"&&e.metadata?.reasoning?.content?(a(),k(le,{reasoning:e.metadata.reasoning,"message-id":e.id,"is-thinking":!e.metadata.reasoning.endTime,"default-open":oe(e),key:`reasoning-${e.id}-${JSON.stringify(e.metadata.reasoning)}`},null,8,["reasoning","message-id","is-thinking","default-open"])):f("",!0),e.metadata?.references&&e.metadata.references.length>0&&e.role==="assistant"?(a(),k(ie,{key:2,references:e.metadata.references},null,8,["references"])):f("",!0),e.role==="assistant"&&e.mcpToolCalls?.length?(a(),k(ce,{"tool-calls":e.mcpToolCalls,"message-id":e.id,key:`tool-${e.id}-${e.mcpToolCalls.map(x=>x.output)}`},null,8,["tool-calls","message-id"])):f("",!0),e.status==="failed"?(a(),d("div",$t,[y(J,{name:"i-lucide-alert-circle"}),n("span",null,u(se(i.error,e)),1)])):e.role!=="user"?M(r.$slots,"content",{key:5,message:e,index:R},()=>[K(n("div",zt,null,512),[[G,T(e.content)]])]):T(e.content)?K((a(),d("div",Mt,null,512)),[[G,T(e.content)]]):f("",!0)],2),e.role==="assistant"&&i.assistant.actions?.length&&!["active","loading"].includes(e.status||"")?(a(),d("div",Tt,[n("div",At,[y(W,{content:T(e.content),size:"xs",color:"neutral",variant:"ghost"},null,8,["content"]),(a(!0),d(A,null,O(i.assistant.actions,x=>(a(),d(A,null,[x.show?f("",!0):(a(),k(de,{key:0,text:x.label,delay:100},{default:C(()=>[(a(),k(ue,{key:x.label,icon:x.icon,size:"xs",color:"neutral",variant:"ghost",class:"p-2",onClick:Ut=>x.onClick?.(e,R)},null,8,["icon","onClick"]))]),_:2},1032,["text"]))],64))),256))]),e.createdAt?(a(),k(Y,{key:0,datetime:e.createdAt,mode:"datetime",class:"text-muted-foreground text-xs"},null,8,["datetime"])):f("",!0)])):f("",!0)]),_:2},1032,["type","style"]),e.role==="user"?(a(),d("div",Ot,[e.createdAt?(a(),k(Y,{key:0,datetime:e.createdAt,mode:"datetime",class:"text-muted-foreground text-xs"},null,8,["datetime"])):f("",!0),y(W,{content:T(e.content),size:"xs",color:"neutral",variant:"ghost"},null,8,["content"])])):f("",!0)],2)],10,wt))),128))],2)}}}),St={class:"flex items-center justify-center gap-1 opacity-0"},Bt={class:"text-secondary-foreground ml-2 text-sm"},Et=S({inheritAttrs:!1,__name:"index",props:{loading:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0},threshold:{default:200},loadingText:{default:"Loading..."},contentClass:{}},emits:["loadMore"],setup(i,{emit:t}){const l=i,h=t;let p=null;const g=ee("loadingRef");let _=null;function v(o){if(!o)return null;let w=o.parentElement;for(;w;){const{overflow:B,overflowY:H}=getComputedStyle(w);if(["auto","scroll"].includes(B)||["auto","scroll"].includes(H))return w;w=w.parentElement}return document.documentElement}function s(){!window.IntersectionObserver||!g.value||!l.hasMore||l.loading||(_=new IntersectionObserver(o=>{o[0]?.isIntersecting&&h("loadMore")},{root:p,rootMargin:`${l.threshold}px`,threshold:0}),_.observe(g.value))}function $(){_&&(_.disconnect(),_=null),p?.scrollTop==0&&(p.scrollTop=1),Te(s)}return $e(()=>[l.loading,l.hasMore],()=>{$()}),ze(()=>{s(),p=v(g.value)}),Me(()=>{_?.disconnect(),_=null}),(o,w)=>{const B=U;return a(),d("div",L({class:"relative flex scale-y-[-1] flex-col items-center"},o.$attrs),[n("div",{class:b(["flex scale-y-[-1] flex-col-reverse",i.contentClass])},[M(o.$slots,"default")],2),!l.loading&&l.hasMore?(a(),d("div",{key:0,ref_key:"loadingRef",ref:g,class:"absolute bottom-0 z-[-1] flex h-screen w-full scale-y-[-1] items-center justify-center"},[n("div",St,[y(B,{name:"i-ph-spinner-gap-bold",size:"16",class:"text-secondary-foreground animate-spin"}),n("span",Bt,u(l.loadingText),1)])],512)):f("",!0)],16)}}});export{Et as _,Dt as a};
