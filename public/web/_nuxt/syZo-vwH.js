const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CH_AMNdk.js","./EHoVw6ZP.js","./CDmbk8fH.js","./8-c-A7PB.js","./DN9ov8OT.js","./TH-3OOuG.js","./b-_TUx9i.js","./DaNf1Wdt.js","./CKXZhss7.js","./Cfcu-t3n.js","./BstbYvQo.js","./B22A-h4k.js","./--UdezPG.js","./Cv1u6XyE.js","./CKTa8Hyi.js","./kRIii9yh.js","./pUN2d83w.js","./nBDBqKnC.js","./lw_U4-W2.js","./XpsTG8vq.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./DpSZ1r7x.js"])))=>i.map(i=>d[i]);
import{d as K,aJ as L,au as E,aq as F,b as j,e as q,Q as H,g as k,aM as N,w as Q,H as G,i as J,c as W,o as X,q as u,l as b,v as A,p as o,k as Y,_ as Z,ap as ee,h as s,C as ae,R as te,f as R,aT as se,U as oe}from"#entry";import{_ as re}from"./CBooyAK7.js";import{_ as ne}from"./B1Lg5z9T.js";import le from"./--UdezPG.js";import{_ as ie}from"./JOupiI7i.js";import ce from"./CfxLE1oh.js";import{_ as de}from"./Brvl6ix_.js";import{_ as me}from"./DgnnKcyj.js";import{p as ue,q as be,r as pe,s as fe}from"./DpSZ1r7x.js";import{u as ge}from"./FihYtau-.js";import{u as _}from"./B93AZ-4h.js";import{u as ve}from"./DqVgEjI6.js";import"./CLTNKp0S.js";import"./8-c-A7PB.js";import"./kRIii9yh.js";import"./TH-3OOuG.js";import"./Cfcu-t3n.js";import"./C6Y-ieo6.js";import"./b-_TUx9i.js";import"./DaNf1Wdt.js";import"./CKXZhss7.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./B22A-h4k.js";import"./Bub1HYiY.js";import"./lw_U4-W2.js";import"./XpsTG8vq.js";import"./PB-3MFNY.js";import"./Cv1u6XyE.js";import"./CKTa8Hyi.js";import"./DN9ov8OT.js";import"./nBDBqKnC.js";import"./DlAUqK2U.js";const he={class:"flex h-full w-full flex-col px-6"},ke={class:"flex flex-col justify-center gap-1 pt-4"},_e={class:"text-lg! font-bold"},xe={class:"text-muted-foreground text-sm"},we={class:"flex w-full justify-between gap-4 py-6 backdrop-blur-sm"},ye={class:"flex items-center gap-2 md:ml-auto"},Ae={class:"mt-auto flex items-center justify-end gap-3 py-4"},ra=K({__name:"members",setup(Re){const I=te(()=>oe(()=>import("./CH_AMNdk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url)),p=Z,x=re,w=ne,U=le,C=ae,{params:S}=L(),$=E(),f=F(),{t:a}=j(),g=q("table"),T=H(),v=k(()=>S.id),d=N({datasetId:v.value||"",username:"",role:void 0,isActive:void 0}),m=k(()=>({user:a("ai-datasets.backend.members.table.user"),role:a("ai-datasets.backend.members.table.role"),status:a("console-common.status"),createdAt:a("ai-datasets.backend.members.table.createdAt"),lastActiveAt:a("ai-datasets.backend.members.table.lastActiveAt"),actions:a("console-common.operation")})),{paging:l,getLists:i}=ge({fetchFun:ue,params:d}),y=k(()=>l.items.find(e=>e.oneself)),M={owner:{label:a("ai-datasets.backend.members.role.owner"),color:"error"},manager:{label:a("ai-datasets.backend.members.role.manager"),color:"warning"},editor:{label:a("ai-datasets.backend.members.role.editor"),color:"primary"},viewer:{label:a("ai-datasets.backend.members.role.viewer"),color:"neutral"}},V=[{accessorKey:"user",header:()=>s("p",{class:""},`${m.value.user}`),cell:({row:e})=>s("div",{class:"flex items-center gap-3"},[s(C,{src:e.original.user?.avatar,alt:e.original.user?.username||e.original.userId,size:"sm"}),s("div",void 0,[s("div",{class:"flex items-center gap-2"},[s("p",{class:"font-medium text-highlighted"},e.original.user?.nickname||e.original.user?.username||e.original.userId),e.original.oneself?s(x,{color:"primary",variant:"subtle",size:"xs"},()=>a("ai-datasets.backend.members.self")):null]),e.original.user?.username?s("p",{class:"text-sm text-muted-foreground truncate max-w-xs"},e.original.user.username):null,e.original.note?s("p",{class:"text-sm text-muted-foreground mt-1"},`${a("ai-datasets.backend.members.note")}: ${e.original.note}`):null])])},{accessorKey:"role",header:()=>s("p",{class:""},`${m.value.role}`),cell:({row:e})=>{const t=e.getValue("role"),n=M[t];return s(x,{color:n.color,variant:"subtle"},()=>n.label)}},{accessorKey:"createdAt",header:({column:e})=>{const t=e.getIsSorted();return s(p,{color:"neutral",variant:"ghost",label:m.value.createdAt,icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{const t=e.getValue("createdAt");return s("span",{class:"text-sm"},new Date(t).toLocaleDateString())}},{accessorKey:"lastActiveAt",header:()=>s("p",{class:""},`${m.value.lastActiveAt}`),cell:({row:e})=>{const t=e.getValue("lastActiveAt");return s("span",{class:"text-sm text-muted-foreground"},t?new Date(t).toLocaleDateString():"-")}},{id:"actions",header:()=>s("p",{class:""},`${m.value.actions}`),size:80,enableSorting:!1,enableHiding:!1,cell:({row:e})=>{const t=O(e);return t.length===0?null:s(w,{items:t},()=>s(p,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"},()=>""))}}];function O(e){return[e.original.isCurrentUserOwner&&e.original.role!=="owner"?{label:a("ai-datasets.backend.members.transferOwnership"),icon:"i-lucide-crown",onClick:()=>{B(e.original)}}:null,e.original.canOperate&&!e.original.oneself?{label:a("ai-datasets.backend.members.updateRole"),icon:"i-lucide-pen-line",onClick:()=>{z(e.original)}}:null,e.original.canOperate?{label:e.original.oneself?a("ai-datasets.backend.members.exit"):a("ai-datasets.backend.members.removeMember"),icon:e.original.oneself?"i-lucide-log-out":"i-lucide-trash",color:"error",onSelect(){P(e)}}:null].filter(Boolean)}Q(()=>[d.username,d.role,d.isActive],()=>{G(()=>{l.page=1,i()},300)()},{deep:!0});const D=async()=>{await T.create(I).open({modelValue:!0,datasetId:v.value||""}).result&&i()},z=async e=>{try{const t=R(e.role),n=R(e.note||""),h=[{label:a("ai-datasets.backend.members.role.manager"),value:"manager"},{label:a("ai-datasets.backend.members.role.editor"),value:"editor"},{label:a("ai-datasets.backend.members.role.viewer"),value:"viewer"}],r=se({setup(){return()=>s("div",{class:"space-y-4"},[s("div",{class:"text-sm text-gray-600 mb-3"},[a("console-common.update"),s("span",{class:"text-red-500"},e.user?.username||e.userId),a("ai-datasets.backend.members.roleTip")]),s("div",{},[s("label",{class:"block text-sm font-medium mb-2"},`${a("ai-datasets.backend.members.newRole")}:`),s(ie,{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,items:h,labelKey:"label",valueKey:"value",class:"w-full"})]),s("div",{},[s("label",{class:"block text-sm font-medium mb-2"},`${a("ai-datasets.backend.members.note")}:`),s(ce,{modelValue:n.value,"onUpdate:modelValue":c=>n.value=c,placeholder:a("ai-datasets.backend.members.notePlaceholder"),class:"w-full",rows:3})])])}});await _({title:a("ai-datasets.backend.members.updateRoleModal"),content:r,confirmText:a("console-common.update"),cancelText:a("console-common.cancel"),ui:{content:"!w-md"}}),(t.value!==e.role||n.value!==(e.note||""))&&(await be({memberId:e.id,role:t.value,note:n.value||void 0}),f.success(a("ai-datasets.backend.members.updateRoleSuccess")),i())}catch(t){console.error("更新角色失败:",t)}},P=async e=>{try{if(await _({color:"error",title:e.original.oneself?a("ai-datasets.backend.members.confirmExit"):a("ai-datasets.backend.members.confirmRemove"),content:e.original.oneself?a("ai-datasets.backend.members.confirmExitContent"):a("ai-datasets.backend.members.confirmRemoveContent"),confirmText:e.original.oneself?a("console-common.exit"):a("console-common.remove"),ui:{content:"!w-sm"}}),await pe({memberId:e.original.id}),e.original.oneself){$.push(ve("ai-datasets:list")),f.success(a("ai-datasets.backend.members.exitSuccess"));return}f.success(a("ai-datasets.backend.members.removeSuccess")),i()}catch(t){console.error("移除失败:",t)}},B=async e=>{try{await _({color:"warning",title:a("ai-datasets.backend.members.transferOwnership"),content:s("div",{class:"text-sm text-gray-600"},[s("p",{class:"mb-2"},[a("ai-datasets.backend.members.confirmTransferContent"),s("span",{class:"text-red-500"},e.user?.username||e.userId)," ？"]),s("p",{class:"text-red-500"},a("ai-datasets.backend.members.confirmTransferContent2"))]),confirmText:a("ai-datasets.backend.members.confirmTransfer"),ui:{content:"!w-sm"}}),await fe({datasetId:v.value||"",newOwnerId:e.userId}),f.success(a("ai-datasets.backend.members.confirmTransferSuccess")),i()}catch(t){console.error("转移所有权失败:",t)}};return J(()=>i()),(e,t)=>{const n=de,h=me;return X(),W("div",he,[u("div",ke,[u("h1",_e,A(o(a)("ai-datasets.backend.members.title")),1),u("p",xe,A(o(a)("ai-datasets.backend.members.description")),1)]),u("div",we,[b(o(U),{modelValue:o(d).username,"onUpdate:modelValue":t[0]||(t[0]=r=>o(d).username=r),placeholder:e.$t("ai-datasets.backend.members.searchPlaceholder"),class:"w-80",icon:"i-lucide-search"},null,8,["modelValue","placeholder"]),u("div",ye,[b(o(w),{items:o(g)?.tableApi?.getAllColumns().filter(r=>r.getCanHide()).map(r=>({label:o(m)[r.id]||r.columnDef.header,type:"checkbox",checked:r.getIsVisible(),onUpdateChecked(c){o(g)?.tableApi?.getColumn(r.id)?.toggleVisibility(!!c)},onSelect(c){c?.preventDefault()}})),content:{align:"end"}},{default:Y(()=>[b(o(p),{label:e.$t("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),b(o(p),{label:e.$t("ai-datasets.backend.members.addMember"),disabled:!("useUserStore"in e?e.useUserStore:o(ee))().userInfo?.isRoot&&o(y)?.role!=="owner"&&o(y)?.role!=="manager","leading-icon":"i-lucide-plus",color:"primary",onClick:D},null,8,["label","disabled"])])]),b(n,{loading:o(l).loading,data:o(l).items,columns:V,class:"shrink-0",ref_key:"table",ref:g,selectable:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"hover:bg-elevated/50"}},null,8,["loading","data"]),u("div",Ae,[b(h,{page:o(l).page,"onUpdate:page":t[1]||(t[1]=r=>o(l).page=r),size:o(l).pageSize,"onUpdate:size":t[2]||(t[2]=r=>o(l).pageSize=r),total:o(l).total,onChange:o(i)},null,8,["page","size","total","onChange"])])])}}});export{ra as default};
